**********************************************************************
                Message Session Relay Protocol (MSRP)
**********************************************************************
--> A series of related instant messages between two or more parties can
   be viewed as part of a "message session"
--> Messaging schemes that track only individual messages can be described as
   "page-mode" messaging, whereas messaging that is part of a "session"
   with a definite start and end is called "session-mode" messaging.
--> MSRP is a text-based, connection-oriented protocol for exchanging
   arbitrary (binary) MIME [8] content, especially instant messages.
--> simple Session Setup example
1. Alice sends to Bob:

   INVITE sip:bob@biloxi.example.com SIP/2.0
   To: <sip:bob@biloxi.example.com>
   From: <sip:alice@atlanta.example.com>;tag=786
   Call-ID: 3413an89KU
   Content-Type: application/sdp

   c=IN IP4 atlanta.example.com
   m=message 7654 TCP/MSRP *
   a=accept-types:text/plain
   a=path:msrp://atlanta.example.com:7654/jshA7weztas;tcp

2. Bob sends to Alice:

   SIP/2.0 200 OK
   To: <sip:bob@biloxi.example.com>;tag=087js
   From: <sip:alice@atlanta.example.com>;tag=786
   Call-ID: 3413an89KU
   Content-Type: application/sdp

   c=IN IP4 biloxi.example.com
   m=message 12763 TCP/MSRP *
   a=accept-types:text/plain
   a=path:msrp://biloxi.example.com:12763/kjhd37s2s20w2a;tcp

3. Alice sends to Bob:

   ACK sip:bob@biloxi SIP/2.0
   To: <sip:bob@biloxi.example.com>;tag=087js
   From: <sip:alice@atlanta.example.com>;tag=786
   Call-ID: 3413an89KU

--> MSRP defines two request types, or methods.  SEND requests are used
   to deliver a complete message or a chunk (a portion of a complete
   message), while REPORT requests report on the status of a previously
   sent message, or a range of bytes inside a message.

-->  Example MSRP Exchange
  MSRP a786hjs2 SEND
   To-Path: msrp://biloxi.example.com:12763/kjhd37s2s20w2a;tcp
   From-Path: msrp://atlanta.example.com:7654/jshA7weztas;tcp
   Message-ID: 87652491
   Byte-Range: 1-25/25
   Content-Type: text/plain

   Hey Bob, are you there?
   -------a786hjs2$

   MSRP a786hjs2 200 OK
   To-Path: msrp://atlanta.example.com:7654/jshA7weztas;tcp
   From-Path: msrp://biloxi.example.com:12763/kjhd37s2s20w2a;tcp
   -------a786hjs2$

--> Marker is equal to
 7 dashes (-------)
 The transaction ID from the request line
 A +, # or a $:
 +: more chunks coming
 #: aborted message
 $: last chunk in message

--> Breaking a Message into Chunks
  MSRP dkei38sd SEND
    Message-ID: 4564dpWd
    Byte-Range: 1-*/8
    Content-Type: text/plain

    abcd
    -------dkei38sd+

    MSRP dkei38ia SEND
    Message-ID: 4564dpWd
    Byte-Range: 5-8/8
    Content-Type: text/plain

    EFGH
    -------dkei38ia$

--> Basic IM Session Example
This section shows an example flow for the most common scenario.  The
   example assumes SIP is used to transport the SDP exchange.  Details
   of the SIP messages and SIP proxy infrastructure are omitted for the
   sake of brevity.  In the example, assume that the offerer is
   sip:alice@example.com and the answerer is sip:bob@example.com.

           Alice                     Bob
             |                        |
             |                        |
             |(1) (SIP) INVITE        |
             |----------------------->|
             |(2) (SIP) 200 OK        |
             |<-----------------------|
             |(3) (SIP) ACK           |
             |----------------------->|
             |(4) (MSRP) SEND         |
             |----------------------->|
             |(5) (MSRP) 200 OK       |
             |<-----------------------|
             |(6) (MSRP) SEND         |
             |<-----------------------|
             |(7) (MSRP) 200 OK       |
             |----------------------->|
             |(8) (SIP) BYE           |
             |----------------------->|
             |(9) (SIP) 200 OK        |
             |<-----------------------|
             |                        |
             |                        |


   1.  Alice constructs a local URI of
       msrp://alicepc.example.com:7777/iau39soe2843z;tcp .

       Alice->Bob (SIP): INVITE sip:bob@example.com

       v=0
       o=alice 2890844557 2890844559 IN IP4 alicepc.example.com
       s= -
       c=IN IP4 alicepc.example.com
       t=0 0
       m=message 7777 TCP/MSRP *
       a=accept-types:text/plain
       a=path:msrp://alicepc.example.com:7777/iau39soe2843z;tcp

   2.  Bob listens on port 8888, and sends the following response:

       Bob->Alice (SIP): 200 OK

       v=0
       o=bob 2890844612 2890844616 IN IP4 bob.example.com
       s= -
       c=IN IP4 bob.example.com
       t=0 0
       m=message 8888 TCP/MSRP *
       a=accept-types:text/plain
       a=path:msrp://bob.example.com:8888/9di4eae923wzd;tcp

   3.  Alice->Bob (SIP): ACK sip:bob@example.com

   4.  (Alice opens connection to Bob.)  Alice->Bob (MSRP):

       MSRP d93kswow SEND
       To-Path: msrp://bob.example.com:8888/9di4eae923wzd;tcp
       From-Path: msrp://alicepc.example.com:7777/iau39soe2843z;tcp
       Message-ID: 12339sdqwer
       Byte-Range: 1-16/16
       Content-Type: text/plain

       Hi, I'm Alice!
       -------d93kswow$

   5.  Bob->Alice (MSRP):

       MSRP d93kswow 200 OK
       To-Path: msrp://alicepc.example.com:7777/iau39soe2843z;tcp
       From-Path: msrp://bob.example.com:8888/9di4eae923wzd;tcp
       -------d93kswow$

  6.  Bob->Alice (MSRP):

       MSRP dkei38sd SEND
       To-Path: msrp://alicepc.example.com:7777/iau39soe2843z;tcp
       From-Path: msrp://bob.example.com:8888/9di4eae923wzd;tcp
       Message-ID: 456s9wlk3
       Byte-Range: 1-21/21
       Content-Type: text/plain

       Hi, Alice!  I'm Bob!
       -------dkei38sd$

   7.  Alice->Bob (MSRP):

       MSRP dkei38sd 200 OK
       To-Path: msrp://bob.example.com:8888/9di4eae923wzd;tcp
       From-Path: msrp://alicepc.example.com:7777/iau39soe2843z;tcp
       -------dkei38sd$

   8.  Alice->Bob (SIP): BYE sip:bob@example.com

       Alice invalidates local session state.

   9.  Bob invalidates local state for the session.

       Bob->Alice (SIP): 200 OK

-->  Message with XHTML Content

   MSRP dsdfoe38sd SEND
   To-Path: msrp://alice.example.com:7777/iau39soe2843z;tcp
   From-Path: msrp://bob.example.com:8888/9di4eae923wzd;tcp
   Message-ID: 456so39s
   Byte-Range: 1-374/374
   Content-Type: application/xhtml+xml


   <?xml version="1.0" encoding="UTF-8"?>
   <!DOCTYPE html
   PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "_http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd_">
   <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
     <head>
       <title>FY2005 Results</title>
   </head>
     <body>
      <p>See the results at <a
   href="http://example.org/">example.org</a>.</p>
     </body>
   </html>
   -------dsdfoe38sd$

--> Chunked Message with Message/CPIM Payload
1. First Chunk
MSRP d93kswow SEND
      To-Path: msrp://bobpc.example.com:8888/9di4eae923wzd;tcp
      From-Path: msrp://alicepc.example.com:7654/iau39soe2843z;tcp
      Message-ID: 12339sdqwer
      Byte-Range: 1-137/148
      Content-Type: message/cpim

      To: Bob <sip:bob@example.com>
      From: Alice <sip:alice@example.com>
      DateTime: 2006-05-15T15:02:31-03:00
      Content-Type: text/plain

      ABCD
      -------d93kswow+

2. Second Chunk

   Alice sends the second and last chunk.

      MSRP op2nc9a SEND
      To-Path: msrp://bobpc.example.com:8888/9di4eae923wzd;tcp
      From-Path: msrp://alicepc.example.com:7654/iau39soe2843z;tcp
      Message-ID: 12339sdqwer
      Byte-Range: 138-148/148
      Content-Type: message/cpim

      1234567890
      -------op2nc9a$

--> System Message

   Sysadmin->Alice (MSRP):

   MSRP d93kswow SEND
   To-Path: msrp://alicepc.example.com:8888/9di4eae923wzd;tcp
   From-Path: msrp://example.com:7777/iau39soe2843z;tcp
   Message-ID: 12339sdqwer
   Byte-Range: 1-38/38
   Failure-Report: no
   Success-Report: no
   Content-Type: text/plain

   This conference will end in 5 minutes
   -------d93kswow$

--> Positive Report

   Alice->Bob (MSRP):

   MSRP d93kswow SEND
   To-Path: msrp://bob.example.com:8888/9di4eae923wzd;tcp
   From-Path: msrp://alicepc.example.com:7777/iau39soe2843z;tcp
   Message-ID: 12339sdqwer
   Byte-Range: 1-106/106
   Success-Report: yes
   Failure-Report: no
   Content-Type: text/html
   
   <html><body>
   <p>Here is that important link...
   <a href="http://www.example.com/foobar">foobar</a>
   </p>
   </body></html>
   -------d93kswow$

                      Figure 16: Initial SEND Request

   Bob->Alice (MSRP):

   MSRP dkei38sd REPORT
   To-Path: msrp://alicepc.example.com:7777/iau39soe2843z;tcp
   From-Path: msrp://bob.example.com:8888/9di4eae923wzd;tcp
   Message-ID: 12339sdqwer
   Byte-Range: 1-106/106
   Status: 000 200 OK
   -------dkei38sd$

--> MSRP Method Names
SEND - [RFC4975]
REPORT - [RFC4975]

-->  MSRP Header Fields

      To-Path - [RFC4975]
      From-Path - [RFC4975]
      Message-ID - [RFC4975]
      Success-Report - [RFC4975]
      Failure-Report - [RFC4975]
      Byte-Range - [RFC4975]
      Status - [RFC4975]



**********************************************************************
                 SDP: Session Description Protocol
**********************************************************************
-->When initiating multimedia teleconferences, voice-over-IP calls,
   streaming video, or other sessions, there is a requirement to convey
   media details, transport addresses, and other session description
   metadata to the participants. SDP provides a standard representation for such
   information, irrespective of how that information is transported.

-->  Conference: A multimedia conference is a set of two or more
      communicating users along with the software they are using to
      communicate.

   Session: A multimedia session is a set of multimedia senders and
      receivers and the data streams flowing from senders to receivers.
      A multimedia conference is an example of a multimedia session.

   Session Description: A well-defined format for conveying sufficient
      information to discover and participate in a multimedia session.

--> An SDP session description includes the following:
   o  Session name and purpose
   o  Time(s) the session is active
   o  The media comprising the session
   o  Information needed to receive those media (addresses, ports,
      formats, etc.)


   As resources necessary to participate in a session may be limited,
   some additional information may also be desirable:
   o  Information about the bandwidth to be used by the session
   o  Contact information for the person responsible for the session

--> Media and Transport Information
An SDP session description includes the following media information:
   o  The type of media (video, audio, etc.)
   o  The transport protocol (RTP/UDP/IP, H.320, etc.)
   o  The format of the media (H.261 video, MPEG video, etc.)

   In addition to media format and transport protocol, SDP conveys
   address and port details.  For an IP multicast session, these
   comprise:
   o  The multicast group address for media
   o  The transport port for media

   This address and port are the destination address and destination
   port of the multicast stream, whether being sent, received, or both.

   For unicast IP sessions, the following are conveyed:
   o  The remote address for media
   o  The remote transport port for media

--> Timing Information
SDP can convey:
   o  An arbitrary list of start and stop times bounding the session
   o  For each bound, repeat times such as "every Wednesday at 10am for
      one hour"

--> SDP Specification
 OPTIONAL items are marked with a "*".

      Session description
         v=  (protocol version)
         o=  (originator and session identifier)
         s=  (session name)
         i=* (session information)
         u=* (URI of description)
         e=* (email address)
         p=* (phone number)
         c=* (connection information -- not required if included in
              all media)
         b=* (zero or more bandwidth information lines)
         One or more time descriptions ("t=" and "r=" lines; see below)
         z=* (time zone adjustments)
         k=* (encryption key)
         a=* (zero or more session attribute lines)
         Zero or more media descriptions

      Time description
         t=  (time the session is active)
         r=* (zero or more repeat times)

      Media description, if present
         m=  (media name and transport address)
         i=* (media title)
         c=* (connection information -- optional if included at
              session level)
         b=* (zero or more bandwidth information lines)
         k=* (encryption key)
         a=* (zero or more media attribute lines)

-->    An example SDP description is:

      v=0
      o=jdoe 2890844526 2890842807 IN IP4 10.47.16.5
      s=SDP Seminar
      i=A Seminar on the session description protocol
      u=http://www.example.com/seminars/sdp.pdf
      e=j.doe@example.com (Jane Doe)
      c=IN IP4 224.2.17.12/127
      t=2873397496 2873404696
      a=recvonly
      m=audio 49170 RTP/AVP 0
      m=video 51372 RTP/AVP 99
      a=rtpmap:99 h263-1998/90000

--> SDP Spec
1. Protocol Version ("v=")
      v=0

2. Origin ("o=")
      o=<username> <sess-id> <sess-version> <nettype> <addrtype>
        <unicast-address>

3.  Session Name ("s=")
      s=<session name>

4.  Session Information ("i=")
      i=<session description>

5.  URI ("u=")
      u=<uri>

6.  Email Address and Phone Number ("e=" and "p=")
      e=<email-address>
      p=<phone-number>

7.  Connection Data ("c=")
      c=<nettype> <addrtype> <connection-address>

8.  Bandwidth ("b=")
      b=<bwtype>:<bandwidth>

9.  Timing ("t=")
      t=<start-time> <stop-time>

10.  Repeat Times ("r=")
      r=<repeat interval> <active duration> <offsets from start-time>

11.  Time Zones ("z=")
      z=<adjustment time> <offset> <adjustment time> <offset> ....

12.  Encryption Keys ("k=")
      k=<method>
      k=<method>:<encryption key>

13.  Attributes ("a=")
      a=<attribute>
      a=<attribute>:<value>

14.  Media Descriptions ("m=")
      m=<media> <port> <proto> <fmt> ...

--> SDP Attributes
a=cat:<category>
a=keywds:<keywords>
a=tool:<name and version of tool>
a=ptime:<packet time>
a=maxptime:<maximum packet time>
a=rtpmap:<payload type> <encoding name>/<clock rate> [/<encoding
  parameters>]
a=recvonly
a=sendrecv
a=sendonly
a=inactive
a=orient:<orientation>
a=type:<conference type>
a=charset:<character set>
a=sdplang:<language tag>
a=lang:<language tag>
a=framerate:<frame rate>
a=quality:<quality>
a=fmtp:<format> <format specific parameters>

--> Example Offer/Answer Exchanges
10.1 Basic Exchange

   Assume that the caller, Alice, has included the following description
   in her offer.  It includes a bidirectional audio stream and two
   bidirectional video streams, using H.261 (payload type 31) and MPEG
   (payload type 32).  The offered SDP is:

   v=0
   o=alice 2890844526 2890844526 IN IP4 host.anywhere.com
   s=
   c=IN IP4 host.anywhere.com
   t=0 0
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   m=video 51372 RTP/AVP 31
   a=rtpmap:31 H261/90000
   m=video 53000 RTP/AVP 32
   a=rtpmap:32 MPV/90000
   The callee, Bob, does not want to receive or send the first video
   stream, so he returns the SDP below as the answer:

   v=0
   o=bob 2890844730 2890844730 IN IP4 host.example.com
   s=
   c=IN IP4 host.example.com
   t=0 0
   m=audio 49920 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   m=video 0 RTP/AVP 31
   m=video 53000 RTP/AVP 32
   a=rtpmap:32 MPV/90000

   At some point later, Bob decides to change the port where he will
   receive the audio stream (from 49920 to 65422), and at the same time,
   add an additional audio stream as receive only, using the RTP payload
   format for events [9].  Bob offers the following SDP in the offer:

   v=0
   o=bob 2890844730 2890844731 IN IP4 host.example.com
   s=
   c=IN IP4 host.example.com
   t=0 0
   m=audio 65422 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   m=video 0 RTP/AVP 31
   m=video 53000 RTP/AVP 32
   a=rtpmap:32 MPV/90000
   m=audio 51434 RTP/AVP 110
   a=rtpmap:110 telephone-events/8000
   a=recvonly

   Alice accepts the additional media stream, and so generates the
   following answer:

   v=0
   o=alice 2890844526 2890844527 IN IP4 host.anywhere.com
   s=
   c=IN IP4 host.anywhere.com
   t=0 0
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   m=video 0 RTP/AVP 31
   a=rtpmap:31 H261/90000
   m=video 53000 RTP/AVP 32
   a=rtpmap:32 MPV/90000
   m=audio 53122 RTP/AVP 110
   a=rtpmap:110 telephone-events/8000
   a=sendonly

10.2 One of N Codec Selection

   A common occurrence in embedded phones is that the Digital Signal
   Processor (DSP) used for compression can support multiple codecs at a
   time, but once that codec is selected, it cannot be readily changed
   on the fly.  This example shows how a session can be set up using an
   initial offer/answer exchange, followed immediately by a second one
   to lock down the set of codecs.

   The initial offer from Alice to Bob indicates a single audio stream
   with the three audio codecs that are available in the DSP.  The
   stream is marked as inactive, since media cannot be received until a
   codec is locked down:

   v=0
   o=alice 2890844526 2890844526 IN IP4 host.anywhere.com
   s=
   c=IN IP4 host.anywhere.com
   t=0 0
   m=audio 62986 RTP/AVP 0 4 18
   a=rtpmap:0 PCMU/8000
   a=rtpmap:4 G723/8000
   a=rtpmap:18 G729/8000
   a=inactive

   Bob can support dynamic switching between PCMU and G.723.  So, he
   sends the following answer:

   v=0
   o=bob 2890844730 2890844731 IN IP4 host.example.com
   s=
   c=IN IP4 host.example.com
   t=0 0
   m=audio 54344 RTP/AVP 0 4
   a=rtpmap:0 PCMU/8000
   a=rtpmap:4 G723/8000
   a=inactive

   Alice can then select any one of these two codecs.  So, she sends an
   updated offer with a sendrecv stream:

   v=0
   o=alice 2890844526 2890844527 IN IP4 host.anywhere.com
   s=
   c=IN IP4 host.anywhere.com
   t=0 0
   m=audio 62986 RTP/AVP 4
   a=rtpmap:4 G723/8000
   a=sendrecv

   Bob accepts the single codec:

   v=0
   o=bob 2890844730 2890844732 IN IP4 host.example.com
   s=
   c=IN IP4 host.example.com
   t=0 0
   m=audio 54344 RTP/AVP 4
   a=rtpmap:4 G723/8000
   a=sendrecv

   If the answerer (Bob), was only capable of supporting one-of-N
   codecs, Bob would select one of the codecs from the offer, and place
   that in his answer. In this case, Alice would do a re-INVITE to
   activate that stream with that codec.

   As an alternative to using "a=inactive" in the first exchange, Alice
   can list all codecs, and as soon as she receives media from Bob,
   generate an updated offer locking down the codec to the one just
   received. Of course, if Bob only supports one-of-N codecs, there
   would only be one codec in his answer, and in this case, there is no
   need for a re-INVITE to lock down to a single codec.


**********************************************************************
                    User Datagram Protocol(UDP)
**********************************************************************
--> This User Datagram  Protocol  (UDP)  is  defined  to  make  available  a
datagram   mode  of  packet-switched   computer   communication  in  the
environment of  an  interconnected  set  of  computer  networks. This protocol
provides a procedure  for application  programs to send messages  to other 
programs with a minimum  of protocol mechanism. The protocol  is transaction 
oriented, and delivery and duplicate protection are not guaranteed. 

-->  User Datagram Header Format


                  0      7 8     15 16    23 24    31
                 +--------+--------+--------+--------+
                 |     Source      |   Destination   |
                 |      Port       |      Port       |
                 +--------+--------+--------+--------+
                 |                 |                 |
                 |     Length      |    Checksum     |
                 +--------+--------+--------+--------+
                 |
                 |          data octets ...
                 +---------------- ...


-->


                  0      7 8     15 16    23 24    31
                 +--------+--------+--------+--------+
                 |          source address           |
                 +--------+--------+--------+--------+
                 |        destination address        |
                 +--------+--------+--------+--------+
                 |  zero  |protocol|   UDP length    |
                 +--------+--------+--------+--------+


**********************************************************************
        RTP: A Transport Protocol for Real-Time Applications
**********************************************************************
--> RTP provides end-to-end network transport functions suitable for
   applications transmitting real-time data, such as audio, video or
   simulation data, over multicast or unicast network services.  RTP
   does not address resource reservation and does not guarantee
   quality-of-service for real-time services. Those services
   include payload type identification, sequence numbering, timestamping
   and delivery monitoring.  Applications typically run RTP on top of
   UDP to make use of its multiplexing and checksum services; both
   protocols contribute parts of the transport protocol functionality.

--> Definitions
1. RTP payload: The data transported by RTP in a packet, for example audio 
   samples or compressed video data. 

2. RTP packet: A data packet consisting of the fixed RTP header, a possibly 
   empty list of contributing sources, and the payload data.

3. RTCP packet: A control packet consisting of a fixed header part similar to 
   that of RTP data packets, followed by structured elements that vary depending
   upon the RTCP packet type.

4. Port: The "abstraction that transport protocols use to distinguish among 
   multiple destinations within a given host computer.

5. Transport address: The combination of a network address and port that 
   identifies a transport-level endpoint, for example an IP addr and a UDP port.

6. RTP media type: An RTP media type is the collection of payload types which 
   can be carried within a single RTP session.

7. Multimedia session: A set of concurrent RTP sessions among a common group of 
   participants. 

8. RTP session: An association among a set of participants communicating with RTP.

9. Synchronization source (SSRC): The source of a stream of RTP packets, 
   identified by a 32-bit numeric SSRC identifier carried in the RTP header so 
   as not to be dependent upon the network address.

10. Contributing source (CSRC): A source of a stream of RTP packets that has 
    contributed to the combined stream produced by an RTP mixer.

11. End system: An application that generates the content to be sent in RTP 
    packets and/or consumes the content of received RTP packets.

12. Mixer: An intermediate system that receives RTP packets from one or more 
    sources, possibly changes the data format, combines the packets in some 
    manner and then forwards a new RTP packet.

13. Translator: An intermediate system that forwards RTP packets with their 
    synchronization source identifier intact.

14. Monitor: An application that receives RTCP packets sent by participants in 
    an RTP session, in particular the reception reports, and estimates the 
    current quality of service for distribution monitoring, fault diagnosis and 
    long-term statistics.

15. Non-RTP means: Protocols and mechanisms that may be needed in addition to 
    RTP to provide a usable service.

--> RTP Data Transfer Protocol
1. RTP Fixed Header Fields

   The RTP header has the following format:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |V=2|P|X|  CC   |M|     PT      |       sequence number         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           timestamp                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           synchronization source (SSRC) identifier            |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |            contributing source (CSRC) identifiers             |
   |                             ....                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

2. RTP Header Extension

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      defined by profile       |           length              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        header extension                       |
   |                             ....                              |

--> RTP Control Protocol -- RTCP
RTCP performs four functions:   
1. The primary function is to provide feedback on the quality of the data 
   distribution.
2. RTCP carries a persistent transport-level identifier for an RTP source called
   the canonical name or CNAME
3. The first two functions require that all participants send RTCP packets, 
   therefore the rate must be controlled in order for RTP to scale up to a large
   number of participants.   
4. A fourth, OPTIONAL function is to convey minimal session control information, 
   for example participant identification to be displayed in the user interface.

--> RTCP Packet Format
SR: Sender report, for transmission and reception statistics from participants 
    that are active senders

RR: Receiver report, for reception statistics from participants that are not 
    active senders and in combination with SR for active senders reporting on 
    more than 31 sources

SDES: Source description items, including CNAME

BYE: Indicates end of participation

APP: Application-specific functions      

--> Sender and Receiver Reports
1 SR: Sender Report RTCP Packet

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
header |V=2|P|    RC   |   PT=SR=200   |             length            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         SSRC of sender                        |
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
sender |              NTP timestamp, most significant word             |
info   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |             NTP timestamp, least significant word             |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         RTP timestamp                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                     sender's packet count                     |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                      sender's octet count                     |
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
report |                 SSRC_1 (SSRC of first source)                 |
block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  1    | fraction lost |       cumulative number of packets lost       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           extended highest sequence number received           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                      interarrival jitter                      |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         last SR (LSR)                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   delay since last SR (DLSR)                  |
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
report |                 SSRC_2 (SSRC of second source)                |
block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  2    :                               ...                             :
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
       |                  profile-specific extensions                  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


2 RR: Receiver Report RTCP Packet

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
header |V=2|P|    RC   |   PT=RR=201   |             length            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                     SSRC of packet sender                     |
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
report |                 SSRC_1 (SSRC of first source)                 |
block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  1    | fraction lost |       cumulative number of packets lost       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           extended highest sequence number received           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                      interarrival jitter                      |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         last SR (LSR)                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   delay since last SR (DLSR)                  |
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
report |                 SSRC_2 (SSRC of second source)                |
block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  2    :                               ...                             :
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
       |                  profile-specific extensions                  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


3. SDES: Source Description RTCP Packet

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
header |V=2|P|    SC   |  PT=SDES=202  |             length            |
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
chunk  |                          SSRC/CSRC_1                          |
  1    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                           SDES items                          |
       |                              ...                              |
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
chunk  |                          SSRC/CSRC_2                          |
  2    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                           SDES items                          |
       |                              ...                              |
       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

4. BYE: Goodbye RTCP Packet

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |V=2|P|    SC   |   PT=BYE=203  |             length            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                           SSRC/CSRC                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      :                              ...                              :
      +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
(opt) |     length    |               reason for leaving            ...
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


5. APP: Application-Defined RTCP Packet

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |V=2|P| subtype |   PT=APP=204  |             length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           SSRC/CSRC                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          name (ASCII)                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   application-dependent data                ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


--> Protocol Constants
1 RTCP Packet Types

   abbrev.  name                 value
   SR       sender report          200
   RR       receiver report        201
   SDES     source description     202
   BYE      goodbye                203
   APP      application-defined    204

2 SDES Types

   abbrev.  name                            value
   END      end of SDES list                    0
   CNAME    canonical name                      1
   NAME     user name                           2
   EMAIL    user's electronic mail address      3
   PHONE    user's phone number                 4
   LOC      geographic user location            5
   TOOL     name of application or tool         6
   NOTE     notice about the source             7
   PRIV     private extensions                  8


**********************************************************************
                    C++
**********************************************************************
--> References in C++
1. When a variable is declared as reference, it becomes an alternative name for 
an existing variable. A variable can be declared as reference by putting ‘&’ in 
the declaration. 

#include<iostream>
using namespace std;
 
int main()
{
  int x = 10;
 
  // ref is a reference to x.
  int& ref = x;
 
  // Value of x is now changed to 20
  ref = 20;
  cout << "x = " << x << endl ;
 
  // Value of x is now changed to 30
  x = 30;
  cout << "ref = " << ref << endl ;
 
  return 0;
}

2. swap two variables.
#include<iostream>
using namespace std;
 
void swap (int& first, int& second)
{
    int temp = first;
    first = second;
    second = temp;
}
 
int main()
{
    int a = 2, b = 3;
    swap( a, b );
    cout << a << " " << b;
    return 0;
}

--> Templates in C++
1. Function Templates

#include <iostream>
using namespace std;
 
// One function works for all data types.  This would work
// even for user defined types if operator '>' is overloaded
template <typename T>
T myMax(T x, T y)
{
   return (x > y)? x: y;
}
 
int main()
{
  cout << myMax<int>(3, 7) << endl;  // Call myMax for int
  cout << myMax<double>(3.0, 7.0) << endl; // call myMax for double
  cout << myMax<char>('g', 'e') << endl;   // call myMax for char
 
  return 0;
}

2. Class Templates

#include <iostream>
using namespace std;
 
template <typename T>
class Array {
private:
    T *ptr;
    int size;
public:
    Array(T arr[], int s);
    void print();
};
 
template <typename T>
Array<T>::Array(T arr[], int s) {
    ptr = new T[s];
    size = s;
    for(int i = 0; i < size; i++)
        ptr[i] = arr[i];
}
 
template <typename T>
void Array<T>::print() {
    for (int i = 0; i < size; i++)
        cout<<" "<<*(ptr + i);
    cout<<endl;
}
 
int main() {
    int arr[5] = {1, 2, 3, 4, 5};
    Array<int> a(arr, 5);
    a.print();
    return 0;
}

3. default value for template arguments

#include<iostream>
using namespace std;
 
template<class T, class U = char>
class A  {
public:
    T x;
    U y;
    A() {   cout<<"Constructor Called"<<endl;   }
};
 
int main()  {
   A<char> a;  // This will call A<char, char>   
   return 0;
}

4. Function templates and static variables:
Each instantiation of function template has its own copy of local 
static variables.

#include <iostream>
 
using namespace std;
 
template <typename T>
void fun(const T& x)
{
  static int i = 10;
  cout << ++i;
  return;
}
 
int main()
{    
  fun<int>(1);  // prints 11
  cout << endl;
  fun<int>(2);  // prints 12
  cout << endl;
  fun<double>(1.1); // prints 11
  cout << endl;
  getchar();
  return 0;
}

5. Class templates and static variables:
The rule for class templates is same as function templates

#include <iostream>
 
using namespace std;
 
template <class T> class Test
{  
private:
  T val; 
public:
  static int count;
  Test()
  {
    count++;
  }
  // some other stuff in class
};
 
template<class T>
int Test<T>::count = 0;
 
int main()
{
  Test<int> a;  // value of count for Test<int> is 1 now
  Test<int> b;  // value of count for Test<int> is 2 now
  Test<double> c;  // value of count for Test<double> is 1 now
  cout << Test<int>::count   << endl;  // prints 2  
  cout << Test<double>::count << endl; //prints 1
    
  getchar();
  return 0;
}

--> Smart Pointers in C++

1. simple smartPtr class.

#include<iostream>
using namespace std;
 
class SmartPtr
{
   int *ptr;  // Actual pointer
public:
   // Constructor: Refer http://www.geeksforgeeks.org/g-fact-93/
   // for use of explicit keyword 
   explicit SmartPtr(int *p = NULL) { ptr = p; } 
 
   // Destructor
   ~SmartPtr() { delete(ptr); }  
 
   // Overloading dereferencing operator
   int &operator *() {  return *ptr; }
};
 
int main()
{
    SmartPtr ptr(new int());
    *ptr = 20;
    cout << *ptr;
 
    // We don't need to call delete ptr: when the object 
    // ptr goes out of scope, destructor for it is automatically
    // called and destructor does delete ptr.
 
    return 0;
}

2. use templates to write a generic smart pointer class.

#include<iostream>
using namespace std;
 
// A generic smart pointer class
template <class T>
class SmartPtr
{
   T *ptr;  // Actual pointer
public:
   // Constructor
   explicit SmartPtr(T *p = NULL) { ptr = p; }
 
   // Destructor
   ~SmartPtr() { delete(ptr); }
 
   // Overloading dereferncing operator
   T & operator * () {  return *ptr; }
 
   // Overloding arrow operator so that members of T can be accessed
   // like a pointer (useful if T represents a class or struct or 
   // union type)
   T * operator -> () { return ptr; }
};
 
int main()
{
    SmartPtr<int> ptr(new int());
    *ptr = 20;
    cout << *ptr;
    return 0;
}

--> Operator Overloading in C++

Example 1 :

#include<iostream>
using namespace std;
 
class Complex {
private:
    int real, imag;
public:
    Complex(int r = 0, int i =0)  {real = r;   imag = i;}
     
    // This is automatically called when '+' is used with
    // between two Complex objects
    Complex operator + (Complex const &obj) {
         Complex res;
         res.real = real + obj.real;
         res.imag = imag + obj.imag;
         return res;
    }
    void print() { cout << real << " + i" << imag << endl; }
};
 
int main()
{
    Complex c1(10, 5), c2(2, 4);
    Complex c3 = c1 + c2; // An example call to "operator+"
    c3.print();
}

Example 2 : 

#include<iostream>
using namespace std;
 
class Complex {
private:
    int real, imag;
public:
    Complex(int r = 0, int i =0)  {real = r;   imag = i;}
    void print() { cout << real << " + i" << imag << endl; }
 
// The global operator function is made friend of this class so
// that it can access private members
friend Complex operator + (Complex const &, Complex const &);
};
 
 
Complex operator + (Complex const &c1, Complex const &c2)
{
     return Complex(c1.real + c2.real, c1.imag + c2.imag);
}
 
 
int main()
{
    Complex c1(10, 5), c2(2, 4);
    Complex c3 = c1 + c2; // An example call to "operator+"
    c3.print();
    return 0;
}

--> Pure Virtual Functions and Abstract Classes in C++
1) A class is abstract if it has at least one pure virtual function.
2) We can have pointers and references of abstract class type.
3) If we do not override the pure virtual function in derived class, 
then derived class also becomes abstract class.
4) An abstract class can have constructors.

#include<iostream>
using namespace std;
 
class Base
{
   int x;
public:
    virtual void fun() = 0;
    int getX() { return x; }
};
 
// This class ingerits from Base and implements fun()
class Derived: public Base
{
    int y;
public:
    void fun() { cout << "fun() called"; }
};
 
int main(void)
{
    Derived d;
    d.fun();
    return 0;
}

--> Pure virtual destructor in C++
if class contains pure virtual destructor it is must to provide a function body 
for the pure virtual destructor. 

#include <iostream>
class Base
{
public:
    virtual ~Base()=0; // Pure virtual destructor
};
Base::~Base()
{
    std::cout << "Pure virtual destructor is called";
}
 
class Derived : public Base
{
public:
    ~Derived()
    {
        std::cout << "~Derived() is executed\n";
    }
};
 
int main()
{
    Base *b = new Derived();
    delete b;
    return 0;
}

--> Friend class and function in C++

1. friend Class

#include <iostream>
class A {
private:
    int a;
public:
    A() { a=0; }
    friend class B;     // Friend Class
};
 
class B {
private:
    int b;
public:
    void showA(A& x) {
        // Since B is friend of A, it can access
        // private members of A
        std::cout << "A::a=" << x.a;
    }
};
 
int main() {
   A a;
   B b;
   b.showA(a);
   return 0;
}

2. friend function of another class
#include <iostream>
 
class B;
 
class A
{
public:
    void showB(B& );
};
 
class B
{
private:
    int b;
public:
    B()  {  b = 0; }
    friend void A::showB(B& x); // Friend function
};
 
void A::showB(B &x)
{
    // Since show() is friend of B, it can
    // access private members of B
    std::cout << "B::b = " << x.b;
}
 
int main()
{
    A a;
    B x;
    a.showB(x);
    return 0;
}

3. global friend
#include <iostream>
 
class A
{
    int a;
public:
    A() {a = 0;}
    friend void showA(A&); // global friend function
};
 
void showA(A& x) {
    // Since showA() is a friend, it can access
    // private members of A
    std::cout << "A::a=" << x.a;
}
 
int main()
{
    A a;
    showA(a);
    return 0;
}

--> Exception Handling in C++
1. simple example
#include <iostream>
using namespace std;
 
int main()
{
   int x = -1;
 
   // Some code
   cout << "Before try \n";
   try {
      cout << "Inside try \n";
      if (x < 0)
      {
         throw x;
         cout << "After throw (Never executed) \n";
      }
   }
   catch (int x ) {
      cout << "Exception Caught \n";
   }
 
   cout << "After catch (Will be executed) \n";
   return 0;
}

2. There is a special catch block called ‘catch all’ catch(…) 

#include <iostream>
using namespace std;
 
int main()
{
    try  {
       throw 10;
    }
    catch (char *excp)  {
        cout << "Caught " << excp;
    }
    catch (...)  {
        cout << "Default Exception\n";
    }
    return 0;
}

3. Implicit type conversion doesn’t happen for primitive types.
#include <iostream>
using namespace std;
 
int main()
{
    try  {
       throw 'a';
    }
    catch (int x)  {
        cout << "Caught " << x;
    }
    catch (...)  {
        cout << "Default Exception\n";
    }
    return 0;
}

4. If an exception is thrown and not caught anywhere, the program terminates 
   abnormally. 

#include <iostream>
using namespace std;
 
int main()
{
    try  {
       throw 'a';
    }
    catch (int x)  {
        cout << "Caught ";
    }
    return 0;
}

5. A derived class exception should be caught before a base class exception. 
#include<iostream>
using namespace std;
 
class Base {};
class Derived: public Base {};
int main()
{
   Derived d;
   // some other stuff
   try {
       // Some monitored code
       throw d;
   }
   catch(Derived d) { 
        cout<<"Caught Derived Exception";
   }
   catch(Base b) { 
        cout<<"Caught Base Exception";
   }
   getchar();
   return 0;
}

6. in C++, all exceptions are unchecked. Compiler doesn’t check whether an 
exception is caught or not

#include <iostream>
using namespace std;
 
// This function signature is fine by the compiler, but not recommended.
// Ideally, the function should specify all uncaught exceptions and function
// signature should be "void fun(int *ptr, int x) throw (int *, int)"
void fun(int *ptr, int x)
{
    if (ptr == NULL)
        throw ptr;
    if (x == 0)
        throw x;
    /* Some functionality */
}
 
int main()
{
    try {
       fun(NULL, 0);
    }
    catch(...) {
        cout << "Caught exception from fun()";
    }
    return 0;
}

7.  try-catch blocks can be nested. Also, an exception can be re-thrown 
using “throw; ”

#include <iostream>
using namespace std;
 
int main()
{
    try {
        try  {
            throw 20;
        }
        catch (int n) {
             cout << "Handle Partially ";
             throw;   //Re-throwing an exception
        }
    }
    catch (int n) {
        cout << "Handle remaining ";
    }
    return 0;
}

8. When an exception is thrown, all objects created inside the enclosing try 
block are destructed before the control is transferred to catch block.

#include <iostream>
using namespace std;
 
class Test {
public:
   Test() { cout << "Constructor of Test " << endl; }
  ~Test() { cout << "Destructor of Test "  << endl; }
};
 
int main() {
  try {
    Test t1;
    throw 10;
  } catch(int i) {
    cout << "Caught " << i << endl;
  }
}

**********************************************************************
                            C
**********************************************************************
--> Pointers
Read it backwards (as driven by Clockwise/Spiral Rule)...
    int* - pointer to int
    int const * - pointer to const int
    int * const - const pointer to int
    int const * const - const pointer to const int

Now the first const can be on either side of the type so:
    const int * == int const *
    const int * const == int const * const

If you want to go really crazy you can do things like this:
    int ** - pointer to pointer to int
    int ** const - a const pointer to a pointer to an int
    int * const * - a pointer to a const pointer to an int
    int const ** - a pointer to a pointer to a const int
    int * const * const - a const pointer to a const pointer to an int

--> Function Pointer in C
#include <stdio.h>
// A normal function with an int parameter
// and void return type
void fun(int a)
{
    printf("Value of a is %d\n", a);
}
 
int main()
{
    // fun_ptr is a pointer to function fun() 
    void (*fun_ptr)(int) = &fun;
 
    /* The above line is equivalent of following two
       void (*fun_ptr)(int);
       fun_ptr = &fun; 
    */
 
    // Invoking fun() using fun_ptr
    (*fun_ptr)(10);
 
    return 0;
}

**********************************************************************
                 Session Initiation Protocol (SIP)                          
**********************************************************************
--> SIP Functionality
1. User location: determination of the end system to be used for communication
2. User availability: determination of the willingness of the called party to 
   engage in communications
3. User capabilities: determination of the media and media parameters to be used
4. Session setup: "ringing", establishment of session parameters at both called 
   and calling party
5. Session management: including transfer and termination of sessions, modifying 
   session parameters, and invoking services.

--> Definitions
01. Address-of-Record: An address-of-record (AOR) is a SIP or SIPS URI that 
    points to a domain with a location service that can map the URI to another 
    URI where the user might be available.   
02. Back-to-Back User Agent: A back-to-back user agent (B2BUA) is a logical 
    entity that receives a request and processes it as a user agent server (UAS).
03. Call: A call is an informal term that refers to some communication between 
    peers.
04. Call Leg: Another name for a dialog.
05. Call Stateful: A proxy is call stateful if it retains state for a dialog 
    from the initiating INVITE to the terminating BYE request.
06. Client: A client is any network element that sends SIP requests and receives
    SIP responses.
07. Conference: A multimedia session (see below) that contains multiple 
    participants.        
08. Core: Core designates the functions specific to a particular type of SIP 
    entity, i.e., specific to either a stateful or stateless proxy, a user agent 
    or registrar.    
09. Dialog: A dialog is a peer-to-peer SIP relationship between two UAs that 
    persists for some time.
10. Downstream: A direction of message forwarding within a transaction that 
    refers to the direction that requests flow from the user agent client to 
    user agent server.    
11. Final Response: A response that terminates a SIP transaction
12. Header: A header is a component of a SIP message that conveys information 
    about the message.    
13. Header Field: A header field is a component of the SIP message header.    
14. Header Field Value: A header field value is a single value; a header field 
    consists of zero or more header field values.
15. Home Domain: The domain providing service to a SIP user.
16. Informational Response: Same as a provisional response.
17. Initiator, Calling Party, Caller: The party initiating a session 
    (and dialog) with an INVITE request.    
18. Invitation: An INVITE request.
19. Invitee, Invited User, Called Party, Callee: The party that receives an 
    INVITE request for the purpose of establishing a new session.    
20. Location Service: A location service is used by a SIP redirect or proxy 
    server to obtain information about a callee's possible location(s).    
21. Loop: A request that arrives at a proxy, is forwarded, and later arrives 
    back at the same proxy.    
22. Loose Routing: A proxy is said to be loose routing if it follows the 
    procedures defined in this specification for processing of the Route header 
    field.    
23. Message: Data sent between SIP elements as part of the protocol.
24. Method: The method is the primary function that a request is meant to invoke 
    on a server.    
25. Outbound Proxy: A proxy that receives requests from a client, even though it 
    may not be the server resolved by the Request-URI.    
26. Parallel Search: In a parallel search, a proxy issues several requests to 
    possible user locations upon receiving an incoming request.
27. Provisional Response: A response used by the server to indicate progress, 
    but that does not terminate a SIP transaction.  
28. Proxy, Proxy Server: An intermediary entity that acts as both a server and a 
    client for the purpose of making requests on behalf of other clients.
29. Recursion: A client recurses on a 3xx response when it generates a new 
    request to one or more of the URIs in the Contact header field in the 
    response.    
30. Redirect Server: A redirect server is a user agent server that generates 3xx 
    responses to requests it receives, directing the client to contact an 
    alternate set of URIs.
31. Registrar: A registrar is a server that accepts REGISTER requests and places 
    the information it receives in those requests into the location service for 
    the domain it handles.    
32. Regular Transaction: A regular transaction is any transaction with a method 
    other than INVITE, ACK, or CANCEL.    
33. Request: A SIP message sent from a client to a server, for the purpose of 
    invoking a particular operation.
34. Response: A SIP message sent from a server to a client, for indicating the 
    status of a request sent from the client to the server.    
35. Ringback: Ringback is the signaling tone produced by the calling party's 
    application indicating that a called party is being alerted (ringing).    
36. Route Set: A route set is a collection of ordered SIP or SIPS URI which 
    represent a list of proxies that must be traversed when sending a particular 
    request.
37. Server: A server is a network element that receives requests in order to 
    service them and sends back responses to those requests.    
38. Sequential Search: In a sequential search, a proxy server attempts each 
    contact address in sequence, proceeding to the next one only after the 
    previous has generated a final response.    
39. Session: From the SDP specification: "A multimedia session is a set of 
    multimedia senders and receivers and the data streams flowing from senders 
    to receivers.    
40. SIP Transaction: A SIP transaction occurs between a client and a server and 
    comprises all messages from the first request sent from the client to the 
    server up to a final (non-1xx) response sent from the server to the client.
41. Spiral: A spiral is a SIP request that is routed to a proxy, forwarded 
    onwards, and arrives once again at that proxy, but this time differs in a 
    way that will result in a different processing decision than the original 
    request.     
42. Stateful Proxy: A logical entity that maintains the client and server 
    transaction state machines defined by this specification during the 
    processing of a request, also known as a transaction stateful proxy.    
43. Stateless Proxy: A logical entity that does not maintain the client or 
    server transaction state machines defined in this specification when it 
    processes requests.
44. Strict Routing: A proxy is said to be strict routing if it follows the Route 
    processing rules of RFC 2543 and many prior work in progress versions of 
    this RFC.    
45. Target Refresh Request: A target refresh request sent within a dialog is 
    defined as a request that can modify the remote target of the dialog.    
46. Transaction User (TU): The layer of protocol processing that resides above 
    the transaction layer.    
47. Upstream: A direction of message forwarding within a transaction that refers 
    to the direction that responses flow from the user agent server back to the 
    user agent client.    
48. User Agent Client (UAC): A user agent client is a logical entity that 
    creates a new request, and then uses the client transaction state machinery 
    to send it.  
49. UAC Core: The set of processing functions required of a UAC that reside 
    above the transaction and transport layers.    
50. User Agent Server (UAS): A user agent server is a logical entity that 
    generates a response to a SIP request.    
51. UAS Core: The set of processing functions required at a UAS that resides 
    above the transaction and transport layers.    
52. User Agent (UA): A logical entity that can act as both a user agent client 
    and user agent server.    

--> SIP Messages
         generic-message  =  start-line
                             *message-header
                             CRLF
                             [ message-body ]
         start-line       =  Request-Line / Status-Line

1. Requests
Request-Line  =  Method SP Request-URI SP SIP-Version CRLF
Method: This specification defines six methods: REGISTER for registering contact 
        information, INVITE, ACK, and CANCEL for setting up sessions, BYE for 
        terminating sessions, and OPTIONS for querying servers about their 
        capabilities.
Request-URI: The Request-URI is a SIP or SIPS URI
SIP-Version: Both request and response messages include the version of SIP in use           

2 Responses
Status-Line  =  SIP-Version SP Status-Code SP Reason-Phrase CRLF

SIP/2.0 allows six values for the first digit of response code:
1xx: Provisional -- request received, continuing to process the request;
2xx: Success -- the action was successfully received, understood, and accepted;
3xx: Redirection -- further action needs to be taken in order to complete the 
     request;
4xx: Client Error -- the request contains bad syntax or cannot be fulfilled at 
this server;
5xx: Server Error -- the server failed to fulfill an apparently valid request;
6xx: Global Failure -- the request cannot be fulfilled at any server.

--> Generating the Request
1 Request-URI
2 To
3 From
4 Call-ID
5 CSeq
6 Max-Forwards
7 Via
8 Contact
9 Supported and Require
10 Additional Message Components

--> Request Forwarding
1. Make a copy of the received request
2. Update the Request-URI
3. Update the Max-Forwards header field
4. Optionally add a Record-route header field value
5. Optionally add additional header fields
6. Postprocess routing information
7. Determine the next-hop address, port, and transport
8. Add a Via header field value
9. Add a Content-Length header field if necessary
10. Forward the new request
11. Set timer C

--> Response Processing
1. Find the appropriate response context
2. Update timer C for provisional responses
3. Remove the topmost Via
4. Add the response to the response context
5. Check to see if this response should be forwarded immediately
6. When necessary, choose the best final response from the response context
7. Aggregate authorization header field values if necessary
8. Optionally rewrite Record-Route header field values
9. Forward the response
10. Generate any necessary CANCEL requests


--> A Table of Timer Values
----------------------------------------------------------------------
Timer    Value            Section               Meaning
----------------------------------------------------------------------
T1       500ms default    Section 17.1.1.1     RTT Estimate
----------------------------------------------------------------------
T2       4s               Section 17.1.2.2     The maximum retransmit
                                               interval for non-INVITE
                                               requests and INVITE
                                               responses
----------------------------------------------------------------------                                               
T4       5s               Section 17.1.2.2     Maximum duration a
                                               message will
                                               remain in the network
----------------------------------------------------------------------                                               
Timer A  initially T1     Section 17.1.1.2     INVITE request retransmit
                                               interval, for UDP only
----------------------------------------------------------------------                                               
Timer B  64*T1            Section 17.1.1.2     INVITE transaction
                                               timeout timer
----------------------------------------------------------------------                                               
Timer C  > 3min           Section 16.6         proxy INVITE transaction
                           bullet 11            timeout
----------------------------------------------------------------------                           
Timer D  > 32s for UDP    Section 17.1.1.2     Wait time for response
         0s for TCP/SCTP                       retransmits
----------------------------------------------------------------------         
Timer E  initially T1     Section 17.1.2.2     non-INVITE request
                                               retransmit interval,
                                               UDP only
----------------------------------------------------------------------                                               
Timer F  64*T1            Section 17.1.2.2     non-INVITE transaction
                                               timeout timer
----------------------------------------------------------------------                                               
Timer G  initially T1     Section 17.2.1       INVITE response
                                               retransmit interval
----------------------------------------------------------------------                                               
Timer H  64*T1            Section 17.2.1       Wait time for
                                               ACK receipt
----------------------------------------------------------------------                                               
Timer I  T4 for UDP       Section 17.2.1       Wait time for
         0s for TCP/SCTP                       ACK retransmits
----------------------------------------------------------------------         
Timer J  64*T1 for UDP    Section 17.2.2       Wait time for
         0s for TCP/SCTP                       non-INVITE request
                                               retransmits
----------------------------------------------------------------------                                               
Timer K  T4 for UDP       Section 17.1.2.2     Wait time for
         0s for TCP/SCTP                       response retransmits
----------------------------------------------------------------------

**********************************************************************
    Session Initiation Protocol (SIP) Basic Call Flow Examples                          
**********************************************************************
--> SIP Registration
1.  Successful New Registration

    Bob                        SIP Server
     |                               |
     |          REGISTER F1          |
     |------------------------------>|
     |      401 Unauthorized F2      |
     |<------------------------------|
     |          REGISTER F3          |
     |------------------------------>|
     |            200 OK F4          |
     |<------------------------------|
     |                               |

   Bob sends a SIP REGISTER request to the SIP server.  The request
   includes the user's contact list.  This flow shows the use of HTTP
   Digest for authentication using TLS transport.  TLS transport is used
   due to the lack of integrity protection in HTTP Digest and the danger
   of registration hijacking without it, as described in RFC 3261 [1].
   The SIP server provides a challenge to Bob.  Bob enters her/his valid
   user ID and password.  Bob's SIP client encrypts the user information
   according to the challenge issued by the SIP server and sends the
   response to the SIP server.  The SIP server validates the user's
   credentials.  It registers the user in its contact database and
   returns a response (200 OK) to Bob's SIP client.  The response
   includes the user's current contact list in Contact headers.  The
   format of the authentication shown is HTTP digest.  It is assumed
   that Bob has not previously registered with this Server.


   Message Details

   F1 REGISTER Bob -> SIP Server

   REGISTER sips:ss2.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   Contact: <sips:bob@client.biloxi.example.com>
   Content-Length: 0

 F2 401 Unauthorized SIP Server -> Bob

   SIP/2.0 401 Unauthorized
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>;tag=1410948204
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   WWW-Authenticate: Digest realm="atlanta.example.com", qop="auth",
    nonce="ea9c8e88df84f1cec4341ae6cbe5a359",
    opaque="", stale=FALSE, algorithm=MD5
   Content-Length: 0


   F3 REGISTER Bob -> SIP Server

   REGISTER sips:ss2.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashd92
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=ja743ks76zlflH
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 2 REGISTER
   Contact: <sips:bob@client.biloxi.example.com>
   Authorization: Digest username="bob", realm="atlanta.example.com"
    nonce="ea9c8e88df84f1cec4341ae6cbe5a359", opaque="",
    uri="sips:ss2.biloxi.example.com",
    response="dfe56131d1958046689d83306477ecc"
   Content-Length: 0


   F4 200 OK SIP Server -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashd92
    ;received=192.0.2.201
   From: Bob <sips:bob@biloxi.example.com>;tag=ja743ks76zlflH
   To: Bob <sips:bob@biloxi.example.com>;tag=37GkEhwl6
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 2 REGISTER
   Contact: <sips:bob@client.biloxi.example.com>;expires=3600
   Content-Length: 0

2.  Update of Contact List

   Bob                        SIP Server
     |                               |
     |          REGISTER F1          |
     |------------------------------>|
     |            200 OK F2          |
     |<------------------------------|
     |                               |

   Bob wishes to update the list of addresses where the SIP server will
   redirect or forward INVITE requests.

   Bob sends a SIP REGISTER request to the SIP server.  Bob's request
   includes an updated contact list.  Since the user already has
   authenticated with the server, the user supplies authentication
   credentials with the request and is not challenged by the server. The
   SIP server validates the user's credentials.  It registers the user
   in its contact database, updates the user's contact list, and returns
   a response (200 OK) to Bob's SIP client.  The response includes the
   user's current contact list in Contact headers.


   Message Details

   F1 REGISTER Bob -> SIP Server

   REGISTER sips:ss2.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   Contact: mailto:bob@biloxi.example.com
   Authorization: Digest username="bob", realm="atlanta.example.com",
    qop="auth", nonce="1cec4341ae6cbe5a359ea9c8e88df84f", opaque="",
    uri="sips:ss2.biloxi.example.com",
    response="71ba27c64bd01de719686aa4590d5824"
   Content-Length: 0


   F2 200 OK SIP Server -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>;tag=34095828jh
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   Contact: <sips:bob@client.biloxi.example.com>;expires=3600
   Contact: <mailto:bob@biloxi.example.com>;expires=4294967295
   Content-Length: 0             

3.  Request for Current Contact List

   Bob                        SIP Server
     |                               |
     |          REGISTER F1          |
     |------------------------------>|
     |            200 OK F2          |
     |<------------------------------|
     |                               |


   Bob sends a register request to the Proxy Server containing no
   Contact headers, indicating the user wishes to query the server for
   the user's current contact list.  Since the user already has
   authenticated with the server, the user supplies authentication
   credentials with the request and is not challenged by the server.
   The SIP server validates the user's credentials.  The server returns
   a response (200 OK) which includes the user's current registration
   list in Contact headers.

   Message Details

   F1 REGISTER Bob -> SIP Server

   REGISTER sips:ss2.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   Authorization: Digest username="bob", realm="atlanta.example.com",
    nonce="df84f1cec4341ae6cbe5ap359a9c8e88", opaque="",
    uri="sips:ss2.biloxi.example.com",
    response="aa7ab4678258377c6f7d4be6087e2f60"
   Content-Length: 0


   F2 200 OK SIP Server -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>;tag=jqoiweu75
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   Contact: <sips:bob@client.biloxi.example.com>;expires=3600
   Contact: <mailto:bob@biloxi.example.com>;expires=4294967295
   Content-Length: 0     

4.  Cancellation of Registration

   Bob                         SIP Server
     |                               |
     |          REGISTER F1          |
     |------------------------------>|
     |            200 OK F2          |
     |<------------------------------|
     |                               |

   Bob wishes to cancel their registration with the SIP server.  Bob
   sends a SIP REGISTER request to the SIP server.  The request has an
   expiration period of 0 and applies to all existing contact locations.
   Since the user already has authenticated with the server, the user
   supplies authentication credentials with the request and is not
   challenged by the server.  The SIP server validates the user's
   credentials.  It clears the user's contact list, and returns a
   response (200 OK) to Bob's SIP client.

   Message Details

   F1 REGISTER Bob -> SIP Server

   REGISTER sips:ss2.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   Expires: 0
   Contact: *
   Authorization: Digest username="bob", realm="atlanta.example.com",
    nonce="88df84f1cac4341aea9c8ee6cbe5a359", opaque="",
    uri="sips:ss2.biloxi.example.com",
    response="ff0437c51696f9a76244f0cf1dbabbea"
   Content-Length: 0


   F2 200 OK SIP Server -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>;tag=1418nmdsrf
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   Content-Length: 0

5.  Unsuccessful Registration

   Bob                        SIP Server
     |                               |
     |          REGISTER F1          |
     |------------------------------>|
     |      401 Unauthorized F2      |
     |<------------------------------|
     |          REGISTER F3          |
     |------------------------------>|
     |      401 Unauthorized F4      |
     |<------------------------------|
     |                               |


   Bob sends a SIP REGISTER request to the SIP Server.  The SIP server
   provides a challenge to Bob.  Bob enters her/his user ID and
   password.  Bob's SIP client encrypts the user information according
   to the challenge issued by the SIP server and sends the response to
   the SIP server.  The SIP server attempts to validate the user's
   credentials, but they are not valid (the user's password does not
   match the password established for the user's account).  The server
   returns a response (401 Unauthorized) to Bob's SIP client.

   Message Details

   F1 REGISTER Bob -> SIP Server

   REGISTER sips:ss2.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   Contact: <sips:bob@client.biloxi.example.com>
   Content-Length: 0
 
   F2 Unauthorized SIP Server -> Bob

   SIP/2.0 401 Unauthorized
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sips:bob@biloxi.example.com>;tag=a73kszlfl
   To: Bob <sips:bob@biloxi.example.com>;tag=1410948204
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 1 REGISTER
   WWW-Authenticate: Digest realm="atlanta.example.com", qop="auth",
    nonce="f1cec4341ae6ca9c8e88df84be55a359",
    opaque="", stale=FALSE, algorithm=MD5
   Content-Length: 0


   F3 REGISTER Bob -> SIP Server

   REGISTER sips:ss2.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashd92
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=JueHGuidj28dfga
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 2 REGISTER
   Contact: <sips:bob@client.biloxi.example.com>
   Authorization: Digest username="bob", realm="atlanta.example.com",
    nonce="f1cec4341ae6ca9c8e88df84be55a359", opaque="",
    uri="sips:ss2.biloxi.example.com",
    response="61f8470ceb87d7ebf508220214ed438b"
   Content-Length: 0

   /*  The response above encodes the incorrect password */


   F4 401 Unauthorized SIP Server -> Bob

   SIP/2.0 401 Unauthorized
   Via: SIP/2.0/TLS client.biloxi.example.com:5061;branch=z9hG4bKnashd92
    ;received=192.0.2.201
   From: Bob <sips:bob@biloxi.example.com>;tag=JueHGuidj28dfga
   To: Bob <sips:bob@biloxi.example.com>;tag=1410948204
   Call-ID: 1j9FpLxk3uxtm8tn@biloxi.example.com
   CSeq: 2 REGISTER
   WWW-Authenticate: Digest realm="atlanta.example.com", qop="auth",
    nonce="84f1c1ae6cbe5ua9c8e88dfa3ecm3459",
    opaque="", stale=FALSE, algorithm=MD5
   Content-Length: 0    

--> SIP Session Establishment
1.  Successful Session Establishment

   Alice                     Bob
     |                        |
     |       INVITE F1        |
     |----------------------->|
     |    180 Ringing F2      |
     |<-----------------------|
     |                        |
     |       200 OK F3        |
     |<-----------------------|
     |         ACK F4         |
     |----------------------->|
     |   Both Way RTP Media   |
     |<======================>|
     |                        |
     |         BYE F5         |
     |<-----------------------|
     |       200 OK F6        |
     |----------------------->|
     |                        |

   In this scenario, Alice completes a call to Bob directly.

   Message Details

   F1 INVITE Alice -> Bob

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 180 Ringing Bob -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   Content-Length: 0


   F3 200 OK Bob -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F4 ACK Alice -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bd5
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* RTP streams are established between Alice and Bob */

   /* Bob Hangs Up with Alice. Note that the CSeq is NOT 2, since
      Alice and Bob maintain their own independent CSeq counts.
      (The INVITE was request 1 generated by Alice, and the BYE is
      request 1 generated by Bob) */


   F5 BYE Bob -> Alice

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F6 200 OK Alice -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sip:bob@biloxi.example.com>;tag=8321234356
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


2.  Session Establishment Through Two Proxies

   Alice           Proxy 1          Proxy 2            Bob
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|                |                |
     |     407 F2     |                |                |
     |<---------------|                |                |
     |     ACK F3     |                |                |
     |--------------->|                |                |
     |   INVITE F4    |                |                |
     |--------------->|   INVITE F5    |                |
     |     100  F6    |--------------->|   INVITE F7    |
     |<---------------|     100  F8    |--------------->|
     |                |<---------------|                |
     |                |                |     180 F9     |
     |                |    180 F10     |<---------------|
     |     180 F11    |<---------------|                |
     |<---------------|                |     200 F12    |
     |                |    200 F13     |<---------------|
     |     200 F14    |<---------------|                |
     |<---------------|                |                |
     |     ACK F15    |                |                |
     |--------------->|    ACK F16     |                |
     |                |--------------->|     ACK F17    |
     |                |                |--------------->|
     |                Both Way RTP Media                |
     |<================================================>|
     |                |                |     BYE F18    |
     |                |    BYE F19     |<---------------|
     |     BYE F20    |<---------------|                |
     |<---------------|                |                |
     |     200 F21    |                |                |
     |--------------->|     200 F22    |                |
     |                |--------------->|     200 F23    |
     |                |                |--------------->|
     |                |                |                |


   In this scenario, Alice completes a call to Bob using two proxies
   Proxy 1 and Proxy 2.  The initial INVITE (F1) contains a pre-loaded
   Route header with the address of Proxy 1 (Proxy 1 is configured as a
   default outbound proxy for Alice).  The request does not contain the
   Authorization credentials Proxy 1 requires, so a 407 Proxy
   Authorization response is sent containing the challenge information.
   A new INVITE (F4) is then sent containing the correct credentials and
   the call proceeds.  The call terminates when Bob disconnects by
   initiating a BYE message.
   Proxy 1 inserts a Record-Route header into the INVITE message to
   ensure that it is present in all subsequent message exchanges.  Proxy
   2 also inserts itself into the Record-Route header.  The ACK (F15)
   and BYE (F18) both have a Route header.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74b43
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 challenges Alice for authentication */

   F2 407 Proxy Authorization Required Proxy 1 -> Alice

   SIP/2.0 407 Proxy Authorization Required
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74b43
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=3flal12sf
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 INVITE
   Proxy-Authenticate: Digest realm="atlanta.example.com", qop="auth",
    nonce="f84f1cec41e6cbe5aea9c8e88d359",
    opaque="", stale=FALSE, algorithm=MD5
   Content-Length: 0

   F3 ACK Alice -> Proxy 1

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74b43
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=3flal12sf
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* Alice responds be re-sending the INVITE with authentication
      credentials in it. */

   F4 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="wf84f1ceczx41ae6cbe5aea9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="42ce3cef44b22f50c6a6071bc8"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 accepts the credentials and forwards the INVITE to Proxy
   2.  Client for Alice prepares to receive data on port 49172 from the
   network. */

   F5 INVITE Proxy 1 -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F6 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 INVITE
   Content-Length: 0

   F7 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 68
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
    From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F8 100 Trying Proxy 2 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 INVITE
   Content-Length: 0

   F9 180 Ringing Bob -> Proxy 2

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   CSeq: 2 INVITE
   Content-Length: 0

   F10 180 Ringing Proxy 2 -> Proxy 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   CSeq: 2 INVITE
   Content-Length: 0

   F11 180 Ringing Proxy 1 -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   CSeq: 2 INVITE
   Content-Length: 0

   F12 200 OK Bob -> Proxy 2

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F13 200 OK Proxy 2 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F14 200 OK Proxy 1 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.biloxi.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F15 ACK Alice -> Proxy 1

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74b76
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>,
    <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 ACK
   Content-Length: 0


   F16 ACK Proxy 1 -> Proxy 2

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74b76
    ;received=192.0.2.101
   Max-Forwards: 69
   Route: <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 ACK
   Content-Length: 0


   F17 ACK Proxy 2 -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74b76
    ;received=192.0.2.101
   Max-Forwards: 68
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 2 ACK
   Content-Length: 0

   /* RTP streams are established between Alice and Bob */

   /* Bob Hangs Up with Alice. */

   /* Again, note that the CSeq is NOT 3.  Alice and Bob maintain
      their own separate CSeq counts */


   F18 BYE Bob -> Proxy 2

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
   Max-Forwards: 70
   Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F19 BYE Proxy 2 -> Proxy 1

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   Max-Forwards: 69
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0
   
   F20 BYE Proxy 1 -> Alice

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   Max-Forwards: 68
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F21 200 OK Alice -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F22 200 OK Proxy 1 -> Proxy 2

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.101
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0

   F23 200 OK Proxy 2 -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 3848276298220188511@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


3.  Session with Multiple Proxy Authentication

     Alice        Proxy 1     Proxy 2         Bob
       |            |           |             |
       |  INVITE F1 |           |             |
       |----------->|           |             |
       |  407 Proxy Authorization Required F2 |
       |<-----------|           |             |
       |   ACK F3   |           |             |
       |----------->|           |             |
       |  INVITE F4 |           |             |
       |----------->|           |             |
       |   100 F5   |           |             |
       |<-----------| INVITE F6 |             |
       |            |---------->|             |
       |            |  407 Proxy Authorization Required F7
       |            |<----------|             |
       |            |   ACK F8  |             |
       |            |---------->|             |
       |  407 Proxy Authorization Required F9 |
       |<-----------|           |             |
       |   ACK F10  |           |             |
       |----------->|           |             |
       |  INVITE F11|           |             |
       |----------->|           |             |
       |   100 F12  |           |             |
       |<-----------| INVITE F13|             |
       |            |---------->|             |
       |            |  100 F14  |             |
       |            |<----------|  INVITE F15 |
       |            |           |------------>|
       |            |           | 200 OK F16  |
       |            | 200 OK F17|<------------|
       | 200 OK F18 |<----------|             |
       |<-----------|           |             |
       |   ACK F19  |           |             |
       |----------->|  ACK F20  |             |
       |            |---------->|   ACK F21   |
       |            |           |------------>|
       |           RTP Media Path             |
       |<====================================>|

   In this scenario, Alice completes a call to Bob using two proxies
   Proxy 1 and Proxy 2.  Alice has valid credentials in both domains.
   Since the initial INVITE (F1) does not contain the Authorization
   credentials Proxy 1 requires, so a 407 Proxy Authorization response
   is sent containing the challenge information. A new INVITE (F4) is
   then sent containing the correct credentials and the call proceeds
   after Proxy 2 challenges and receives valid credentials.  The call
   terminates when Bob disconnects by initiating a BYE message.

   Proxy 1 inserts a Record-Route header into the INVITE message to
   ensure that it is present in all subsequent message exchanges.  Proxy
   2 also inserts itself into the Record-Route header.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b03
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 challenges Alice for authentication */


   F2 407 Proxy Authorization Required Proxy 1 -> Alice

   SIP/2.0 407 Proxy Authorization Required
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b03
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=876321
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Proxy-Authenticate: Digest realm="atlanta.example.com", qop="auth",
    nonce="wf84f1cczx41ae6cbeaea9ce88d359",
    opaque="", stale=FALSE, algorithm=MD5
   Content-Length: 0
   
   F3 ACK Alice -> Proxy 1

   ACK sip:bob@biloxi.example.com SIP/2.0
   Max-Forwards: 70
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b03
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=876321
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* Alice responds be re-sending the INVITE with authentication
      credentials in it.  The same Call-ID is used, so the CSeq is
      increased. */


   F4 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b21
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="wf84f1ceczx41ae6cbe5aea9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="42ce3cef44b22f50c6a6071bc8"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 accepts the credentials and forwards the INVITE to Proxy
   2.  Client for Alice prepares to receive data on port 49172 from the
   network. */

   F5 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b21
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Content-Length: 0


   F6 INVITE Proxy 1 -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b21
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 2 challenges Alice for authentication */


   F7 407 Proxy Authorization Required Proxy 2 -> Proxy 1

   SIP/2.0 407 Proxy Authorization Required
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b21
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=838209
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Proxy-Authenticate: Digest realm="biloxi.example.com", qop="auth",
    nonce="c1e22c41ae6cbe5ae983a9c8e88d359",
    opaque="", stale=FALSE, algorithm=MD5
   Content-Length: 0


   F8 ACK Proxy 1 -> Proxy 2

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b21
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=838209
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 ACK
   Content-Length: 0

   /* Proxy 1 forwards the challenge to Alice for authentication from
   Proxy 2 */


   F9 407 Proxy Authorization Required Proxy 1 -> Alice

   SIP/2.0 407 Proxy Authorization Required
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b21
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=838209
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Proxy-Authenticate: Digest realm="biloxi.example.com", qop="auth",
    nonce="c1e22c41ae6cbe5ae983a9c8e88d359",
    opaque="", stale=FALSE, algorithm=MD5
   Content-Length: 0


   F10 ACK Alice -> Proxy 1

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b21
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=838209
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
     CSeq: 2 ACK
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="wf84f1ceczx41ae6cbe5aea9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="42ce3cef44b22f50c6a6071bc8"
   Content-Length: 0

   /* Alice responds be re-sending the INVITE with authentication
   credentials for Proxy 1 AND Proxy 2.  */


   F11 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="wf84f1ceczx41ae6cbe5aea9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="42ce3cef44b22f50c6a6071bc8"
   Proxy-Authorization: Digest username="alice",
    realm="biloxi.example.com",
    nonce="c1e22c41ae6cbe5ae983a9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com", response="f44ab22f150c6a56071bce8"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 finds its credentials and authorizes Alice, forwarding the
   INVITE to Proxy.  */
  
   F12 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 INVITE
   Content-Length: 0


   F13 INVITE Proxy 1 -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="biloxi.example.com",
    nonce="c1e22c41ae6cbe5ae983a9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com", response="f44ab22f150c6a56071bce8"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 2 finds its credentials and authorizes Alice, forwarding the
   INVITE to Bob.  */

   F14 100 Trying Proxy 2 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 INVITE
   Content-Length: 0


   F15 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK31972.1
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 68
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Bob answers the call immediately */

   F16 200 OK Bob -> Proxy 2

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK31972.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=9103874
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F17 200 OK Proxy 2 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=9103874
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F18 200 OK Proxy 1 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=9103874
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F19 ACK Alice -> Proxy 1

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b44
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>,
    <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=9103874
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 ACK
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="wf84f1ceczx41ae6cbe5aea9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="42ce3cef44b22f50c6a6071bc8"
   Proxy-Authorization: Digest username="alice",
    realm="biloxi.example.com",
    nonce="c1e22c41ae6cbe5ae983a9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com", response="f44ab22f150c6a56071bce8"
   Content-Length: 0


   F20 ACK Proxy 1 -> Proxy 2

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b44
    ;received=192.0.2.101
   Max-Forwards: 69
   Route: <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=9103874
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 ACK
   Contact: <sip:bob@client.biloxi.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="biloxi.example.com",
    nonce="c1e22c41ae6cbe5ae983a9c8e88d359", opaque="",
    uri="sip:bob@biloxi.example.com", response="f44ab22f150c6a56071bce8"
   Content-Length: 0


   F21 ACK Proxy 2 -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK31972.1
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK230f2.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b44
    ;received=192.0.2.101
   Max-Forwards: 68
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=9103874
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 3 ACK
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0
   
    

4.  Successful Session with Proxy Failure

    Alice           Proxy 1          Proxy 2            Bob
      |                |                |                |
      |   INVITE F1    |                |                |
      |--------------->|                |                |
      |   INVITE F2    |                |                |
      |--------------->|                |                |
      |   INVITE F3    |                |                |
      |--------------->|                |                |
      |   INVITE F4    |                |                |
      |--------------->|                |                |
      |   INVITE F5    |                |                |
      |--------------->|                |                |
      |   INVITE F6    |                |                |
      |--------------->|                |                |
      |   INVITE F7    |                |                |
      |--------------->|                |                |
      |     INVITE F8                   |                |
      |-------------------------------->|                |
      |            407 F9               |                |
      |<--------------------------------|                |
      |             ACK F10             |                |
      |-------------------------------->|                |
      |           INVITE F11            |                |
      |-------------------------------->|   INVITE F12   |
      |             100  F13            |--------------->|
      |<--------------------------------|                |
      |                                 |     180 F14    |
      |             180 F15             |<---------------|
      |<--------------------------------|                |
      |                                 |     200 F16    |
      |             200 F17             |<---------------|
      |<--------------------------------|                |
      |             ACK F18             |                |
      |-------------------------------->|     ACK F19    |
      |                                 |--------------->|
      |                Both Way RTP Media                |
      |<================================================>|
      |                                 |     BYE F20    |
      |             BYE F21             |<---------------|
      |<--------------------------------|                |
      |             200 F22             |                |
      |-------------------------------->|     200 F23    |
      |                                 |--------------->|
      |                                 |                |


   In this scenario, Alice completes a call to Bob via a Proxy Server.
   Alice is configured for a primary SIP Proxy Server Proxy 1 and a
   secondary SIP Proxy Server Proxy 2 (Or is able to use DNS SRV records
   to locate Proxy 1 and Proxy 2).  Alice has valid credentials for both
   domains.  Proxy 1 is out of service and does not respond to INVITEs
   (it is reachable, but unresponsive).  Alice then completes the call
   to Bob using Proxy 2.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK465b6d
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 INVITE Alice -> Proxy 1

   Same as Message F1


   F3 INVITE Alice -> Proxy 1

   Same as Message F1


   F4 INVITE Alice -> Proxy 1

   Same as Message F1

   F5 INVITE Alice -> Proxy 1

   Same as Message F1


   F6 INVITE Alice -> Proxy 1

   Same as Message F1


   F7 INVITE Alice -> Proxy 1

   Same as Message F1

   /* Alice gives up on the unresponsive proxy */


   F8 INVITE Alice -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b8a
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 2 challenges Alice for authentication */


   F9 407 Proxy Authorization Required Proxy 2 -> Alice

   SIP/2.0 407 Proxy Authorization Required
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b8a
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=2421452
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 1 INVITE
   Proxy-Authenticate: Digest realm="biloxi.example.com", qop="auth",
    nonce="1ae6cbe5ea9c8e8df84fqnlec434a359",
    opaque="", stale=FALSE, algorithm=MD5
   Content-Length: 0


   F10 ACK Alice -> Proxy 2

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b8a
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=2421452
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* Alice responds by re-sending the INVITE with authentication
   credentials in it.  */


   F11 INVITE Alice -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="biloxi.example.com",
    nonce="1ae6cbe5ea9c8e8df84fqnlec434a359", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="8a880c919d1a52f20a1593e228adf599"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 2 accepts the credentials and forwards the INVITE to Bob.
   Client for Alice prepares to receive data on port 49172 from the
   network.
   */


   F12 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F13 100 Trying Proxy 2 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 INVITE
   Content-Length: 0


   F14 180 Ringing Bob -> Proxy 2

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F15 180 Ringing Proxy 2 -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F16 200 OK Bob -> Proxy 2

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F17 200 OK Proxy 2 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F18 ACK Alice -> Proxy 2

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b8g
   Max-Forwards: 70
   Route: <sip:ss2.biloxi.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 ACK
   Content-Length: 0


   F19 ACK Proxy 2 -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b8g
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 2 ACK
   Content-Length: 0

   /* RTP streams are established between Alice and Bob */

   /* Bob Hangs Up with Alice. */


   F20 BYE Bob -> Proxy 2

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/UDP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
   Max-Forwards: 70
   Route: <sip:ss2.biloxi.example.com;lr>
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F21 BYE Proxy 2 -> Alice

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/UDP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   Max-Forwards: 69
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F22 200 OK Alice -> Proxy 2

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0

   F23 200 OK Proxy 2 -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.biloxi.example.com:5060;branch=z9hG4bKnashds7
    ;received=192.0.2.201
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 4Fde34wkd11wsGFDs3@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0

    


5.  Session Through a SIP ALG

   Alice             ALG           Proxy 2            Bob
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|   INVITE F2    |                |
     |     100 F3     |--------------->|   INVITE F4    |
     |<---------------|     100 F5     |--------------->|
     |                |<---------------|      180 F6    |
     |                |     180 F7     |<---------------|
     |     180 F8     |<---------------|                |
     |<---------------|                |      200 F9    |
     |                |    200 F10     |<---------------|
     |     200 F11    |<---------------|                |
     |<---------------|                                 |
     |     ACK F12    |                                 |
     |--------------->|             ACK F13             |
     |                |-------------------------------->|
     |    RTP Media   |        Both Way RTP Media       |
     |<==============>|<===============================>|
     |     BYE F14    |                                 |
     |--------------->|             BYE F15             |
     |                |-------------------------------->|
     |                |             200 F16             |
     |     200 F17    |<--------------------------------|
     |<---------------|                                 |
     |                |                                 |


   Alice completes a call to Bob through a ALG (Application Layer
   Gateway) and a SIP Proxy.  The routing through the ALG is
   accomplished using a pre-loaded Route header in the INVITE F1.  Note
   that the media stream setup is not end-to-end - the ALG terminates
   both media streams and bridges them.  This is done by the ALG
   modifying the SDP in the INVITE (F1) and 200 OK (F10) messages, and
   possibly any 18x or ACK messages containing SDP.

   In addition to firewall traversal, this Back-to-Back User Agent
   (B2BUA) could be used as part of an anonymizer service (in which all
   identifying information on Alice would be removed), or to perform
   codec media conversion, such as mu-law to A-law conversion of PCM on
   an international call.

   Also note that Proxy 2 does not Record-Route in this call flow.

   Message Details

   F1 INVITE Alice -> SIP ALG

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Route: <sip:alg1.atlanta.example.com;lr>
   Proxy-Authorization: Digest username="alice",
    realm="biloxi.example.com",
    nonce="85b4f1cen4341ae6cbe5a3a9c8e88df9", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="b3f392f9218a328b9294076d708e6815"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Client for Alice prepares to receive data on port 49172 from the
   network. */


   F2 INVITE SIP ALG -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="biloxi.example.com",
    nonce="85b4f1cen4341ae6cbe5a3a9c8e88df9", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="b3f392f9218a328b9294076d708e6815"
   Content-Type: application/sdp
   Content-Length: 150

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.128
   t=0 0
   m=audio 2000 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F3 100 Trying SIP ALG -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   /* SIP ALG prepares to proxy data from port 192.0.2.128/2000 to
   192.0.2.101/49172.   Proxy 2 uses a Location Service function to
   determine where Bob is located. Based upon location analysis the call
   is forwarded to Bob */


   F4 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
    ;received=192.0.2.128
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 68
   Record-Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 150

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.128
   t=0 0
   m=audio 2000 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F5 100 Trying Proxy 2 -> SIP ALG

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
    ;received=192.0.2.128
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F6 180 Ringing Bob -> Proxy 2

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
    ;received=192.0.2.128
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F7 180 Ringing Proxy 2 -> SIP ALG

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
    ;received=192.0.2.128
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F8 180 Ringing SIP ALG -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F9 200 OK Bob -> Proxy 2

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
    ;received=192.0.2.128
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F10 200 OK Proxy 2 -> SIP ALG

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
    ;received=192.0.2.128
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F11 200 OK SIP ALG -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.128
   t=0 0
   m=audio 1734 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* The ALG prepares to proxy packets from 192.0.2.128/
      1734 to 192.0.2.201/3456 */


   F12 ACK Alice -> SIP ALG

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bhh
   Max-Forwards: 70
   Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F13 ACK SIP ALG -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bhh
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* RTP streams are established between Alice and the ALG and
   between the ALG and B*/

   /* Alice Hangs Up with Bob. */


   F14 BYE Alice -> SIP ALG

   BYE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74be5
   Max-Forwards: 70
   Route: <sip:alg1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F15 BYE SIP ALG -> Bob

   BYE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74be5
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F16 200 OK Bob -> SIP ALG

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP alg1.atlanta.example.com:5060;branch=z9hG4bK739578.1
    ;received=192.0.2.128
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74be5
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F17 200 OK SIP ALG -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74be5
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 BYE
   Content-Length: 0


6.  Session via Redirect and Proxy Servers with SDP in ACK

   Alice        Redirect Server     Proxy 3             Bob
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|                |                |
     |     302 F2     |                |                |
     |<---------------|                |                |
     |     ACK F3     |                |                |
     |--------------->|                |                |
     |     INVITE F4                   |                |
     |-------------------------------->|    INVITE F5   |
     |             100  F6             |--------------->|
     |<--------------------------------|      180 F7    |
     |             180 F8              |<---------------|
     |<--------------------------------|                |
     |                                 |     200 F9     |
     |             200 F10             |<---------------|
     |<--------------------------------|                |
     |             ACK F11             |                |
     |-------------------------------->|     ACK F12    |
     |                                 |--------------->|
     |                Both Way RTP Media                |
     |<================================================>|
     |                                 |     BYE F13    |
     |             BYE F14             |<---------------|
     |<--------------------------------|                |
     |             200 F15             |                |
     |-------------------------------->|     200 F16    |
     |                                 |--------------->|
     |                                 |                |

   In this scenario, Alice places a call to Bob using first a Redirect
   server then a Proxy Server.  The INVITE message is first sent to the
   Redirect Server.  The Server returns a 302 Moved Temporarily response
   (F2) containing a Contact header with Bob's current SIP address.
   Alice then generates a new INVITE and sends to Bob via the Proxy
   Server and the call proceeds normally.  In this example, no SDP is
   present in the INVITE, so the SDP is carried in the ACK message.

   The call is terminated when Bob sends a BYE message.

   Message Details

   F1 INVITE Alice -> Redirect Server

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bKbf9f44
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Length: 0


   F2 302 Moved Temporarily Redirect Proxy -> Alice

   SIP/2.0 302 Moved Temporarily
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bKbf9f44
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=53fHlqlQ2
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@chicago.example.com;transport=tcp>
   Content-Length: 0


   F3 ACK Alice -> Redirect Server

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bKbf9f44
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=53fHlqlQ2
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F4 INVITE Alice -> Proxy 3

   INVITE sip:bob@chicago.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Length: 0


   F5 INVITE Proxy 3 -> Bob

   INVITE sip:bob@client.chicago.example.com SIP/2.0
   Via: SIP/2.0/TCP ss3.chicago.example.com:5060;branch=z9hG4bK721e.1
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss3.chicago.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Length: 0


   F6 100 Trying Proxy 3 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Content-Length: 0


   F7 180 Ringing Bob -> Proxy 3

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP ss3.chicago.example.com:5060;branch=z9hG4bK721e.1
    ;received=192.0.2.233
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss3.chicago.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.chicago.example.com;transport=tcp>
   Content-Length: 0
   F8 180 Ringing Proxy 3 -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss3.chicago.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.chicago.example.com;transport=tcp>
   Content-Length: 0


   F9 200 OK Bob -> Proxy 3

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss3.chicago.example.com:5060;branch=z9hG4bK721e.1
    ;received=192.0.2.233
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss3.chicago.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.chicago.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 148

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.chicago.example.com
   s=-
   c=IN IP4 192.0.2.100
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F10 200 OK Proxy -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss3.chicago.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 INVITE
   Contact: <sip:bob@client.chicago.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 148

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.chicago.example.com
   s=-
   c=IN IP4 192.0.2.100
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* ACK contains SDP of Alice since none present in INVITE */


   F11 ACK Alice -> Proxy 3

   ACK sip:bob@client.chicago.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bq9
   Max-Forwards: 70
   Route: <sip:ss3.chicago.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 ACK
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F12 ACK Proxy 3 -> Bob

   ACK sip:bob@client.chicago.example.com SIP/2.0
   Via: SIP/2.0/TCP ss3.chicago.example.com:5060;branch=z9hG4bK721e.1
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bq9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 ACK
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* RTP streams are established between Alice and Bob */

   /* Bob Hangs Up with Alice. */


   F13 BYE Bob -> Proxy 3

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP client.chicago.example.com:5060;branch=z9hG4bKfgaw2
   Max-Forwards: 70
   Route: <sip:ss3.chicago.example.com;lr>
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F14 BYE Proxy 3 -> Alice

   BYE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP ss3.chicago.example.com:5060;branch=z9hG4bK721e.1
    ;received=192.0.2.100
   Via: SIP/2.0/TCP client.chicago.example.com:5060;branch=z9hG4bKfgaw2
   Max-Forwards: 69
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F15 200 OK Alice -> Proxy 3

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss3.chicago.example.com:5060;branch=z9hG4bK721e.1
    ;received=192.0.2.233
   Via: SIP/2.0/TCP client.chicago.example.com:5060;branch=z9hG4bKfgaw2
    ;received=192.0.2.100
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F16 200 OK Proxy 3 -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.chicago.example.com:5060;branch=z9hG4bKfgaw2
    ;received=192.0.2.100
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 BYE
   Content-Length: 0


7.  Session with re-INVITE (IP Address Change)


     Alice                Proxy 2                Bob
        |   F1 INVITE        |                    |
        |------------------->|      F2 INVITE     |
        |   F3 100 Trying    |------------------->|
        |<-------------------|   F4 180 Ringing   |
        |   F5 180 Ringing   |<-------------------|
        |<-------------------|                    |
        |                    |    F6 200 OK       |
        |    F7 200 OK       |<-------------------|
        |<-------------------|                    |
        |                 F8  ACK                 |
        |---------------------------------------->|
        |      Both Way RTP Media Established     |
        |<=======================================>|
        |                                         |
        |           Bob changes IP address        |
        |                                         |
        |                 F9 INVITE               |
        |<----------------------------------------|
        |                F10 200 OK               |
        |---------------------------------------->|
        |                 F11  ACK                |
        |<----------------------------------------|
        |         New RTP Media Stream            |
        |<=======================================>|
        |                 F12 BYE                 |
        |---------------------------------------->|
        |               F13 200 OK                |
        |<----------------------------------------|
        |                                         |


   This example shows a session in which the media changes midway
   through the session.  When Bob's IP address changes during the
   session, Bob sends a re-INVITE containing a new Contact and SDP
   (version number incremented) information to A.  In this flow, the
   proxy does not Record-Route so is not in the SIP messaging path after
   the initial exchange.

   Message Details

   F1 INVITE Alice -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F3 100 Trying Proxy 2 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F4 180 Ringing Bob -> Proxy 2

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F5 180 Ringing Proxy 2 -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F6 200 OK Bob -> Proxy 2

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F7 200 OK Proxy 2 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Type: application/sdp
   Content-Length: 147

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=-
   c=IN IP4 192.0.2.201
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F8 ACK Alice -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74b7b
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0
   /* RTP streams are established between Alice and Bob */

   /* Bob changes IP address and re-INVITEs Alice with new Contact and
   SDP */


   F9 INVITE Bob -> Alice

   INVITE sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/UDP client.chicago.example.com:5060;branch=z9hG4bKlkld5l
   Max-Forwards: 70
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 14 INVITE
   Contact: <sip:bob@client.chicago.example.com>
   Content-Type: application/sdp
   Content-Length: 149

   v=0
   o=bob 2890844527 2890844528 IN IP4 client.chicago.example.com
   s=-
   c=IN IP4 192.0.2.100
   t=0 0
   m=audio 47172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F10 200 OK Alice -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.chicago.example.com:5060;branch=z9hG4bKlkld5l
    ;received=192.0.2.100
   Max-Forwards: 70
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 14 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 150

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 1000 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F11 ACK Bob -> Alice

   ACK sip:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/UDP client.chicago.example.com:5060;branch=z9hG4bKlkldcc
   Max-Forwards: 70
   From: Bob <sip:bob@biloxi.example.com>;tag=314159
   To: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 14 ACK
   Content-Length: 0

   /* New RTP stream established between Alice and Bob */

   /* Alice hangs up with Bob */


   F12 BYE Alice -> Bob

   BYE sip:bob@client.chicago.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bo4
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F13 200 OK Bob -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bo4
    ;received=192.0.2.101
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 2 BYE
   Content-Length: 0


8.  Unsuccessful No Answer

   Alice           Proxy 1          Proxy 2            Bob
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|   INVITE F2    |                |
     |     100  F3    |--------------->|   INVITE F4    |
     |<---------------|     100  F5    |--------------->|
     |                |<---------------|                |
     |                |                |      180 F6    |
     |                |     180 F7     |<---------------|
     |     180 F8     |<---------------|                |
     |<---------------|                |                |
     |   CANCEL F9    |                |                |
     |--------------->|                |                |
     |     200 F10    |                |                |
     |<---------------|   CANCEL F11   |                |
     |                |--------------->|                |
     |                |     200 F12    |                |
     |                |<---------------|                |
     |                |                |   CANCEL F13   |
     |                |                |--------------->|
     |                |                |     200 F14    |
     |                |                |<---------------|
     |                |                |     487 F15    |
     |                |                |<---------------|
     |                |                |     ACK F16    |
     |                |     487 F17    |--------------->|
     |                |<---------------|                |
     |                |     ACK F18    |                |
     |     487 F19    |--------------->|                |
     |<---------------|                |                |
     |     ACK F20    |                |                |
     |--------------->|                |                |
     |                |                |                |

   In this scenario, Alice gives up on the call before Bob answers
   (sends a 200 OK response).  Alice sends a CANCEL (F9) since no final
   response had been received from Bob.  If a 200 OK to the INVITE had
   crossed with the CANCEL, Alice would have sent an ACK then a BYE to
   Bob in order to properly terminate the call.

   Note that the CANCEL message is acknowledged with a 200 OK on a hop
   by hop basis, rather than end to end.


   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="ze7k1ee88df84f1cec431ae6cbe5a359", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="b00b416324679d7e243f55708d44be7b"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /*Client for Alice prepares to receive data on port 49172 from the
   network.*/


   F2 INVITE Proxy 1 -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F3 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F4 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   Max-Forwards: 68
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F5 100 Trying Proxy 2 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F6 180 Ringing Bob -> Proxy 2

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F7 180 Ringing Proxy 2 -> Proxy 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F8 180 Ringing Proxy 1 -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F9 CANCEL Alice -> Proxy 1

   CANCEL sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Route: <sip:ss1.atlanta.example.com;lr>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F10 200 OK Proxy 1 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 CANCEL
   Content-Length: 0

   F11 CANCEL Proxy 1 -> Proxy 2

   CANCEL sip:alice@atlanta.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F12 200 OK Proxy 2 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F13 CANCEL Proxy 2 -> Bob

   CANCEL sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F14 200 OK Bob -> Proxy 2

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 CANCEL
   Content-Length: 0

   F15 487 Request Terminated Bob -> Proxy 2

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F16 ACK Proxy 2 -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F17 487 Request Terminated Proxy 2 -> Proxy 1

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F18 ACK Proxy 1 -> Proxy 2

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F19 487 Request Terminated Proxy 1 -> Alice

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE


   F20 ACK Alice -> Proxy 1

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="ze7k1ee88df84f1cec431ae6cbe5a359", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="b00b416324679d7e243f55708d44be7b"
   CSeq: 1 ACK
   Content-Length: 0


9.  Unsuccessful Busy

   Alice           Proxy 1          Proxy 2            Bob
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|   INVITE F2    |                |
     |     100  F3    |--------------->|   INVITE F4    |
     |<---------------|     100  F5    |--------------->|
     |                |<---------------|                |
     |                |                |      486 F6    |
     |                |                |<---------------|
     |                |                |     ACK F7     |
     |                |      486 F8    |--------------->|
     |                |<---------------|                |
     |                |      ACK F9    |                |
     |     486 F10    |--------------->|                |
     |<---------------|                |                |
     |     ACK F11    |                |                |
     |--------------->|                |                |
     |                |                |                |


   In this scenario, Bob is busy and sends a 486 Busy Here response to
   Alice's INVITE.  Note that the non-2xx response is acknowledged on a
   hop-by-hop basis instead of end-to-end.  Also note that many SIP UAs
   will not return a 486 response, as they have multiple line and other
   features.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="dc3a5ab2530aa93112cf5904ba7d88fa", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="702138b27d869ac8741e10ec643d55be"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /*Client for Alice prepares to receive data on port 49172 from the
   network.*/


   F2 INVITE Proxy 1 -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F3 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F4 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 68
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F5 100 Trying Proxy 2 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F6 486 Busy Here Bob -> Proxy 2

   SIP/2.0  486 Busy Here
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1

    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F7 ACK Proxy 2 -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F8 486 Busy Here Proxy 2 -> Proxy 1

   SIP/2.0  486 Busy Here
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F9 ACK Proxy 1 -> Proxy 2

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0

   F10 486 Busy Here Proxy 1 -> Alice

   SIP/2.0  486 Busy Here
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F11 ACK Alice -> Proxy 1

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TCP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="dc3a5ab2530aa93112cf5904ba7d88fa", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="702138b27d869ac8741e10ec643d55be"
   Content-Length: 0


10.  Unsuccessful No Response from User Agent

   Alice           Proxy 1          Proxy 2            Bob
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|   INVITE F2    |                |
     |     100  F3    |--------------->|   INVITE F4    |
     |<---------------|     100  F5    |--------------->|
     |                |<---------------|   INVITE F6    |
     |                |                |--------------->|
     |                |                |   INVITE F7    |
     |                |                |--------------->|
     |                |                |   INVITE F8    |
     |                |                |--------------->|
     |                |                |   INVITE F9    |
     |                |                |--------------->|
     |                |                |   INVITE F10   |
     |                |                |--------------->|
     |                |                |   INVITE F11   |
     |                |     480 F12    |--------------->|
     |                |<---------------|                |
     |                |     ACK F13    |                |
     |     480 F14    |--------------->|                |
     |<---------------|                |                |
     |     ACK F15    |                |                |
     |--------------->|                |                |
     |                |                |                |


   In this example, there is no response from Bob to Alice's INVITE
   messages being re-transmitted by Proxy 2.  After the sixth
   re-transmission, Proxy 2 gives up and sends a 480 No Response to
   Alice.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="cf5904ba7d8dc3a5ab2530aa931128fa", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="7afc04be7961f053c24f80e7dbaf888f"
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /*Client for Alice prepares to receive data on port 49172 from the
   network.*/


   F2 INVITE Proxy 1 -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F3 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F4 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 68
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
   <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F5 100 Trying Proxy 2 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F6 INVITE Proxy 2 -> Bob

   Resend of Message F4


   F7 INVITE Proxy 2 -> Bob

   Resend of Message F4


   F8 INVITE Proxy 2 -> Bob

   Resend of Message F4


   F9 INVITE Proxy 2 -> Bob

   Resend of Message F4


   F10 INVITE Proxy 2 -> Bob

   Resend of Message F4


   F11 INVITE Proxy 2 -> Bob

   Resend of Message F4

   /* Proxy 2 gives up */


   F12 480 No Response Proxy 2 -> Proxy 1

   SIP/2.0 480 No Response
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F13 ACK Proxy 1 -> Proxy 2

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F14 480 No Response Proxy 1 -> Alice

   SIP/2.0 480 No Response
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F15 ACK Alice -> Proxy 1

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="cf5904ba7d8dc3a5ab2530aa931128fa", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="7afc04be7961f053c24f80e7dbaf888f"
   Content-Length: 0


11.  Unsuccessful Temporarily Unavailable

   Alice          Proxy 1          Proxy 2            Bob
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|   INVITE F2    |                |
     |     100  F3    |--------------->|   INVITE F4    |
     |<---------------|     100  F5    |--------------->|
     |                |<---------------|      180 F6    |
     |                |     180 F7     |<---------------|
     |     180 F8     |<---------------|                |
     |<---------------|                |     480 F9     |
     |                |                |<---------------|
     |                |                |     ACK F10    |
     |                |     480 F11    |--------------->|
     |                |<---------------|                |
     |                |     ACK F12    |                |
     |     480 F13    |--------------->|                |
     |<---------------|                |                |
     |     ACK F14    |                |                |
     |--------------->|                |                |
     |                |                |                |


   In this scenario, Bob initially sends a 180 Ringing response to
   Alice, indicating that alerting is taking place.  However, then a
   480 Unavailable is then sent to Alice.  This response is
   acknowledged then proxied back to Alice.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="aa9311cf5904ba7d8dc3a5ab253028fa", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="59a46a91bf1646562a4d486c84b399db"
   Content-Type: application/sdp

   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /*Client for Alice prepares to receive data on port 49172 from the
   network.*/


   F2 INVITE Proxy 1 -> Proxy 2

   INVITE sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F3 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F4 INVITE Proxy 2 -> Bob

   INVITE sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 68
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.atlanta.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=-
   c=IN IP4 192.0.2.101
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F5 100 Trying Proxy 2 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F6 180 Ringing Bob -> Proxy 2

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F7 180 Ringing Proxy 2 -> Proxy 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F8 180 Ringing Proxy 1 -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss2.biloxi.example.com;lr>,
    <sip:ss1.atlanta.example.com;lr>
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.biloxi.example.com>
   Content-Length: 0


   F9 480 Temporarily Unavailable Bob -> Proxy 2

   SIP/2.0 480 Temporarily Unavailable
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
    ;received=192.0.2.222
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F10 ACK Proxy 2 -> Bob

   ACK sip:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss2.biloxi.example.com:5060;branch=z9hG4bK721e4.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F11 480 Temporarily Unavailable Proxy 2 -> Proxy 1

   SIP/2.0 480 Temporarily Unavailable
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F12 ACK Proxy 1 -> Proxy 2

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.atlanta.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F13 480 Temporarily Unavailable Proxy 1 -> Alice

   SIP/2.0 480 Temporarily Unavailable
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F14 ACK Alice -> Proxy 1

   ACK sip:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:alice@atlanta.example.com>;tag=9fxced76sl
   To: Bob <sip:bob@biloxi.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@atlanta.example.com
   Proxy-Authorization: Digest username="alice",
    realm="atlanta.example.com",
    nonce="aa9311cf5904ba7d8dc3a5ab253028fa", opaque="",
    uri="sip:bob@biloxi.example.com",
    response="59a46a91bf1646562a4d486c84b399db"
   CSeq: 1 ACK
   Content-Length: 0


--> SIP  Service Examples
1.  Call Hold

            Alice           Proxy            Bob
             |    INVITE F1   |              |
             |--------------->|              |
             |                |   INVITE F2  |
             |(100 Trying) F3 |------------->|
             |<---------------|              |
             |                |180 Ringing F4|
             | 180 Ringing F5 |<-------------|
             |<---------------|              |
             |                |  200 OK F6   |
             |    200 OK F7   |<-------------|
             |<---------------|              |
             |     ACK F8     |              |
             |--------------->|    ACK F9    |
             |                |------------->|
             |    Both way RTP Established   |
             |<=============================>|
             |                |INVITE(hold) F10
             |INVITE(hold) F11|<-------------|
             |<---------------|              |
             |    200 OK F12  |              |
             |--------------->|   200 OK F13 |
             |                |------------->|
             |                |     ACK F14  |
             |     ACK F15    |<-------------|
             |<---------------|              |
             |           No RTP Sent!        |
             |                |  INVITE F16  |
             |   INVITE F17   |<-------------|
             |<---------------|              |
             |   200 OK F18   |              |
             |--------------->|  200 OK F19  |
             |                |------------->|
             |                |    ACK F20   |
             |     ACK F21    |<-------------|
             |<---------------|              |
             |    Both way RTP Established   |
             |<=============================>|
             |     BYE F22    |              |
             |--------------->|   BYE F23    |
             |                |------------->|
             |                |   200 OK F24 |
             |    200 OK F25  |<-------------|
             |<---------------|              |


   In this scenario, Alice calls Bob, then Bob places the call on hold.
   Bob then takes the call off hold, then Alice hangs up the call.  Note
   that hold is unidirectional in nature.  However, a UA that places the
   other party on hold will generally also stop sending media, resulting
   in no media exchange between the UAs.  Older UAs may set the
   connection address to 0.0.0.0 when initiating hold.  However, this
   behavior has been deprecated in favor or using the a=inactive SDP
   attribute if no media is sent, or the a=sendonly attribute if media
   is still sent.

   Also note the use of the rendering feature tag defined in RFC 4235
   [RFC4235] used in F10 and F11 to indicate that Bob's UA is no longer
   rendering media to Bob, i.e., that Bob has placed the call on hold.

   Message Details

      F1 INVITE Alice -> Proxy 1

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 INVITE Proxy 1 -> Bob

      INVITE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F3 (100 Trying) Proxy 1 -> Alice

      SIP/2.0 100 Trying
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F4 180 Ringing Bob -> Proxy 1

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159

      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content Length:0


      F5 180 Ringing Proxy 1 -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content Length: 0


      F6 200 OK Bob -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      F7 200 OK Proxy 1 -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F8 ACK Alice -> Proxy 1

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf92
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F9 ACK Proxy 1 -> Bob

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837492.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf92
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      /* Bob places Alice on hold.  Note that the version is
         incremented in the o= field of the SDP. */

      F10 INVITE Bob -> Proxy 1

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>;+sip.rendering="no"
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844528 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=sendonly


      F11 INVITE Proxy 1 -> Alice

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>;+sip.rendering="no"
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844528 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=sendonly


      /* Alice replies to hold. */

      F12 200 OK Alice -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...
      v=0
      o=alice 2890844526 2890844527 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=recvonly


      F13 200 OK Proxy 1 -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844527 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=recvonly


      F14 ACK Bob -> Proxy 1

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds72
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F15 ACK Proxy 1 -> Alice

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds72
       ;received=192.0.2.105
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      /* Bob takes the call off hold. */

      F16 INVITE Bob -> Proxy 1

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds73
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844529 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F17 INVITE Proxy 1 -> Alice

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837493.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds73
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844529 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F18 200 OK Alice -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837493.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds73
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 INVITE

      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844528 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F19 200 OK Proxy 1 -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds73
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844528 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F20 ACK Bob -> Proxy 1

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds74
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F21 ACK Proxy 1 -> Alice

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837494.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds74
       ;received=192.0.2.105
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      /* RTP Media stream re-established.  Alice disconnects. */

      F22 BYE Alice -> Proxy 1

      BYE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf97
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F23 BYE Proxy 1 -> Bob

      BYE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837497.1

      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf97
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F24 200 OK Bob -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837497.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf97
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F25 200 OK Proxy 1 -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf97
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


2.  Consultation Hold

           Alice            Proxy           Bob                Carol
             |                |              |                   |
             |    INVITE F1   |              |                   |
             |--------------->|   INVITE F2  |                   |
             |                |------------->|                   |
             |(100 Trying) F3 |              |                   |
             |<---------------|180 Ringing F4|                   |
             |                |<-------------|                   |
             | 180 Ringing F5 |              |                   |
             |<---------------|  200 OK F6   |                   |
             |                |<-------------|                   |
             |    200 OK F7   |              |                   |
             |<---------------|              |                   |
             |     ACK F8     |              |                   |
             |--------------->|     ACK F9   |                   |
             |                |------------->|                   |
             |     Both way RTP Established  |                   |
             |<=============================>|                   |
             |                |INVITE(hold) F10                  |
             |INVITE(hold) F11|<-------------|                   |
             |<---------------|              |                   |
             |    200 OK F12  |              |                   |
             |--------------->|   200 OK F13 |                   |
             |                |------------->|                   |
             |                |     ACK F14  |                   |
             |                |<-------------|                   |
             |    ACK F15     |              |                   |
             |<---------------|              |                   |
             |         No RTP Sent!          |                   |
             |                |   INVITE F16 |                   |
             |                |<-------------|                   |
             |                |              |    INVITE F17     |
             |                |--------------------------------->|
             |                |(100 Trying) F18                  |
             |                |------------->|                   |
             |                |              | 180 Ringing F19   |
             |                |<---------------------------------|
             |                | 180 Ringing F20                  |
             |                |------------->|                   |
             |                |              |    200 OK F21     |
             |                |<---------------------------------|
             |                |   200 OK F22 |                   |
             |                |------------->|                   |
             |                |    ACK F23   |                   |
             |                |<-------------|                   |
             |                |              |      ACK F24      |
             |                |--------------------------------->|
             |                |         Both way RTP Established |
             |                |              |<=================>|
             |                |   BYE F25    |                   |
             |                |<-------------|                   |
             |                |              |       BYE F26     |
             |                |--------------------------------->|
             |                |              |    200 OK F27     |
             |                |<---------------------------------|
             |                |   200 OK F28 |                   |
             |                |------------->|                   |
             |                |   INVITE F29 |                   |
             |    INVITE F30  |<-------------|                   |
             |<---------------|              |                   |
             |    200 OK F31  |              |                   |
             |--------------->|   200 OK F32 |                   |
             |                |------------->|                   |
             |                |     ACK F33  |                   |
             |                |<-------------|                   |
             |    ACK F34     |              |                   |
             |<---------------|              |                   |
             |     Both way RTP Established  |                   |
             |<=============================>|                   |
             |    BYE F35     |              |                   |
             |--------------->|    BYE F36   |                   |
             |                |------------->|                   |
             |                |   200 OK F37 |                   |
             |                |<-------------|                   |
             |  200 OK F38    |              |                   |
             |<---------------|              |                   |
             |                |              |                   |


   In this scenario, Alice calls Bob.  Bob places call on hold.  Bob
   calls Carol.  Bob then disconnects with Carol, then takes the call
   with Alice off hold.  The call ends when Alice hangs up.

   Also note the use of the rendering feature tag defined in RFC 4235
   [RFC4235] used in F10 to indicate that Bob's UA is no longer
   rendering media to Bob, i.e., that Bob has placed the call on hold.

   Message Details

      F1 INVITE Alice -> Proxy 1

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70

      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 INVITE Proxy 1 -> Bob

      INVITE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      F3 (100 Trying) Proxy 1 -> Alice

      SIP/2.0 100 Trying
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F4 180 Ringing Bob -> Proxy 1
      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content Length:0


      F5 180 Ringing Proxy 1 -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content Length: 0

      F6 200 OK Bob -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F7 200 OK Proxy 1 -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...


      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F8 ACK Alice -> Proxy 1

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf45
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F9 ACK Proxy 1 -> Bob

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837494.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf45
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      /* Bob places Alice on hold. */

      F10 INVITE Bob -> Proxy 1

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>;+sip.rendering="no"
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844528 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=sendonly


      F11 INVITE Proxy 1 -> Alice

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837497.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>;+sip.rendering="no"
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844528 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=sendonly


      F12 200 OK Alice -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837497.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844527 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=recvonly


      F13 200 OK Proxy 1 -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844527 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=recvonly


      F14 ACK Bob -> Proxy 1

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashdsg
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F15 ACK Proxy 1 -> Alice

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK8374.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashdsg
       ;received=192.0.2.105
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567

      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F16 INVITE Bob -> Proxy 1

      INVITE sips:carol@chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds22
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844834 2890844834 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 50170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F17 INVITE Proxy 1 -> Carol

      INVITE sips:carol@client.chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749a.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds22
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844834 2890844834 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 50170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F18 (100 Trying) Proxy 1 -> Bob

      SIP/2.0 100 Trying
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds22
       ;received=192.0.2.105
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F19 180 Ringing Carol -> Proxy 1
      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749a.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds22
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Content Length:0


      F20 180 Ringing Proxy 1 -> Bob

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds22
       ;received=client.chicago.example.com
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Content Length: 0


      F21 200 OK Carol -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749a.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds22
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890844922 2890844922 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F22 200 OK Proxy 1 -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds22
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890844922 2890844922 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F23 ACK Bob -> Proxy 1

      ACK sips:carol@client.chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds24
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F24 ACK Proxy 1 -> Carol

      ACK sips:carol@client.chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749b.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds24
       ;received=192.0.2.105
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 1 ACK

      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F25 BYE Bob -> Proxy 1

      BYE sips:carol@client.chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7j
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F26 BYE Proxy 1 -> Carol

      BYE sips:carol@client.chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749k.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7j
       ;received=192.0.2.105
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F27 200 OK Carol -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749k.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7j
       ;received=192.0.2.105
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F28 200 OK Proxy 1 -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7j
       ;received=192.0.2.105
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=456654
      Call-ID: 9876543210@biloxi.example.com
      CSeq: 2 BYE
      Content-Length: 0


      /* Bob takes the call off hold. */

      F29 INVITE Bob -> Proxy 1

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7b
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844529 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      F30 INVITE Proxy 1 -> Alice

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749q.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7b
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844529 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F31 200 OK Alice -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749q.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7b
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...


      v=0
      o=alice 2890844526 2890844528 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F32 200 OK Proxy 1 -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7b
       ;received=192.0.2.105
      Record-Route: <sips:ss1.example.com;lr>
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844528 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F33 ACK Bob -> Proxy 1

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7d7
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0

      F34 ACK Proxy 1 -> Alice

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK8374.1
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7d7
       ;received=192.0.2.105
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F35 BYE Alice -> Proxy 1

      BYE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf10
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F36 BYE Proxy 1 -> Bob

      BYE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK8379.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf10
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0

      F37 200 OK Bob -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK8379.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf10
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F38 200 OK Proxy 1 -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf10
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


3.  Music on Hold

           Alice             Bob       Music Server
             |                |              |
             |    INVITE F1   |              |
             |--------------->|              |
             | 180 Ringing F2 |              |
             |<---------------|              |
             |    200 OK F3   |              |
             |<---------------|              |
             |     ACK F4     |              |
             |--------------->|              |
             |       RTP      |              |
             |<==============>|              |
             |                |              |
             |   Bob places Alice on hold    |
             |                |              |
             | INVITE (hold) F5              |
             |<---------------|              |
             |    200 OK F6   |              |
             |--------------->|              |
             |     ACK F7     |              |
             |<---------------|              |
             |    no RTP      |              |
             |                |              |
             |  Bob initiates music on hold  |
             |                |              |
             |                |   REFER Refer-To: A F8
             |                |------------->|
             |                |    202 F9    |
             |                |<-------------|
             |                |   NOTIFY F10 |
             |                |<-------------|
             |                |    200 F11   |
             |                |------------->|
             |  INVITE F12 Replaces: B       |
             |<------------------------------|
             |          200 OK F13           |
             |------------------------------>|
             |           ACK F14             |
             |<------------------------------|
             |           RTP Music           |
             |<==============================|
             |     BYE F15    |              |
             |--------------->|  NOTIFY F17  |
             |  200 OK F16    |<-------------|
             |<---------------|  200 OK F18  |
             |                |------------->|
             |                |              |
             | The music on hold is complete |
             |                |              |
             |    Bob takes Alice off hold   |
             |                |              |
             |  INVITE Replaces: M F19       |
             |<---------------|              |
             |    200 OK F20  |              |
             |--------------->|              |
             |     ACK F21    |              |
             |<---------------|              |
             |       RTP      |              |
             |<==============>|              |
             |            BYE F22            |
             |------------------------------>|
             |          200 OK F23           |
             |<------------------------------|


   In this flow, Bob places Alice on hold with music.  This is performed
   by Bob sending a REFER to a Music Server that sends an INVITE with
   Replaces to Alice.  The Music Server then sends RTP music to Alice.
   Bob picks the call up from hold by sending an INVITE with Replaces to
   Alice.

   Note the use of the rendering feature tag defined in RFC 4235
   [RFC4235] used in F5 to indicate that Bob's UA is no longer rendering
   media to Bob, i.e., that Bob has placed the call on hold.  Feature
   tags are also used in F12 with the automaton (defined in RFC 3840
   [RFC3840]) and byeless feature tags (defined in RFC 4235 [RFC4235])
   to describe the capabilities of the Music Server.

   Should Alice not wish to receive music on hold, her UA could refuse
   F12 and she will remain on hold with Bob, but in silence.

   Message Details

     F1 INVITE Alice -> Bob

     INVITE sips:bob@biloxi.example.com SIP/2.0
     Via: SIP/2.0/TLS client.atlanta.example.com:5061
      ;branch=z9hG4bK74bf9
     Max-Forwards: 70
     From: Alice <sips:alice@atlanta.example.com>;tag=1234567
     To: Bob <sips:bob@biloxi.example.com>
     Call-ID: 12345600@atlanta.example.com
     CSeq: 1 INVITE
     Contact: <sips:a8342043f@atlanta.example.com;gr>
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
     Supported: replaces, gruu
     Content-Type: application/sdp
     Content-Length: ...

     v=0
     o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
     s=
     c=IN IP4 client.atlanta.example.com
     t=0 0
     m=audio 49170 RTP/AVP 0
     a=rtpmap:0 PCMU/8000


     F2 180 Ringing Bob -> Alice

     SIP/2.0 180 Ringing
     Via: SIP/2.0/TLS client.atlanta.example.com:5061
      ;branch=z9hG4bK74bf9
      ;received=192.0.2.103
     From: Alice <sips:alice@atlanta.example.com>;tag=1234567
     To: Bob <sips:bob@biloxi.example.com>;tag=23431
     Call-ID: 12345600@atlanta.example.com
     CSeq: 1 INVITE
     Contact: <sips:bob@client.biloxi.example.com>
     Content-Length: 0


     F3 200 OK Bob -> Alice

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS client.atlanta.example.com:5061
      ;branch=z9hG4bK74bf9
      ;received=192.0.2.103
     From: Alice <sips:alice@atlanta.example.com>;tag=1234567
     To: Bob <sips:bob@biloxi.example.com>;tag=23431
     Call-ID: 12345600@atlanta.example.com
     CSeq: 1 INVITE
     Contact: <sips:bob@client.biloxi.example.com>
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
     Supported: replaces
     Content-Type: application/sdp
     Content-Length: ...

     v=0
     o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
     s=
     c=IN IP4 client.biloxi.example.com
     t=0 0
     m=audio 3456 RTP/AVP 0
     a=rtpmap:0 PCMU/8000


     F4 ACK Alice -> Bob

     ACK sips:bob@client.biloxi.example.com SIP/2.0
     Via: SIP/2.0/TLS client.atlanta.example.com:5061
      ;branch=z9hG4bK74bfd
     Max-Forwards: 70
     From: Alice <sips:alice@atlanta.example.com>;tag=1234567
     To: Bob <sips:bob@biloxi.example.com>;tag=23431
     Call-ID: 12345600@atlanta.example.com
     CSeq: 1 ACK
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
     Supported: replaces
     Content-Length: 0


     /* Bob places Alice on hold. */

     F5 INVITE Bob -> Alice

     INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
     Via: SIP/2.0/TLS client.biloxi.example.com:5061
      ;branch=z9hG4bK874bk
     To: Alice <sips:alice@atlanta.example.com>;tag=1234567
     From: Bob <sips:bob@biloxi.example.com>;tag=23431
     Call-ID: 12345600@atlanta.example.com
     CSeq: 712 INVITE
     Contact: <sips:bob@client.biloxi.example.com>;+sip.rendering="no"
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
     Supported: replaces
     Content-Type: application/sdp
     Content-Length: ...

     v=0
     o=bob 2890844527 2890844528 IN IP4 client.biloxi.example.com
     s=
     c=IN IP4 client.biloxi.example.com
     t=0 0
     m=audio 3456 RTP/AVP 0
     a=rtpmap:0 PCMU/8000
     a=sendonly


     F6 200 OK Alice -> Bob

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS client.biloxi.example.com:5061
      ;branch=z9hG4bK874bk
      ;received=192.0.2.105
     To: Alice <sips:alice@atlanta.example.com>;tag=1234567
     From: Bob <sips:bob@biloxi.example.com>;tag=23431
     Call-ID: 12345600@atlanta.example.com
     CSeq: 712 INVITE
     Contact: <sips:a8342043f@atlanta.example.com;gr>
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
     Supported: replaces, gruu
     Content-Type: application/sdp
     Content-Length: ...

     v=0
     o=alice 2890844526 2890844527 IN IP4 client.atlanta.example.com
     s=
     c=IN IP4 client.atlanta.example.com
     t=0 0
     m=audio 49170 RTP/AVP 0
     a=rtpmap:0 PCMU/8000
     a=recvonly


     F7 ACK Bob -> Alice

     ACK sips:a8342043f@atlanta.example.com;gr SIP/2.0
     Via: SIP/2.0/TLS client.biloxi.example.com:5061
      ;branch=z9hG4bKq874b
     To: Alice <sips:alice@atlanta.example.com>;tag=1234567
     From: Bob <sips:bob@biloxi.example.com>;tag=23431
     Call-ID: 12345600@atlanta.example.com
     CSeq: 712 ACK
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
     Supported: replaces
     Content-Length: 0


     /* Bob REFERs Music Server to establish session with Alice
        which replaces the established session between Alice and Bob. */

     F8 REFER Bob -> Music Server

     REFER sips:music@server.example.com SIP/2.0
     Via: SIP/2.0/TLS client.biloxi.example.com:5061
      ;branch=z9hG4bKnashds9
     Max-Forwards: 70
     From: Bob <sips:bob@biloxi.example.com>;tag=02134
     To: Music Server <sips:music@server.example.com>
     Call-ID: 4802029847@biloxi.example.com
     CSeq: 1 REFER
   <allOneLine>
     Refer-To: <sips:a8342043f@atlanta.example.com;gr?Replaces=
     12345600%40atlanta.example.com%3Bfrom-tag%3D23431
     %3Bto-tag%3D1234567&Require=replaces>
   </allOneLine>
     Referred-By: <sips:bob@biloxi.example.com>
     Contact: <sips:bob@client.biloxi.example.com>
     Content-Length: 0


     F9 202 Accepted Music Server -> Bob

     SIP/2.0 202 Accepted
     Via: SIP/2.0/TLS client.biloxi.example.com:5061
      ;branch=z9hG4bKnashds9
      ;received=192.0.2.105
     From: Bob <sips:bob@biloxi.example.com>;tag=02134
     To: Music Server <sips:music@server.example.com>;tag=56323
     Call-ID: 4802029847@biloxi.example.com
     Contact: <sips:music@server.example.com>
     CSeq: 1 REFER
     Content-Length: 0


     F10 NOTIFY Music Server -> Bob

     NOTIFY sips:bob@client.biloxi.example.com SIP/2.0
     Via: SIP/2.0/TLS server.example.com:5061
      ;branch=z9hG4bK74bT6
     To: Bob <sips:bob@biloxi.example.com>;tag=02134
     Max-Forwards: 70
     From: Music Server <sips:music@server.example.com>;tag=56323
     Call-ID: 4802029847@biloxi.example.com
     CSeq: 1 NOTIFY
     Event: refer
     Subscription-State: active;expires=60
     Contact: <sips:music@server.example.com>
     Content-Type: message/sipfrag
     Content-Length: ...

     SIP/2.0 100 Trying

     F11 200 OK Bob -> Music Server

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS server.example.com:5061
      ;branch=z9hG4bK74bT6
      ;received=192.0.2.103
     To: Bob <sips:bob@biloxi.example.com>;tag=02134
     From: Music Server <sips:music@server.example.com>;tag=56323
     Call-ID: 4802029847@biloxi.example.com
     CSeq: 1 NOTIFY
     Content-Length: 0


     /* Music Server places call to Alice to replace session
        between Alice and Bob. */

     F12 INVITE Music Server -> Alice

     INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
     Via: SIP/2.0/TLS server.example.com:5061
      ;branch=z9hG4bK74rf
     Max-Forwards: 70
     From: <sips:music@server.example.com>;tag=0111
     To: <sips:a8342043f@atlanta.example.com;gr>
     Call-ID: a5-75-34-12-76@server.example.com
     CSeq: 1 INVITE
     Referred-By: <sips:bob@biloxi.example.com>
     Contact: <sips:music@server.example.com>;automaton
      ;+sip.byeless;+sip.rendering="no"
     Require: replaces
     Replaces: 12345600@atlanta.example.com
      ;from-tag=23431;to-tag=1234567
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
     Supported: replaces
     Content-Type: application/sdp
     Content-Length: ...

     v=0
     o=MusicServer 2890844576 2890844576 IN IP4 server.example.com
     s=
     c=IN IP4 server.example.com
     t=0 0
     m=audio 49170 RTP/AVP 0
     a=rtpmap:0 PCMU/8000
     a=sendonly

     F13 200 OK Alice -> Music Server

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS server.example.com:5061
      ;branch=z9hG4bK74rf
      ;received=192.0.2.103
     From: <sips:music@server.example.com>;tag=0111
     To: <sips:a8342043f@atlanta.example.com;gr>;tag=098594
     Call-ID: a5-75-34-12-76@server.example.com
     CSeq: 1 INVITE
     Contact: <sips:a8342043f@atlanta.example.com;gr>
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
     Supported: replaces, gruu
     Content-Type: application/sdp
     Content-Length: ...

     v=0
     o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
     s=
     c=IN IP4 client.atlanta.example.com
     t=0 0
     m=audio 49170 RTP/AVP 0
     a=rtpmap:0 PCMU/8000
     a=recvonly


     F14 ACK Music Server -> Alice

     ACK sips:a8342043f@atlanta.example.com;gr SIP/2.0
     Via: SIP/2.0/TLS server.example.com:5061
      ;branch=z9hG4bK7rfF
     Max-Forwards: 70
     From: <sips:music@server.example.com>;tag=0111
     To: <sips:a8342043f@atlanta.example.com;gr>;tag=098594
     Call-ID: a5-75-34-12-76@server.example.com
     CSeq: 1 ACK
     Content-Length: 0


     F15 BYE Alice -> Bob

     BYE sips:bob@client.biloxi.example.com SIP/2.0
     Via: SIP/2.0/TLS client.atlanta.example.com:5061
      ;branch=z9hG4bKnashds7
     Max-Forwards: 70
     From: Alice <sips:alice@atlanta.example.com>;tag=1234567
     To: Bob <sips:bob@biloxi.example.com>;tag=23431
     Call-ID: 12345600@atlanta.example.com
     CSeq: 2 BYE
     Content-Length: 0


     F16 200 OK Bob -> Alice

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS client.atlanta.example.com:5061
      ;branch=z9hG4bKnashds7
      ;received=192.0.2.105
     From: Alice <sips:alice@atlanta.example.com>;tag=1234567
     To: Bob <sips:bob@biloxi.example.com>;tag=23431
     Call-ID: 12345600@atlanta.example.com
     CSeq: 2 BYE
     Content-Length: 0


     /* Music Server reports success back to Bob by returning
        a 200 OK response.  Bob obtains the dialog identifiers
        from the headers included in the response. */

     F17 NOTIFY Music Server -> Bob

     NOTIFY sips:bob@client.biloxi.example.com SIP/2.0
     Via: SIP/2.0/TLS server.example.com:5061
      ;branch=z9hG4bK74bf9
     To: Bob <sips:bob@biloxi.example.com>;tag=02134
     Max-Forwards: 70
     From: Music Server <sips:music@server.example.com>;tag=56323
     Call-ID: 4802029847@biloxi.example.com
     CSeq: 2 NOTIFY
     Event: refer
     Subscription-State: terminated;reason=noresource
     Contact: <sips:music@server.example.com>
     Content-Type: message/sipfrag
     Content-Length: ...

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS server.example.com:5061
      ;branch=z9hG4bK74rf
      ;received=192.0.2.103
     From: <sips:music@server.example.com>;tag=0111
     To: <sips:a8342043f@atlanta.example.com;gr>;tag=098594
     Call-ID: a5-75-34-12-76@server.example.com
     CSeq: 1 INVITE
     Contact: <sips:a8342043f@atlanta.example.com;gr>

     F18 200 OK Bob -> Music Server

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS server.example.com:5061
      ;branch=z9hG4bK74bf9
      ;received=192.0.2.103
     To: Bob <sips:bob@biloxi.example.com>;tag=02134
     From: Music Server <sips:music@server.example.com>;tag=56323
     Call-ID: 4802029847@biloxi.example.com
     CSeq: 2 NOTIFY
     Content-Length: 0


     /* Alice is now parked at the Music Server. */

     /* Bob picks up the call by sending an INVITE to Alice, who
        replaces the existing session with the Music Server. */

     F19 INVITE Bob -> Alice

     INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
     Via: SIP/2.0/TLS client.biloxi.example.com:5061
      ;branch=z9hG4bK74bf9
     From: Bob <sips:bob@biloxi.example.com>;tag=4i323pr
     To: Alice <sips:a8342043f@atlanta.example.com;gr>
     Call-ID: uioewrjk2k2were
     CSeq: 42121 INVITE
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
      SUBSCRIBE, NOTIFY
     Replaces: a5-75-34-12-76@server.example.com
      ;to-tag=098594;from-tag=0111
     Contact: <sips:bob@client.biloxi.example.com>
     Supported: replaces
     Content-Type: application/sdp
     Content-Length: ...

     v=0
     o=bob 2890844631 2890844631 IN IP4 client.biloxi.example.com
     s=
     c=IN IP4 client.biloxi.example.com
     t=0 0
     m=audio 3458 RTP/AVP 0
     a=rtpmap:0 PCMU/8000
     a=sendrecv

     F20 200 OK Alice -> Bob

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS client.biloxi.example.com:5061
      ;branch=z9hG4bK74bf9
      ;received=192.0.2.105
     From: Bob <sips:bob@biloxi.example.com>;tag=4i323pr
     To: Alice <sips:a8342043f@atlanta.example.com;gr>;tag=6654323
     Call-ID: uioewrjk2k2were
     CSeq: 42121 INVITE
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
      SUBSCRIBE, NOTIFY
     Contact: <sips:alice@client.atlanta.example.com>
     Supported: replaces
     Content-Type: application/sdp
     Content-Length: ...

     v=0
     o=alice 2890844576 2890844576 IN IP4 client.atlanta.example.com
     s=
     c=IN IP4 client.atlanta.example.com
     t=0 0
     m=audio 49170 RTP/AVP 0
     a=rtpmap:0 PCMU/8000
     a=sendrecv


     F21 200 ACK Bob -> Alice

     ACK sips:alice@client.atlanta.example.com SIP/2.0
     Via: SIP/2.0/TLS client.biloxi.example.com:5061
      ;branch=z9hG4bKj974bf9
     From: Bob <sips:bob@biloxi.example.com>;tag=4i323pr
     To: Alice <sips:a8342043f@atlanta.example.com;gr>;tag=6654323
     Call-ID: uioewrjk2k2were
     CSeq: 42121 ACK
     Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
      SUBSCRIBE, NOTIFY
     Supported: replaces
     Content-Length: 0


     F22 BYE Alice -> Music Server

     BYE sips:music@server.example.com SIP/2.0
     Max-Forwards: 70
     Via: SIP/2.0/TLS client.atlanta.example.com:5061
      ;branch=z9hG4bK74rf
     To: <sips:music@server.example.com>;tag=0111
     From: <sips:a8342043f@atlanta.example.com;gr>;tag=098594
     Call-ID: a5-75-34-12-76@server.example.com
     CSeq: 15 BYE
     Content-Length: 0


     F23 200 OK Music Server -> Alice

     SIP/2.0 200 OK
     Via: SIP/2.0/TLS client.atlanta.example.com:5061
      ;branch=z9hG4bK74rf
      ;received=192.0.2.103
     To: <sips:music@server.example.com>;tag=0111
     From: <sips:a8342043f@atlanta.example.com;gr>;tag=098594
     Call-ID: a5-75-34-12-76@server.example.com
     CSeq: 15 BYE
     Content-Length: 0

     /* Normal media session between Alice and Bob is resumed. */


4.  Transfer - Unattended


          Alice                 Bob                 Carol
            |      INVITE F1     |                    |
            |<-------------------|                    |
            |   180 Ringing F2   |                    |
            |------------------->|                    |
            |      200 OK F3     |                    |
            |------------------->|                    |
            |        ACK F4      |                    |
            |<-------------------|                    |
            |        RTP         |                    |
            |<==================>|                    |
            |                    |                    |
            |  Alice performs unattended transfer     |
            |                    |                    |
            | REFER Refer-To:C F5|                    |
            |------------------->|                    |
            |  202 Accepted F6   |                    |
            |<-------------------|                    |
            |      NOTIFY F7     |                    |
            |<-------------------|                    |
            |      200 OK F8     |                    |
            |------------------->|                    |
            |       BYE F9       |                    |
            |------------------->|                    |
            |     200 OK F10     |                    |
            |<-------------------|                    |
            |   No RTP Session   | INVITE Referred-By: A F11
            |                    |------------------->|
            |                    |   180 Ringing F12  |
            |                    |<-------------------|
            |                    |     200 OK F13     |
            |                    |<-------------------|
            |                    |       ACK F14      |
            |                    |------------------->|
            |                    |        RTP         |
            |                    |<==================>|
            |      NOTIFY F15    |                    |
            |<-------------------|                    |
            |      200 OK F16    |                    |
            |------------------->|                    |
            |                    |                    |


   In this scenario, Bob calls Alice.  Alice then transfers Bob to
   Carol, then Alice disconnects with Bob.  Bob establishes the session
   to Carol then reports the success back to Alice in the NOTIFY in F15.
   If the transfer fails, Bob can send a new INVITE back to Alice to re-
   establish the session.

   Despite the BYE sent by Alice in F9, the dialog between Alice and Bob
   still exists until the subscription created by the REFER has
   terminated (either due to a NOTIFY containing a Subscription-State:
   terminated;reason=noresource header field, as in F15, or a 481
   response to a NOTIFY).

   For more about call transfer, see the transfer document [TRANSFER].

   Message Details

      F1 INVITE Bob -> Alice

      INVITE sips:alice@atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 180 Ringing Alice -> Bob

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Content-Length: 0


      F3 200 OK Alice -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F4 ACK Bob -> Alice

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds2
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      /* Session is established between Alice and Bob. */
      /* Alice performs unattended transfer of Bob to Carol. */


      F5 REFER Alice -> Bob

      REFER sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds8
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 101 REFER
      Refer-To: <sips:carol@chicago.example.com>
      Referred-By: <alice@atlanta.example.com>
      Contact: <sips:alice@client.atlanta.example.com>
      Content-Length: 0


      F6 202 Accepted Bob -> Alice

      SIP/2.0 202 Accepted
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds8
       ;received=192.0.2.105
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      Contact: <sips:bob@client.biloxi.example.com>
      CSeq: 101 REFER
      Content-Length: 0


      F7 NOTIFY Bob -> Alice

      NOTIFY sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds32
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 NOTIFY
      Event: refer
      Subscription-State: active;expires=60
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Type: message/sipfrag
      Content-Length: ...


      SIP/2.0 100 Trying


      F8 200 OK Alice -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds32
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 2 NOTIFY
      Content-Length: 0


      /* Alice now disconnects with Bob. */


      F9 BYE Alice -> Bob

      BYE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds43
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 102 BYE
      Content-Length: 0


      F10 200 OK Bob -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds43
       ;received=192.0.2.105
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 102 BYE
      Content-Length: 0

      /* Bob attempts the transfer to Carol. */
      F11 INVITE Bob -> Carol

      INVITE sips:carol@chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds1
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Referred-By: <alice@atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844539 2890844539 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3458 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F12 180 Ringing Carol -> Bob

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds1
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=928287
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Content-Length: 0


      F13 200 OK Carol -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds1
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=928287
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890944542 2890844542 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F14 ACK Bob -> Carol

      ACK sips:carol@client.chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds9
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=928287
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      /* Bob and Carol now have established a session.  Bob reports
         success to Alice, which Alice probably ignores. */


      F15 NOTIFY Bob -> Alice

      NOTIFY sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds67
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 3 NOTIFY
      Event: refer
      Subscription-State: terminated;reason=noresource
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Type: message/sipfrag

      Content-Length: ...

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds1
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=928287
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Content-Type: application/sdp
      Content-Length: ...


      F16 200 OK Alice -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds6
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=314159
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345601@atlanta.example.com
      CSeq: 3 NOTIFY
      Content-Length: 0


5.  Transfer - Attended

           Alice             Bob          Carol
             |                |              |
             |    INVITE F1   |              |
             |--------------->|              |
             | 180 Ringing F2 |              |
             |<---------------|              |
             |    200 OK F3   |              |
             |<---------------|              |
             |     ACK F4     |              |
             |--------------->|              |
             |       RTP      |              |
             |<==============>|              |
             |INVITE (hold) F5|              |
             |<---------------|              |
             |    200 OK F6   |              |
             |--------------->|              |
             |     ACK F7     |              |
             |<---------------|              |
             |     No RTP     |              |
             |                |  INVITE F8   |
             |                |------------->|
             |                | 180 Ringing F9
             |                |<-------------|
             |                |  200 OK F10  |
             |                |<-------------|
             |                |    ACK F11   |
             |                |------------->|
             |                |     RTP      |
             |                |<============>|
             |                |INVITE (hold) F12
             |                |------------->|
             |                | 200 OK F13   |
             |                |<-------------|
             |                |    ACK F14   |
             |                |------------->|
             |                |     No RTP   |
             | REFER Refer-To: C F15         |
             |<---------------|              |
             |202 Accepted F16|              |
             |--------------->|              |
             |   NOTIFY F17   |              |
             |--------------->|              |
             |   200 OK F18   |              |
             |<---------------|              |
             |     INVITE Replaces: B F19    |
             |------------------------------>|
             |            200 OK F20         |
             |<------------------------------|
             |             ACK F21           |
             |------------------------------>|
             |               RTP             |
             |<=============================>|
             |                |    BYE F22   |
             |                |<-------------|
             |                |  200 OK F23  |
             |                |------------->|
             |   NOTIFY F24   |              |
             |--------------->|              |
             |   200 OK F25   |              |
             |<---------------|              |
             |    BYE F26     |              |
             |<---------------|              |
             |   200 OK F27   |              |
             |--------------->|              |

   In this scenario, Alice calls Bob.  Bob puts Alice on hold then calls
   Carol to announce transfer, then places Carol on hold.  Bob transfers
   Alice to Carol, which replaces the session between Bob and Carol.
   Carol then disconnects session with Bob.  Alice reports success of
   transfer to Bob, who then disconnects with Alice.  In this example,
   the Replaces header field [RFC3891] is inserted into the Refer-To URI
   by Bob.  Note that the Refer-To URI is the Contact URI returned by
   Carol in the 200 OK response F10.  This ensures that only the correct
   instance of Carol is reached.  The presence of the gr URI parameter
   in the Contact URI in message F10 indicates that the Contact URI is a
   GRUU [GRUU] and will be globally routable outside of the dialog.
   Without knowing the Contact URI is a gruu, Bob must be prepared, if
   the triggered INVITE had failed, to retry the REFER with a Refer-To
   URI of the URI used to reach Carol but with a Require: replaces
   header escaped in the Refer-To header field, as discussed in the
   transfer document [TRANSFER].

   Message Details

      F1 INVITE Alice -> Bob

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 180 Ringing Bob -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Length: 0


      F3 200 OK Bob -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F4 ACK Alice -> Bob

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      /* Alice and Bob have established a session.
         Bob puts Alice on hold. */


      F5 INVITE Bob -> Alice

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 INVITE
      Contact: <sips:bob@client.biloxi.example.com>;+sip.rendering="no"
      Content-Type: application/sdp
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844528 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=sendonly


      F6 200 OK Alice -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844527 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=recvonly


      F7 ACK Bob -> Alice

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds3
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 ACK
      Content-Length: 0

      /* Bob calls Carol. */

      F8 INVITE Bob -> Carol

      INVITE sips:carol@chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 28908445834 2890844834 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3458 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F9 180 Ringing Carol -> Bob

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 INVITE
      Contact: <sips:39itp34klkd@chicago.example.com>
      Content-Length: 0


      F10 200 OK Carol -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 INVITE
      Contact: <sips:39itp34klkd@chicago.example.com;gr>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890844922 2890844922 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F11 ACK Bob -> Carol

      ACK sips:39itp34klkd@chicago.example.com;gr SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashd5
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 ACK
      Content-Length: 0

      /* Bob puts Carol on hold. */


      F12 INVITE Bob -> Carol

      INVITE sips:39itp34klkd@chicago.example.com;gr SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds0
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 43 INVITE
      Contact: <sips:bob@client.biloxi.example.com>;+sip.rendering="no"
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 289084834 2890844835 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3458 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=sendonly


      F13 200 OK Carol -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds0
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 43 INVITE
      Contact: <sips:39itp34klkd@chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890844922 2890844923 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000
      a=recvonly


      F14 ACK Bob -> Carol

      ACK sips:39itp34klkd@chicago.example.com;gr SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash334
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 43 ACK
      Content-Length: 0

      /* Bob transfers Alice to Carol. */


      F15 REFER Bob -> Alice

      REFER sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds2g
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1025 REFER
    <allOneLine>
      Refer-To: <sips:39itp34klkd@chicago.example.com?Replaces=
      sdjfdjfskdf%40biloxi.example.com%3Bto-tag%3D5f35a3
      %3Bfrom-tag%3D8675309&Require=replaces>
    </allOneLine>
      Referred-By: <sips:bob@biloxi.example.com>
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Length: 0


      F16 202 Accepted Alice -> Bob

      SIP/2.0 202 Accepted
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds2g
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      Contact: <sips:alice@client.atlanta.example.com>
      CSeq: 1025 REFER
      Content-Length: 0


      F17 NOTIFY Alice -> Bob

      NOTIFY sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfK
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 NOTIFY
      Contact: <sips:alice@client.atlanta.example.com>
      Event: refer
      Subscription-State: active;expires=60
      Content-Type: message/sipfrag
      Content-Length: ...

      SIP/2.0 100 Trying


      F18 200 OK Bob -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfK
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 NOTIFY
      Content-Length: 0

      /* Alice establishes session with Carol, which replaces the
         session between Bob and Carol. */


      F19 INVITE Alice -> Carol

      INVITE sips:39itp34klkd@chicago.example.com;gr SIP/2.0
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKadfe4ko
      To: Carol <sips:39itp34klkd@chicago.example.com>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=3461
      Call-ID: 9435674543@atlanta.example.com
      CSeq: 1 INVITE
      Require: replaces
      Referred-By: <sips:bob@biloxi.example.com>
      Replaces: sdjfdjfskdf@biloxi.example.com
       ;to-tag=5f35a3;from-tag=8675309
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844989 2890844989 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 3458 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F20 200 OK Carol -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKadfe4ko
       ;received=192.0.2.103
      To: Carol <sips:39itp34klkd@chicago.example.com>;tag=ff3a
      From: Alice <sips:alice@atlanta.example.com>;tag=3461
      Call-ID: 9435674543@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:39itp34klkd@chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890844221 2890844221 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 49172 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F21 ACK Alice -> Carol

      ACK sips:39itp34klkd@chicago.example.com;gr SIP/2.0
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKadfe4kU3
      To: Carol <sips:39itp34klkd@chicago.example.com>;tag=ff3a
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=3461
      Call-ID: 9435674543@atlanta.example.com
      CSeq: 1 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0

      /* Carol then disconnects from Bob. */


      F22 BYE Carol -> Bob

      BYE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfE
      To: Bob <sips:bob@biloxi.example.com>;tag=8675309
      Max-Forwards: 70
      From: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 1 BYE
      Content-Length: 0


      F23 200 OK Bob -> Carol

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfE
       ;received=192.0.2.123
      To: Bob <sips:bob@biloxi.example.com>;tag=8675309
      From: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 1 BYE
      Content-Length: 0


      /* Alice tells Bob that the call has been
         successfully transferred. */

      F24 NOTIFY Alice -> Bob

      NOTIFY sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf2N
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 3 NOTIFY
      Event: refer
      Subscription-State: terminated;reason=noresource
      Contact: <sips:alice@client.atlanta.example.com>
      Content-Type: message/sipfrag
      Content-Length: ...

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKadfe4ko
       ;received=192.0.2.103
      To: Carol <sips:39itp34klkd@chicago.example.com>;tag=ff3a
      From: Alice <sips:alice@atlanta.example.com>;tag=3461
      Call-ID: 9435674543@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:39itp34klkd@chicago.example.com>


      F25 200 OK Bob -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 3 NOTIFY
      Content-Length: 0

      /* Bob disconnects with Alice. */


      F26 BYE Bob -> Alice

      BYE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7P
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1026 BYE
      Content-Length: 0


      F27 200 OK Alice -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7P
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1026 BYE
      Content-Length: 0


6.  Transfer - Instant Messaging


            Alice          Bob                Carol
             |              |                   |
             |   INVITE F1  |                   |
             |------------->|                   |
             | 180 Ringing F2                   |
             |<-------------|                   |
             |  200 OK F3   |                   |
             |<-------------|                   |
             |    ACK F4    |                   |
             |------------->|                   |
             |  Both way RTP Established        |
             |<============>|                   |
             |              |     MESSAGE F5    |
             |              |------------------>|
             |              |     200 OK F6     |
             |              |<------------------|
             |              |                   |
             |       INVITE Replaces:A-B F7     |
             |<---------------------------------|
             |            200 OK F8             |
             |--------------------------------->|
             |               ACK F9             |
             |<---------------------------------|
             |   Both way RTP Established       |
             |<================================>|
             |    BYE F10   |                   |
             |------------->|                   |
             |  200 OK F11  |                   |
             |<-------------|                   |
             |                                  |


   In this scenario, Alice and Bob establish a session between them.
   Bob wants Carol to take the call and so sends an Instant Message (IM)
   to Carol containing Alice's URI and an embedded Replaces header
   field.  If Carol clicks on the URI, Carol's SIP UA sends an INVITE to
   Alice, which replaces the session with Bob.

   This scenario shows the use of the SIP MESSAGE [RFC3428] method to
   pass the URI.  However, another IM protocol or other method could
   have been used to pass the URI from Bob to Carol.

   Message Details

      F1 INVITE Alice -> Bob
      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:a8342043f@atlanta.example.com;gr>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 180 Ringing Bob -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Length: 0

      F3 200 OK Bob -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      Contact: <sips:bob@client.biloxi.example.com>
      CSeq: 1 INVITE
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY, MESSAGE
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F4 ACK Alice -> Bob

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74r
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      CSeq: 1 ACK
      Content-Length: 0

      /* Bob IMs Carol. */


      F5 MESSAGE Bob -> Carol

      MESSAGE sips:carol@chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 MESSAGE
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY, MESSAGE
      Supported: replaces
      Content-Type: text/html
      Content-Length: ...

      <HTML>Do you want to take this call from
    <allOneLine>
      <A HREF="sips:a8342043f@atlanta.example.com;gr?Replaces=
      12345600@atlanta.example.com%3Bto-tag%3D3145678
      %3Bfrom-tag%3D1234567&Require=replaces">
      Alice</A>?
    </allOneLine>
       </HTML>


      F6 200 OK Carol -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=5f35a3
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 MESSAGE
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY, MESSAGE
      Supported: replaces
      Content-Length: 0

      /* Carol takes the call from Bob. */


      F7 INVITE  Carol -> Alice

      INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
      Via: SIP/2.0/TLS pc.biloxi.example.com:5061
       ;branch=z9hG4bK74HH
      Max-Forwards: 70
      From: Carol <sips:carol@chicago.example.com>;tag=8675310
      To: Alice <sips:a8342043f@atlanta.example.com;gr>
      Call-ID: 563456212@b2.chicago.example.com
      CSeq: 1 INVITE
      Require: replaces

      Replaces: 12345600@atlanta.example.com
       ;to-tag=3145678;from-tag=1234567
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY, MESSAGE
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890843122 2890843122 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 5342 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      /* Alice matches the dialog information in the
         Replaces header and accepts the INVITE. */


      F8 200 OK Alice -> Carol

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS pc.biloxi.example.com:5061
       ;branch=z9hG4bK74HH
       ;received=192.0.2.114
      From: Carol <sips:carol@chicago.example.com>;tag=8675310
      To: Alice <sips:a8342043f@atlanta.example.com;gr>;tag=131256
      Call-ID: 563456212@b2.chicago.example.com
      CSeq: 1 INVITE
      Contact: <sips:a8342043f@atlanta.example.com;gr>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 289084543 289084543 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49172 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F9 ACK  Carol -> Alice

      ACK sips:a8342043f@atlanta.example.com;gr SIP/2.0
      Via: SIP/2.0/TLS b2.biloxi.example.com:5061
       ;branch=z9hG4bK7435
      Max-Forwards: 70
      From: Carol <sips:carol@chicago.example.com>;tag=8675310
      To: Alice <sips:a8342043f@atlanta.example.com;gr>;tag=131256
      Call-ID: 563456212@b2.chicago.example.com
      CSeq: 1 ACK
      Content-Length: 0


      /* RTP streams are established between Alice and Carol.
         Alice hangs up with Bob due to the Replaces header field. */


      F10 BYE Alice -> Bob

      BYE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F11 200 OK Bob -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      CSeq:  2 BYE
      Content-Length: 0


7.  Call Forwarding Unconditional


            Alice           Proxy          Gateway
             |                |              |
             |    INVITE F1   |              |
             |--------------->|              |
             |(100 Trying) F2 |              |
             |<---------------|              |
             | (181 Call Is Being Forwarded) F3
             |<---------------|   INVITE F4  |
             |                |------------->|
             |                |180 Ringing F5|
             | 180 Ringing F6 |<-------------|
             |<---------------|  200 OK F7   |
             |    200 OK F8   |<-------------|
             |<---------------|              |
             |     ACK F9     |              |
             |--------------->|    ACK F10   |
             |                |------------->|
             |    Both way RTP Established   |
             |<=============================>|
             |     BYE F11    |              |
             |--------------->|   BYE F12    |
             |                |------------->|
             |                |   200 OK F13 |
             |    200 OK F14  |<-------------|
             |<---------------|              |
             |                |              |


   Bob wants all calls forwarded to the Public Switched Telephone
   Network (PSTN) (which is just another URI to the proxy server).
   Alice calls Bob.  The proxy server rewrites the Request URI, and
   forwards the INVITE to a Gateway.  Details of messaging behind the
   Gateway are not shown.

   Note that the 181 Call is Being Forwarded response is shown as sent
   by the proxy.  Strictly speaking, the proxy is behaving as a user
   agent in this case as a proxy cannot generate non-100 provisional
   responses.

   Note also that forwarding could be accomplished using a redirect (302
   Moved Temporarily response).

   Message Details

      F1 INVITE Alice -> Proxy
      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 (100 Trying) Proxy -> Alice

      SIP/2.0 100 Trying
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F3 (181 Call is Being Forwarded) Proxy -> Alice

      SIP/2.0 181 Call is Being Forwarded
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=9214d
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0

      /* Proxy forwards call by rewriting Request-URI. */


      F4 INVITE Proxy -> Gateway

      INVITE sips:+19727293660@gw1.example.com;user=phone SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F5 180 Ringing Gateway -> Proxy

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com

      CSeq: 1 INVITE
      Contact: <sips:+19727293660@gw1.example.com;user=phone>
      Content Length:0


      F6 180 Ringing Proxy -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:+19727293660@gw1.example.com;user=phone>
      Content Length: 0


      F7 200 OK Gateway -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:+19727293660@gw1.example.com;user=phone>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=GATEWAY1 2890844527 2890844527 IN IP4 gatewayone.example.com
      s=
      c=IN IP4 gatewayone.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      F8 200 OK Proxy -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:+19727293660@gw1.example.com;user=phone>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=GATEWAY1 2890844527 2890844527 IN IP4 gatewayone.example.com
      s=
      c=IN IP4 gatewayone.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F9 ACK Alice -> Proxy

      ACK sips:+19727293660@gw1.example.com;user=phone SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf31
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F10 ACK Proxy -> Gateway

      ACK sips:+19727293660@gw1.example.com;user=phone SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749ws.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf31
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F11 BYE Alice -> Proxy

      BYE sips:+19727293660@gw1.example.com;user=phone SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfJe
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F12 BYE Proxy -> Gateway

      BYE sips:+19727293660@gw1.example.com;user=phone SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749G1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfJe
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F13 200 OK Gateway -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749G1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfJe
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F14 200 OK Proxy -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfJe
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 12345600@atlanta.example.com
      CSeq:  2 BYE
      Content-Length: 0


8.  Call Forwarding - Busy


           Alice            Proxy          User B1             User B2
             |                |              |                   |
             |    INVITE F1   |              |                   |
             |--------------->|   INVITE F2  |                   |
             |                |------------->|                   |
             |(100 Trying) F3 |              |                   |
             |<---------------|  486 Busy F4 |                   |
             |                |<-------------|                   |
             |                |     ACK F5   |                   |
             |                |------------->|                   |
             |(181 Call is Being Forwarded) F6                   |
             |<---------------|              |    INVITE F7      |
             |                |--------------------------------->|
             |                |              | 180 Ringing F8    |
             |                |<---------------------------------|
             | 180 Ringing F9 |              |                   |
             |<---------------|              |      200 OK F10   |
             |                |<---------------------------------|
             |    200 OK F11  |              |                   |
             |<---------------|              |                   |
             |     ACK F12    |              |                   |
             |--------------->|              |     ACK F13       |
             |                |--------------------------------->|
             |               Both way RTP Established            |
             |<=================================================>|
             |    BYE F14     |              |                   |
             |--------------->|              |      BYE F15      |
             |                |--------------------------------->|
             |                |              |    200 OK F16     |
             |  200 OK F17    |<---------------------------------|
             |<---------------|              |                   |
             |                |              |                   |


   Bob wants calls to B1 forwarded to B2 if B1 is busy (this information
   is known to the proxy).  Alice calls B1, B1 is busy, the proxy server
   places call to B2.

   Message Details

      F1 INVITE Alice -> Proxy

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 INVITE Proxy -> B1

      INVITE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      F3 (100 Trying) Proxy -> Alice

      SIP/2.0 100 Trying
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F4 486 Busy Here B1 -> Proxy

      SIP/2.0 486 Busy Here
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F5 ACK Proxy -> B1

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F6 (181 Call is Being Forwarded) Proxy -> Alice

      SIP/2.0 181 Call is Being Forwarded
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=9214d
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0

      /* The proxy now forwards the call to B2. */


      F7 INVITE Proxy -> B2

      INVITE sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F8 180 Ringing B2 -> Proxy

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567

      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client2.biloxi.example.com>
      Content-Length: 0


      F9 180 Ringing Proxy -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client2.biloxi.example.com>
      Content-Length: 0


      F10 200 OK B2 -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client2.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client2.biloxi.example.com
      s=
      c=IN IP4 client2.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      F11 200 OK Proxy -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client2.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client2.biloxi.example.com
      s=
      c=IN IP4 client2.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F12 ACK Alice -> Proxy

      ACK sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfX
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F13 ACK Proxy -> B2

      ACK sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83731
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfX
       ;received=192.0.2.103
      Max-Forwards: 69

      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0

      /* RTP streams are established between Alice and B2. */

      /* Alice eventually hangs up with User B2. */


      F14 BYE Alice -> Proxy

      BYE sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bW4
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F15 BYE Proxy -> B2

      BYE sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837493
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bW4
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F16 200 OK B2 -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837493
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061

       ;branch=z9hG4bK74bW4
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F17 200 OK Proxy -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bW4
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq:  2 BYE
      Content-Length: 0


9.  Call Forwarding - No Answer


           Alice            Proxy         User B1             User B2
             |                |              |                   |
             |    INVITE F1   |              |                   |
             |--------------->|   INVITE F2  |                   |
             |(100 Trying) F3 |------------->|                   |
             |<---------------|180 Ringing F4|                   |
             | 180 Ringing F5 |<-------------|                   |
             |<---------------|              |                   |
             |                 Request Timeout                   |
             |                |              |                   |
             |                |   CANCEL F6  |                   |
             |                |------------->|                   |
             |                |   200 OK F7  |                   |
             |                |<-------------|                   |
             |                |     487 F8   |                   |
             |                |<-------------|                   |
             |                |     ACK F9   |                   |
             |                |------------->|                   |
             |(181 Call is Being Forwarded) F10                  |
             |<---------------|              |    INVITE F11     |
             |                |--------------------------------->|
             |                |              | 180 Ringing F12   |
             | 180 Ringing F13|<---------------------------------|
             |<---------------|              |      200 OK F14   |
             |                |<---------------------------------|
             |   200 OK F15   |              |                   |
             |<---------------|              |                   |
             |     ACK F16    |              |                   |
             |--------------->|              |     ACK F17       |
             |                |--------------------------------->|
             |               Both way RTP Established            |
             |<=================================================>|
             |    BYE F18     |              |                   |
             |--------------->|              |      BYE F19      |
             |                |--------------------------------->|
             |                |              |    200 OK F20     |
             |  200 OK F21    |<---------------------------------|
             |<---------------|              |                   |
             |                |              |                   |


   Bob wants calls to B1 forwarded to B2 if B1 is not answered
   (information is known to the proxy server).  Alice calls B1 and no
   one answers.  The proxy server then places the call to B2.


   Message Details

      F1 INVITE Alice -> Proxy

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 INVITE Proxy -> B1

      INVITE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F3 (100 Trying) Proxy -> Alice

      SIP/2.0 100 Trying
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F4 180 Ringing B1 -> Proxy

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Length: 0


      F5 180 Ringing Proxy -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE

      Contact: <sips:bob@client.biloxi.example.com>
      Content-Length: 0

      /* B1 rings until a configurable timer expires in the proxy.  The
         proxy sends Cancel and proceeds down the list of routes. */


      F6 CANCEL Proxy -> B1

      CANCEL sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 CANCEL
      Content-Length: 0


      F7 200 OK B1 -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=329d823
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 CANCEL
      Content-Length: 0


      F8 487 Request Terminated B1 -> Proxy

      SIP/2.0 487 Request Terminated
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0

      F9 ACK Proxy -> B1

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=3145678
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F10 (181 Call is Being Forwarded) Proxy -> Alice

      SIP/2.0 181 Call is Being Forwarded
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=9214d
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F11 INVITE Proxy -> B2

      INVITE sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F12 180 Ringing B2 -> Proxy

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client2.biloxi.example.com>
      Content-Length: 0


      F13 180 Proxy -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client2.biloxi.example.com>
      Content-Length: 0


      F14 200 OK B2 -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client2.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client2.biloxi.example.com
      s=
      c=IN IP4 client2.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F15 200 OK Proxy -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client2.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client2.biloxi.example.com
      s=
      c=IN IP4 client2.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F16 ACK Alice -> Proxy

      ACK sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061

       ;branch=z9hG4bK74bf3
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F17 ACK Proxy -> B2

      ACK sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK8374.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf3
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0

      /* RTP streams are established between Alice and B2.
         Alice hangs up with User B2. */


      F18 BYE Alice -> Proxy

      BYE sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74b3f
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F19 BYE Proxy -> B2

      BYE sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74b3f
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F20 200 OK B2 -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK837.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74b3f
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 BYE
      Content-Length: 0


      F21 200 OK Proxy -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74b3f
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq:  2 BYE
      Content-Length: 0


10.  3-Way Conference - Third Party Is Added


            Alice           Bob            Carol
             |    INVITE F1   |              |
             |--------------->|              |
             | 180 Ringing F2 |              |
             |<---------------|              |
             |    200 OK F3   |              |
             |<---------------|              |
             |     ACK F4     |              |
             |--------------->|              |
             |       RTP      |              |
             |<==============>|              |
             |   INVITE F5    |              |
             |<---------------|              |
             |    200 OK F6   |              |
             |--------------->|              |
             |     ACK F7     |              |
             |<---------------|  INVITE F8   |
             |                |------------->|
             |                |    180 F9    |
             |                |<-------------|
             |                |  200 OK F10  |
             |                |<-------------|
             |                |  ACK F11     |
             |                |------------->|
             |                |       RTP    |
             |                |<============>|


   In this scenario, Alice and Bob are in a 2-party call (session) when
   Bob wishes to add Carol into the conversation.  Bob is capable of
   media mixing in a 3-party call.  Bob first sends a re-INVITE to
   Alice, changing Contact URIs to one that indicates Bob's mixer and
   acts like a focus.  As a result, Bob includes the "isfocus" feature
   tag [RFC3840] as described in [RFC4579].  Bob then INVITEs Carol
   using the same Contact URI.  Note that Bob could wait to re-INVITE
   Alice until after Carol has answered.  Bob could also put Alice on
   hold before calling Carol.

   Message Details

      F1 INVITE Alice -> Bob

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 180 Ringing Bob -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:b54gh42f5@biloxi.example.com>
      Content-Length: 0


      F3 200 OK Bob -> Alice

      SIP/2.0 200 OK

      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:b54gh42f5@biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F4 ACK Alice -> Bob

      ACK sips:b54gh42f5@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfL
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0

      /* Alice and Bob have established a session.
         Bob re-INVITEs, changing Contact URIs. */


      F5 INVITE Bob -> Alice

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 INVITE
      Contact: <sips:bob-Mixer@client.biloxi.example.com>;isfocus
      Content-Type: application/sdp
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, gruu
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844528 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 49172 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F6 200 OK Alice -> Bob

      SIP/2.0 200 OK

      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F7 ACK Bob -> Alice

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash3G
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 ACK
      Content-Length: 0

      /* Bob calls Carol. */


      F8 INVITE Bob -> Carol

      INVITE sips:carol@chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashJfd
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 INVITE
      Contact: <sips:bob-Mixer@client.biloxi.example.com>;isfocus
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 28908445834 2890844834 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 48174 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F9 180 Ringing Carol -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashJfd
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=341313
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F10 200 OK Carol -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashJfd
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=341313
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890844922 2890844922 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F11 ACK Bob -> Carol

      ACK sips:carol@client.chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash431
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=341313
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 ACK
      Content-Length: 0


      /* Bob's mixer now mixes media from both Alice and Carol
         to create the 3-way conference. */


11.  3-Way Conference - Third Party Joins


            Alice           Bob            Carol
             |    INVITE F1   |              |
             |--------------->|              |
             | 180 Ringing F2 |              |
             |<---------------|              |
             |    200 OK F3   |              |
             |<---------------|              |
             |     ACK F4     |              |
             |--------------->|              |
             |       RTP      |              |
             |<==============>|  INVITE Join:A-B F5
             |                |<-------------|
             |                |    180 F6    |
             |                |------------->|
             |   INVITE F7    |              |
             |<---------------|              |
             |    200 OK F8   |              |
             |--------------->|              |
             |     ACK F9     |              |
             |<---------------|              |
             |                |  200 OK F10  |
             |                |------------->|
             |                |  ACK F11     |
             |                |<-------------|
             |                |       RTP    |
             |                |<============>|


   In this scenario, Alice and Bob are in a 2-party call and Carol
   wishes to join, resulting in a 3-party call.  Carol could have
   learned Bob's dialog identifier using some non-SIP means, or possibly
   from a NOTIFY with the dialog package sent by Bob.  Carol sends an
   INVITE to Bob containing a Join header identifying the dialog between
   Alice and Bob.  Bob re-INVITEs Alice to switch to focus mode and
   includes the "isfocus" feature tag [RFC3840] as described in
   [RFC4579].  Bob then accepts the INVITE from Carol, resulting in the
   3-way call.

   Message Details

      F1 INVITE Alice -> Bob

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 180 Ringing Bob -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:b54gh42f5@biloxi.example.com>
      Content-Length: 0


      F3 200 OK Bob -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:b54gh42f5@biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, join, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F4 ACK Alice -> Bob

      ACK sips:b54gh42f5@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf6
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=23431
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0

      /* Alice and Bob have established a session.
         Carol requests to join the session. */


      F5 INVITE Carol -> Bob

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKnashds7
      Max-Forwards: 70
      From: Carol <sips:carol@chicago.example.com>;tag=8675309
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 452k499sk@chicago.example.com
      CSeq: 99 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, join
      Join: 12345600@atlanta.example.com;from-tag=1234567;to-tag=23431
      Content-Type: application/sdp
      Content-Length: ...
      v=0
      o=carol 2890844922 2890844922 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F6 180 Ringing Bob -> Carol

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=120.
      From: Carol <sips:carol@chicago.example.com>;tag=8675309
      To: Bob <sips:bob@biloxi.example.com>;tag=0982
      Call-ID: 452k499sk@chicago.example.com
      CSeq: 99 INVITE
      Contact: <sips:bob-Mixer@client.biloxi.example.com>;isfocus
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Length: 0


      F7 INVITE Bob -> Alice

      INVITE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashdyKL
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 INVITE
      Contact: <sips:bob-Mixer@client.biloxi.example.com>;isfocus
      Content-Type: application/sdp
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, join, gruu
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844528 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 49172 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      F8 200 OK Alice -> Bob
      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashdyKL
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F9 ACK Bob -> Alice

      ACK sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash3g
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=23431
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1024 ACK
      Content-Length: 0


      F10 200 OK Bob -> Carol

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=120.
      From: Carol <sips:carol@chicago.example.com>;tag=8675309
      To: Bob <sips:bob@biloxi.example.com>;tag=0982
      Call-ID: 452k499sk@chicago.example.com
      CSeq: 99 INVITE
      Contact: <sips:bob-Mixer@client.biloxi.example.com>;isfocus

      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, join, gruu
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 28908445834 2890844834 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 48174 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F11 ACK OK Carol -> Bob

      ACK sips:bob-Mixer@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKnash4Gf
      Max-Forwards: 70
      From: Carol <sips:carol@chicago.example.com>;tag=8675309
      To: Bob <sips:bob@biloxi.example.com>;tag=0982
      Call-ID: 452k499sk@chicago.example.com
      CSeq: 99 ACK
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces, join
      Content-Length:0


12.  Find-Me


             Alice           Proxy           User   User   User   User
                                              B1     B2     B3     B4
             |                |              |      |      |      |
             |    INVITE F1   |              |      |      |      |
             |--------------->|   INVITE F2  |      |      |      |
             |                |------------->|      |      |      |
             |(100 Trying) F3 |              |      |      |      |
             |<---------------|180 Ringing F4|      |      |      |
             |                |<-------------|      |      |      |
             | 180 Ringing F5 |              |      |      |      |
             |<---------------|              |      |      |      |
             |                |    Timeout   |      |      |      |
             |                |              |      |      |      |
             |                |   CANCEL F6  |      |      |      |
             |                |------------->|      |      |      |
             |                |   200 OK F7  |      |      |      |
             |                |<-------------|      |      |      |
             |                |     487 F8   |      |      |      |
             |                |<-------------|      |      |      |
             |                |     ACK F9   |      |      |      |
             |                |------------->|      |      |      |
             |                |     INVITE F10      |      |      |
             |                |-------------------->|      |      |
             |                |480 Not Logged In F11|      |      |
             |                |<--------------------|      |      |
             |                |              ACK F12|      |      |
             |                |-------------------->|      |      |
             |                |          INVITE F13        |      |
             |                |--------------------------->|      |
             |                |      486 Busy Here F14     |      |
             |                |<---------------------------|      |
             |                |            ACK F15         |      |
             |                |--------------------------->|      |
             |                |              INVITE F16           |
             |                |---------------------------------->|
             |                |            180 Ringing F17        |
             |     180 F18    |<----------------------------------|
             |<---------------|               200 OK F19          |
             |   200 OK F20   |<----------------------------------|
             |<---------------|                                   |
             |     ACK F21    |                                   |
             |--------------->|                 ACK F22           |
             |                |---------------------------------->|
             |               Both way RTP Established             |
             |<==================================================>|
             |                |                  BYE F23          |
             |     BYE F24    |<----------------------------------|
             |<---------------|                                   |
             |    200 OK F25  |                                   |
             |--------------->|                 200 OK F26        |
             |                |---------------------------------->|
             |                |                                   |


   Alice's call to Bob will result in an attempt to locate Bob by
   calling locations from a list of contacts.  The location to answer
   the call becomes the active set; no other sets may join the call.

   While this flow shows a sequential search, the search could be
   accomplished using parallel forking.

   Message Details

      F1 INVITE Alice -> Proxy

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t= 0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F2 INVITE Proxy -> B1

      INVITE sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t= 0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F3 (100 Trying) Proxy -> Alice

      SIP/2.0 100 Trying
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F4 180 Ringing B1 -> Proxy

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Length: 0
      F5 180 Ringing Proxy -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Content-Length: 0

      /* B1 rings until a configurable timer in the proxy
         expires.  The proxy then sends Cancel and proceeds down
         the list of routes. */


      F6 CANCEL Proxy -> B1

      CANCEL sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 CANCEL
      Content-Length: 0


      F7 200 OK B1 -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 CANCEL
      Content-Length: 0


      F8 487 Request Terminated B1 -> Proxy

      SIP/2.0 487 Request Terminated
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F9 ACK Proxy -> B1

      ACK sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.1
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=765432
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F10 INVITE Proxy -> B2

      INVITE sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F11 480 Not Logged In B2 -> Proxy

      SIP/2.0 480 Not Logged In
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314756
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F12 ACK Proxy -> B2

      ACK sips:bob@client2.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.2
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314756
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F13 INVITE Proxy -> B3

      INVITE sips:bob@client3.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.3
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F14 486 Busy Here B3 -> Proxy

      SIP/2.0 486 Busy Here
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.3
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Content-Length: 0


      F15 ACK Proxy -> B3

      ACK sips:bob@client3.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.3
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7654321
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F16 INVITE Proxy -> B4

      INVITE sips:bob@client4.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.4
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F17 180 Ringing B4 -> Proxy

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.4
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7137136
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client4.biloxi.example.com>
      Content-Length: 0


      F18 180 Ringing Proxy -> Alice

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7137136
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client4.biloxi.example.com>
      Content-Length: 0


      F19 200 OK B4 -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83749.4
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7137136
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client4.biloxi.example.com>
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844527 2890844527 IN IP4 client4.biloxi.example.com
      s=
      c=IN IP4 client4.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F20 200 OK Proxy -> Alice

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      Record-Route: <sips:ss1.example.com;lr>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7137136
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client4.biloxi.example.com>
      Content-Type: application/sdp
      Content-Length: ...


      v=0
      o=bob 2890844527 2890844527 IN IP4 client4.biloxi.example.com
      s=
      c=IN IP4 client4.biloxi.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F21 ACK Alice -> Proxy

      ACK sips:bob@client4.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7137136
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0


      F22 ACK Proxy -> B4

      ACK sips:bob@client4.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK8374
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf
       ;received=192.0.2.103
      Max-Forwards: 69
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7137136
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0

      /* RTP streams are established between Alice and B4. */

      /* User B4 hangs up with Alice. */


      F23 BYE B4 -> Proxy

      BYE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS client4.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
      Route: <sips:ss1.example.com;lr>
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=7137136
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 BYE
      Content-Length: 0


      F24 BYE Proxy -> Alice

      BYE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83754
      Via: SIP/2.0/TLS client4.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      Max-Forwards: 69
      From: Bob <sips:bob@biloxi.example.com>;tag=7137136
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 BYE
      Content-Length: 0


      F25 200 OK Alice -> Proxy

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS ss1.example.com:5061
       ;branch=z9hG4bK83754
       ;received=192.0.2.54
      Via: SIP/2.0/TLS client4.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      From: Bob <sips:bob@biloxi.example.com>;tag=7137136
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 BYE
      Content-Length: 0


      F26 200 OK Proxy -> B4

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client4.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.105
      From: Bob <sips:bob@biloxi.example.com>;tag=7137136
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 BYE
      Content-Length: 0


13.  Call Management (Incoming Call Screening)

                                                      Announcement
           Alice           Proxy            Bob           Server

             |                |              |              |
             |    INVITE F1   |              |              |
             |------------------------------>|              |
             | 305 Use Proxy F2              |              |
             |<------------------------------|              |
             |     ACK F3     |              |              |
             |------------------------------>|              |
             |    INVITE F4   |              |              |
             |--------------->|              |              |
             | 407 Proxy Authentication F5   |              |
             |<---------------|              |              |
             |     ACK F6     |              |              |
             |--------------->|              |              |
             |    INVITE F7   |              |              |
             |--------------->|              |              |
             | 403 Screening Failure (Terminating) Error-Info: URI F8
             |<---------------|              |              |
             |     ACK F9     |              |              |
             |--------------->|              |              |
             |    INVITE F10  |              |              |
             |--------------------------------------------->|
             |    200 OK F11  |              |              |
             |--------------------------------------------->|
             |     ACK F12    |                             |
             |--------------------------------------------->|
             |          Announcement Played to Caller       |
             |<=============================================|
             |                                    BYE F13   |
             |<---------------------------------------------|
             |     200 OK F14                               |
             |--------------------------------------------->|
             |                                              |
             |                                              |
             |                                              |


   Bob has an incoming call screening list; Alice is included on the
   list of addresses from which Bob will not accept calls.  Alice
   attempts to call Bob.  Messages F1, F2, and F3 are included to show
   that Bob does not accept INVITEs that have not been screened by the
   proxy.

   Note that call screening cannot be done using the From header --
   instead some form of authentication credentials must be used.

   The screening proxy inserts an announcement URI in an Error-Info
   header field, which Alice accesses by sending an INVITE to listen to
   the Announcement.  The Announcement Server uses the automaton and
   rendering feature tags in F12 and F13 to indicate that it is a media
   server only capable of playing announcements.

   Message Details

      F1 INVITE Alice -> Bob

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      /* Bob only accepts INVITEs that have been screened
         by the proxy. */

      F2 305 Use Proxy Bob -> Alice

      SIP/2.0 305 Use Proxy
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=342123
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:ss1.example.com>
      Content-Length: 0

      F3 ACK Alice -> Bob

      ACK sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=342123
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0

      /* A retries the call through the proxy. */


      F4 INVITE Alice -> Proxy 1

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf0
      Max-Forwards: 70
      Route: <sips:ss1.example.com>
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      /* Proxy 1 challenges Alice for authentication. */


      F5 407 Proxy Authentication Required Proxy 1 -> Alice

      SIP/2.0 407 Proxy Authentication Required
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf0
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7886765
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 INVITE
      Proxy-Authenticate: Digest realm="example.com",
         nonce="ea9c8e88df84f1cec4341ae6cbe5a359",
         qop="auth", nc=00000001, cnonce="0a4f113b",
         opaque="", stale=FALSE, algorithm=MD5
      Content-Length: 0


      F6 ACK Alice -> Proxy 1

      ACK sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf0
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=7886765
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 ACK
      Content-Length: 0

      /* Alice responds by sending an INVITE with authentication
         credentials in it. */


      F7 INVITE Alice -> Proxy 1

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf2
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 3 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Proxy-Authorization: Digest username="alice",
         realm="example.com", qop=auth,
         nc=00000001, cnonce="4gr84543ft2",
         nonce="ae9137be1c87d175c2dd63302a0d6e0a",
         opaque="", uri="sips:bob@biloxi.example.com",
         response="bbaec39f943bdcb3620d90afc548a45c"
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...
      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F8 403 Screening Failure (Terminating) Proxy 1 -> Alice

      SIP/2.0 403 Screening Failure (Terminating)
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf2
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=ffe254
      Call-ID: 12345600@atlanta.example.com
      CSeq: 3 INVITE
      Error-Info: <sips:screen-fail-term-ann@ms.biloxi.example.com>
      Content-Length: 0


      F9 ACK Alice -> Proxy 1

      ACK sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf2
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=ffe254
      Call-ID: 12345600@atlanta.example.com
      Proxy-Authorization: Digest username="alice",
       realm="example.com", nonce="ae9137be1c87d175c2dd63302a0d6e0a",
       opaque="", uri="sips:bob@biloxi.example.com",
       response="bbaec39f943bdcb3620d90afc548a45c"
      CSeq: 3 ACK
      Content-Length: 0

      /* To hear the recording, Alice connects to the Error-Info URI. */


      F10 INVITE Alice -> Proxy 1

      INVITE sips:screen-fail-term-ann@ms.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfj
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 4 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


   F11 200 OK Announcement Server -> Proxy 1

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bfj
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=234934
      Call-ID: 12345600@atlanta.example.com
      CSeq: 4 INVITE
      Contact: <sips:ms.biloxi.example.com>
       ;automaton;+sip.rendering="no"
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=annc 2890844543 2890844543 IN IP4 announce.biloxi.example.com
      s=
      c=IN IP4 announce.biloxi.example.com
      t=0 0
      m=audio 49174 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


   F12 ACK Alice -> Announcement Server

      ACK sips:ms.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74b32
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=234934
      Call-ID: 12345600@atlanta.example.com
      CSeq: 4 ACK
      Content-Length: 0

      /* Announcement Server plays announcement then disconnects. */


      F13 BYE Announcement Server -> Alice

      BYE sips:alice@client.atlanta.example.com SIP/2.0
      Via: SIP/2.0/TLS announcement.example.com:5061
       ;branch=z9hG4bK74bKS
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=234934
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2334 BYE
      Content-Length: 0


      F14 200 OK Alice -> Announcement Server

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS announcement.example.com:5061
       ;branch=z9hG4bK74bKS
       ;received=192.0.2.103
      From: Bob <sips:bob@biloxi.example.com>;tag=234934
      To: Alice <sips:alice@atlanta.example.com>;tag=1234567
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2334 BYE
      Content-Length: 0


14.  Call Management (Outgoing Call Screening)


           Alice            Proxy           Bob
             |                |              |
             |    INVITE F1   |              |
             |--------------->|              |
             | 407 Proxy Authentication F2   |
             |<---------------|              |
             |     ACK F3     |              |
             |--------------->|              |
             |    INVITE F4   |              |
             |--------------->|              |
             | 403 Screening Failure (Originating) F5
             |<---------------|              |
             |     ACK F6     |              |
             |--------------->|              |
             |                |              |


   Alice has an outgoing call screening list; Bob is included on the
   list of addresses to which Alice will not be able to place a call.
   Alice attempts to call Bob.

   Alice could establish a session to listen to the announcement in the
   Error-Info header field.

   Message Details

      F1 INVITE Alice -> Proxy 1

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000

      /* Proxy 1 challenges Alice for authentication. */


      F2 407 Proxy Authentication Required Proxy 1 -> Alice

      SIP/2.0 407 Proxy Authentication Required
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=90210
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 INVITE
      Proxy-Authenticate: Digest realm="example.com",
       nonce="ea9c8e88df84f1cec4341ae6cbe5a359",
       qop="auth", nc=00000001, cnonce="0a4f113b",
       opaque="", stale=FALSE, algorithm=MD5
      Content-Length: 0


      F3 ACK Alice -> Proxy 1

      ACK sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74bf9
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=90210
      Call-ID: 12345600@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0

      /* Alice responds be sending an INVITE with authentication
         credentials in it. */


      F4 INVITE Alice -> Proxy 1

      INVITE sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74b4
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 INVITE
      Contact: <sips:alice@client.atlanta.example.com>
      Proxy-Authorization: Digest username="alice", realm="example.com",
       nonce="cb360afc54bbaec39f943bd820d9a45c", opaque="",
       uri="sips:bob@biloxi.example.com",
       response="b9d2e5bcdec9f69ab2a9b44f270285a6"
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
      s=
      c=IN IP4 client.atlanta.example.com
      t=0 0
      m=audio 49170 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F5 403 Screening Failure (Originating) Proxy 1 -> Alice

      SIP/2.0 403 Screening Failure (Originating)
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74b4
       ;received=192.0.2.103
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=18017
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 INVITE
      Error-Info: <sips:screen-fail-orig-ann@announcement.example.com>
      Content-Length: 0


      F6 ACK Alice -> Proxy 1

      ACK sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.atlanta.example.com:5061
       ;branch=z9hG4bK74b4
      Max-Forwards: 70
      From: Alice <sips:alice@atlanta.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=18017
      Call-ID: 12345600@atlanta.example.com
      CSeq: 2 ACK
      Proxy-Authorization: Digest username="alice", realm="example.com",
       nonce="cb360afc54bbaec39f943bd820d9a45c", opaque="",
       uri="sips:bob@biloxi.example.com",
       response="b9d2e5bcdec9f69ab2a9b44f270285a6"
      Content-Length: 0


15.  Call Park

           Alice           Bob        Park Server       Carol
             |              |              |              |
             |   INVITE F1  |              |              |
             |------------->|              |              |
             |180 Ringing F2|              |              |
             |<-------------|              |              |
             |  200 OK F3   |              |              |
             |<-------------|              |              |
             |    ACK F4    |              |              |
             |------------->|              |              |
             |  RTP Media   |              |              |
             |<============>|              |              |
             |      Bob Parks Call         |              |
             |              |   REFER Refer-To: A F5      |
             |              |------------->|              |
             |              |    202 F6    |              |
             |              |<-------------|              |
             |              |   NOTIFY F7  |              |
             |              |<-------------|              |
             |              |    200 F8    |              |
             |              |------------->|              |
             |  INVITE F9 Replaces: B      |              |
             |<----------------------------|              |
             |          200 OK F10         |              |
             |---------------------------->|              |
             |           ACK F11           |              |
             |<----------------------------|              |
             |           RTP Music         |              |
             |<===========================>|              |
             |     BYE F12  |              |              |
             |------------->|  NOTIFY F14  |              |
             |  200 OK F13  |<-------------|              |
             |<-------------|  200 OK F15  |              |
             |              |------------->|              |
             |              |   Carol picks up the call   |
             |              |              |              |
             |              |              | SUBSCRIBE F16|
             |              |              |<-------------|
             |              |              |  200 OK F17  |
             |              |              |------------->|
             |              |              |  NOTIFY F18  |
             |              |              |------------->|
             |              |              |  200 OK F19  |
             |              |              |<-------------|
             |           INVITE Replaces: Park Server F20 |
             |<-------------------------------------------|
             |              |              |   200 F21    |
             |------------------------------------------->|
             |              |              |    ACK F22   |
             |<-------------------------------------------|
             |                  RTP Media                 |
             |<==========================================>|
             |           BYE F23           |              |
             |---------------------------->|              |
             |          200 OK F24         |              |
             |<----------------------------|              |
             |       No more RTP Music     |              |


   In this example, Alice calls Bob.  Bob then parks the call at the
   Park Server by sending a REFER to the Park Server.  The server sends
   an INVITE to Alice, which replaces the session between Alice and Bob.
   The Park Server utilizes the automaton, rendering, and byeless
   feature tags in F9 to indicate its capabilities to Alice.  The call
   is accepted by Alice and causes Alice to send a BYE to Bob.  Bob
   receives notification of the successful park, and also receives the
   dialog identifiers in the application/sip body of the NOTIFY
   response.

   Carol wishes to retrieve the call, so she sends an INVITE containing
   the dialog identifiers to Alice, which replaces the session with the
   Park Server.  Alice accepts the call and sends a BYE to the Park
   Server.  Carol obtains the dialog identifiers from a NOTIFY from the
   Park Server.

   Note that this call flow is a special case of call transfer.

   Note also that this flow could also be used for Music on Hold.

   Message Details

   F1 INVITE Alice -> Bob

   INVITE sips:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.alice.example.com:5061
    ;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 12345601@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sips:a8342043f@atlanta.example.com;gr>
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces, gruu
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=
   c=IN IP4 client.atlanta.example.com
   t=0 0
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 180 Ringing Bob -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bKnashds7
    ;received=192.0.2.105
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>;tag=314159
   Call-ID: 12345601@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sips:bob@client.biloxi.example.com>
   Content-Length: 0


   F3 200 OK Bob -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bKnashds7
    ;received=192.0.2.105
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>;tag=314159
   Call-ID: 12345601@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sips:bob@client.biloxi.example.com>
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.biloxi.example.com
   s=
   c=IN IP4 client.biloxi.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F4 ACK Alice -> Bob

   ACK sips:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>;tag=314159
   Call-ID: 12345601@atlanta.example.com
   CSeq: 1 ACK
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces
   Content-Length: 0

   /* Bob REFERs Park Server to establish session with Alice,
      which replaces the established session between Alice and Bob.
      Note that there is no session established between Bob
      and the Park Server. */


   F5 REFER Bob -> Park Server

   REFER sips:park@server.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bKnashds9
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=02134
   To: Park Server <sips:park@server.example.com>
   Call-ID: 4802029847@biloxi.example.com
   CSeq: 1 REFER
 <allOneLine>
   Refer-To: <sips:a8342043f@atlanta.example.com;gr?Replaces=
   12345601%40atlanta.example.com%3Bfrom-tag%3D314159
   %3Bto-tag%3D1234567&Require=replaces>
 </allOneLine>
   Referred-By: <sips:bob@biloxi.example.com>
   Contact: <sips:bob@client.biloxi.example.com>
   Content-Length: 0


   F6 202 Accepted Park Server -> Bob

   SIP/2.0 202 Accepted
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bKnashds9
    ;received=192.0.2.105
   From: Bob <sips:bob@biloxi.example.com>;tag=02134
   To: Park Server <sips:park@server.example.com>;tag=56323
   Call-ID: 4802029847@biloxi.example.com
   Contact: <sips:park@server.example.com>
   CSeq: 1 REFER
   Content-Length: 0


   F7 NOTIFY Park Server -> Bob

   NOTIFY sips:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74bT6
   To: Bob <sips:bob@biloxi.example.com>;tag=02134
   Max-Forwards: 70
   From: Park Server <sips:park@server.example.com>;tag=56323
   Call-ID: 4802029847@biloxi.example.com
   CSeq: 1 NOTIFY
   Event: refer
   Contact: <sips:park@server.example.com>
   Subscription-State: active;expires=60
   Content-Type: message/sipfrag
   Content-Length: ...

   SIP/2.0 100 Trying


   F8 200 OK Bob -> Park Server

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74bT6
    ;received=192.0.2.103
   To: Bob <sips:bob@biloxi.example.com>;tag=02134
   From: Park Server <sips:park@server.example.com>;tag=56323
   Call-ID: 4802029847@biloxi.example.com
   CSeq: 1 NOTIFY
   Content-Length: 0

   /* Park Server places call to Alice to replace session
      between Alice and Bob. */


   F9 INVITE Park Server -> Alice

   INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74rf
   Max-Forwards: 70
   From: <sips:park@server.example.com>;tag=0111
   To: <sips:a8342043f@atlanta.example.com;gr>
   Call-ID: a5-75-34-12-76@server.example.com
   CSeq: 1 INVITE
   Referred-By: <sips:bob@biloxi.example.com>
   Contact: <sips:park@server.example.com>;automaton
       ;+sip.byeless;+sip.rendering="no"
   Require: replaces
   Replaces: 12345601@atlanta.example.com
    ;from-tag=314159;to-tag=1234567
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=ParkServer 2890844576 2890844576 IN IP4 Park.server.example.com
   s=
   c=IN IP4 server.example.com
   t=0 0
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F10 200 OK Alice -> Park Server

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74rf
    ;received=192.0.2.103
   From: <sips:park@server.example.com>;tag=0111
   To: <sips:a8342043f@atlanta.example.com;gr>;tag=098594
   Call-ID: a5-75-34-12-76@server.example.com
   CSeq: 1 INVITE
   Contact: <sips:a8342043f@atlanta.example.com;gr>
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces, gruu
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=
   c=IN IP4 client.atlanta.example.com
   t=0 0
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   a=recvonly


   F11 ACK Park Server -> Alice

   ACK sips:a8342043f@atlanta.example.com;gr SIP/2.0
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK7rfF
   Max-Forwards: 70
   From: <sips:park@server.example.com>;tag=0111
   To: <sips:a8342043f@atlanta.example.com;gr>;tag=098594
   Call-ID: a5-75-34-12-76@server.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F12 BYE Alice -> Bob

   BYE sips:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bKnashds7
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>;tag=314159
   Call-ID: 12345601@atlanta.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F13 200 OK Bob -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bKnashds7
    ;received=192.0.2.105
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>;tag=314159
   Call-ID: 12345601@atlanta.example.com
   CSeq: 2 BYE
   Content-Length: 0

   /* Park Server reports success back to Bob by returning
      a 200 OK response.  Bob obtains the dialog identifiers
      from the headers included in the response. */


   F14 NOTIFY Park Server -> Bob

   NOTIFY sips:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74bf9
   To: Bob <sips:bob@biloxi.example.com>;tag=02134
   Max-Forwards: 70
   From: Park Server <sips:park@server.example.com>;tag=56323
   Call-ID: 4802029847@biloxi.example.com
   CSeq: 2 NOTIFY
   Event: refer
   Subscription-State: terminated;reason=noresource
   Contact: <sips:park@server.example.com>;automaton
       ;+sip.byeless;+sip.rendering="no"
   Content-Type: message/sipfrag
   Content-Length: ...

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74rf
    ;received=192.0.2.103
   From: <sips:park@server.example.com>;tag=0111
   To: <sips:a8342043f@atlanta.example.com;gr>;tag=098594
   Call-ID: a5-75-34-12-76@server.example.com
   CSeq: 1 INVITE
   Contact: <sips:a8342043f@atlanta.example.com;gr>


   F15 200 OK Bob -> Park Server

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74bf9
    ;received=192.0.2.103
   To: Bob <sips:bob@biloxi.example.com>;tag=02134
   From: Park Server <sips:park@server.example.com>;tag=56323
   Call-ID: 4802029847@biloxi.example.com
   CSeq: 2 NOTIFY
   Content-Length: 0

   /* Alice is now parked at the Park Server. */

   /* Carol picks up the call by sending an INVITE to A, which
      replaces the existing session with the Park Server.
      Carol needs to know the dialog information to construct
      the Replaces header. */


   F16 SUBSCRIBE  Carol -> Park Server

   SUBSCRIBE sips:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.chicago.example.com:5061
    ;branch=z9hG4bK74b232
   Max-Forwards: 70
   From: Carol <sips:carol@chicago.example.com>;tag=158x93461
   To: <sips:park@server.example.com>
   Call-ID: 2d6485356dfaj34dsf
   CSeq: 1 SUBSCRIBE
   Contact: <sips:carol@client.chicago.example.com>
   Event: dialog
   Expires: 0
   Accept: application/dialog-info+xml
   Content-Length: 0


   F17 200 OK Park Server -> Carol

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.chicago.example.com:5061
    ;branch=z9hG4bK74b232
    ;received=192.0.2.105
   From: Carol <sips:carol@chicago.example.com>;tag=158x93461
   To: <sips:park@server.example.com>;tag=3213j
   Call-ID: 2d6485356dfaj34dsf
   CSeq: 1 SUBSCRIBE
   Contact: <sips:park@server.example.com>;automaton
       ;+sip.byeless;+sip.rendering="no"
   Content-Length: 0


   F18 NOTIFY  Park Server -> Carol

   NOTIFY sips:carol@client.example.com SIP/2.0
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74b8skd
   Max-Forwards: 70
   To: Carol <sips:carol@chicago.example.com>;tag=158x93461
   From: <sips:park@server.example.com>;tag=3213j
   Call-ID: 2d6485356dfaj34dsf
   CSeq: 1 NOTIFY
   Contact: <sips:park@server.example.com>;automaton
       ;+sip.byeless;+sip.rendering="no"
   Event: dialog
   Subscription-State: terminated;reason=timeout
   Content-Type: application/dialog-info+xml
   Content-Length: ...
   <?xml version="1.0"?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
         version="0" state="full" entity="sips:park@server.example.com">
      <dialog id="439920143524"
         call-id="a5-75-34-12-76@server.example.com"
         local-tag="0111" remote-tag="098594" direction="initiator">
        <duration>1</duration>
        <local>
           <target>sips:park@server.example.com</target>
        </local>
        <remote>
          <target>sips:a8342043f@atlanta.example.com;gr</target>
        </remote>
        <state>confirmed</state>
      </dialog>
    </dialog-info>


   F19 200 OK Carol -> Park Server

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS server.example.com:5061
    ;branch=z9hG4bK74b8skd
    ;received=192.0.2.103
   To: Carol <sips:carol@chicago.example.com>;tag=158x93461
   From: <sips:park@server.example.com>;tag=3213j
   Call-ID: 2d6485356dfaj34dsf
   CSeq: 1 NOTIFY
   Contact: <sips:carol@client.chicago.example.com>
   Content-Length: 0


   F20 INVITE Carol -> Alice

   INVITE sips:alice@atlanta.example.com SIP/2.0
   Via: SIP/2.0/TLS client.chicago.example.com:5061
    ;branch=z9hG4bK74bQ2
   Max-Forwards: 70
   From: Carol <sips:carol@chicago.example.com>;tag=5893461
   To: Alice <sips:alice@atlanta.example.com>
   Call-ID: 6485356@chicago.example.com
   CSeq: 1 INVITE
   Contact: <sips:carol@client.chicago.example.com>
   Require: replaces
   Replaces: a5-75-34-12-76@server.example.com
    ;to-tag=098594;from-tag=0111
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
    SUBSCRIBE, NOTIFY
   Supported: replaces
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=carol 2890844922 2890844922 IN IP4 client.chicago.example.com
   s=
   c=IN IP4 client.chicago.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F21 200 OK Alice -> Carol

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.chicago.example.com:5061
    ;branch=z9hG4bK74bQ2
    ;received=192.0.2.105
   From: Carol <sips:carol@chicago.example.com>;tag=5893461
   To: Alice <sips:alice@atlanta.example.com>;tag=222
   Call-ID: 6485356@chicago.example.com
   CSeq: 1 INVITE
   Contact: <sips:a8342043f@atlanta.example.com;gr>
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces, gruu
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=alice 2890844527 2890844527 IN IP4 client.atlanta.example.com
   s=
   c=IN IP4 client.atlanta.example.com
   t=0 0
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F22 ACK Carol -> Alice

   ACK sips:a8342043f@atlanta.example.com;gr SIP/2.0
   Via: SIP/2.0/TLS client.chicago.example.com:5061
    ;branch=z9hG4bK74bJ0
   Max-Forwards: 70
   From: Carol <sips:carol@chicago.example.com>;tag=5893461
   To: Alice <sips:alice@atlanta.example.com>;tag=222
   Call-ID: 6485356@chicago.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* A replaces the session to the Park Server with the new
      session with C and generates a BYE to disconnect the
      Park Server. */

   F23 BYE Alice -> Park Server

   BYE sips:park@server.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74b4N
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=098594
   To: <sips:park@server.example.com>;tag=0111
   Call-ID: a5-75-34-12-76@server.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F24 200 OK Park Server -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74b4N
    ;received=192.0.2.103
   From: Alice <sips:alice@atlanta.example.com>;tag=098594
   To: <sips:park@server.example.com>;tag=0111
   Call-ID: a5-75-34-12-76@server.example.com
   CSeq: 1 BYE
   Content-Length: 0


16.  Call Pickup


            Alice          Bob                Bill
             |              |                   |
             |   INVITE F1  |                   |
             |------------->|                   |
             |180 Ringing F2|                   |
             |<-------------|                   |
             |              |   SUBSCRIBE F3    |
             |              |<------------------|
             |              |     200 OK F4     |
             |              |------------------>|
             |              |     NOTIFY F5     |
             |              |------------------>|
             |              |     200 OK F6     |
             |              |<------------------|
             |          INVITE Replaces:Bob  F7 |
             |<---------------------------------|
             |              |     200 OK F8     |
             |--------------------------------->|
             |   CANCEL F9  |                   |
             |------------->|                   |
             |  200 OK F10  |                   |
             |<-------------|                   |
             |    487 F11   |                   |
             |<-------------|                   |
             |    ACK F12   |                   |
             |------------->|                   |
             |                    ACK F13       |
             |<---------------------------------|
             |                                  |
             |    Two-Way RTP Established       |
             |<================================>|
             |                     BYE F14      |
             |--------------------------------->|
             |                   200 OK F15     |
             |<---------------------------------|
             |                                  |


   Bob and Bill are part of a work group at example.com that can pick up
   each other's calls.  Alice calls Bob, who does not answer.  Bill
   wishes to pick up the call and sends a SUBSCRIBE to Bob to retrieve
   the dialog information.  Bill then generates an INVITE with a
   Replaces to Alice.  Alice answers the INVITE and sends a CANCEL to
   stop Bob's phone ringing.  Note that the relative order of the
   487/ACK sequence (F11/F12) and the 200 OK to the CANCEL (F10) is not
   deterministic.

   This call flow shows the use of the "early-only" parameter [RFC3891]
   in the Replaces header field of F7.  This parameter prevents Alice
   from accepting the INVITE if Bob has already accepted the INVITE.  If
   Bill had wished to "take" the call from Bob regardless of whether he
   had answered, the parameter would not have been present in F7.

   Also note that the subscription between Bob and Carol could have been
   established prior to Alice's call.

   Message Details

  F1 INVITE Alice -> Bob

  INVITE sips:bob@biloxi.example.com SIP/2.0
  Via: SIP/2.0/TLS client.atlanta.example.com:5061
   ;branch=z9hG4bK74bf9
  Max-Forwards: 70
  From: Alice <sips:alice@atlanta.example.com>;tag=1234567
  To: Bob <sips:bob@biloxi.example.com>
  Call-ID: 12345600@atlanta.example.com
  CSeq: 1 INVITE
  Contact: <sips:a8342043f@atlanta.example.com;gr>
  Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
  Supported: replaces, gruu
  Content-Type: application/sdp
  Content-Length: ...

  v=0
  o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
  s=
  c=IN IP4 client.atlanta.example.com
  t=0 0
  m=audio 49170 RTP/AVP 0
  a=rtpmap:0 PCMU/8000


  F2 180 Ringing Bob -> Alice

  SIP/2.0 180 Ringing
  Via: SIP/2.0/TLS client.atlanta.example.com:5061
   ;branch=z9hG4bK74bf9
   ;received=192.0.2.103
  From: Alice <sips:alice@atlanta.example.com>;tag=1234567
  To: Bob <sips:bob@biloxi.example.com>;tag=3145678
  Call-ID: 12345600@atlanta.example.com
  CSeq: 1 INVITE
  Contact: <sips:bob@client.biloxi.example.com>
  Content-Length: 0

  /* Bill decides to pick up the call. */


  F3 SUBSCRIBE  Bill -> Bob

  SUBSCRIBE sips:bob@biloxi.example.com SIP/2.0
  Via: SIP/2.0/TLS pc.biloxi.example.com:5061
   ;branch=z9hG4bK74bf
  Max-Forwards: 70
  From: Bill <sips:bill@biloxi.example.com>;tag=8675309
  To: Bob <sips:bob@biloxi.example.com>
  Call-ID: rt4353gs2egg@pc.biloxi.example.com
  CSeq: 1 SUBSCRIBE
  Contact: <sips:bill@pc.biloxi.example.com>
  Event: dialog
  Expires: 0
  Accept: application/dialog-info+xml
  Content-Length: 0


  F4 200 OK Bob -> Bill

  SIP/2.0 200 OK
  Via: SIP/2.0/TLS pc.biloxi.example.com:5061
   ;branch=z9hG4bK74bf
   ;received=192.0.2.114
  Max-Forwards: 70
  From: Bill <sips:bill@biloxi.example.com>;tag=8675309
  To: Bob <sips:bob@biloxi.example.com>;tag=31451098
  Call-ID: rt4353gs2egg@pc.biloxi.example.com
  CSeq: 1 SUBSCRIBE
  Content-Length: 0


  F5 NOTIFY  Bob -> Bill

  NOTIFY sips:bill@pc.biloxi.example.com SIP/2.0
  Via: SIP/2.0/TLS client.biloxi.example.com:5061
   ;branch=z9hG4bK74br
  Max-Forwards: 70
  From: Bob <sips:bob@biloxi.example.com>;tag=31451098
  To: Bill <sips:bill@biloxi.example.com>;tag=8675309
  Call-ID: rt4353gs2egg@pc.biloxi.example.com
  CSeq: 1 NOTIFY
  Contact: <sips:bob@client.biloxi.example.com>
  Event: dialog
  Subscription-State: terminated;reason=timeout
  Content-Type: application/dialog-info+xml
  Content-Length: ...

  <?xml version="1.0"?>
  <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
         version="0" state="full" entity="sips:bob@biloxi.example.com">
     <dialog id="94992014524" call-id="12345600@atlanta.example.com"
         local-tag="3145678" remote-tag="1234567" direction="recipient">
       <duration>1</duration>
       <local>
         <identity display="Bob">sips:bob@biloxi.example.com</identity>
         <target>sips:bob@client.biloxi.example.com</target>
       </local>
       <remote>
         <identity display="Alice">sips:alice@atlanta.example.com
                                                         </identity>
         <target>sips:a8342043@atlanta.example.com;gr</target>
       </remote>
       <state>early</state>
     </dialog>
   </dialog-info>


  F6 200 OK  Bill -> Bob

  SIP/2.0 200 OK
  Via: SIP/2.0/TLS client.biloxi.example.com:5061
   ;branch=z9hG4bK74br
   ;received=192.0.2.105
  From: Bob <sips:bob@biloxi.example.com>;tag=31451098
  To: Bill <sips:bill@biloxi.example.com>;tag=8675309
  Call-ID: rt4353gs2egg@pc.biloxi.example.com
  CSeq: 1 NOTIFY
  Contact: <sips:bill@pc.biloxi.example.com>
  Content-Length: 0


  F7 INVITE  Bill -> Alice

  INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
  Via: SIP/2.0/TLS pc.biloxi.example.com:5061
   ;branch=z9hG4bK74HH
  Max-Forwards: 70
  From: Bill <sips:bill@biloxi.example.com>;tag=8675310
  To: Alice <sips:alice@atlanta.example.com>
  Call-ID: 563456212@b2.biloxi.example.com
  CSeq: 1 INVITE
  Require: replaces
  Replaces: 12345600@atlanta.example.com
   ;from-tag=314578;to-tag=1234567;early-only
  Contact: <sips:bill@pc.biloxi.example.com>
  Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
  Supported: replaces
  Content-Type: application/sdp
  Content-Length: ...

  v=0
  o=bill 2890843122 2890843122 IN IP4 pc.biloxi.example.com
  s=
  c=IN IP4 pc.biloxi.example.com
  t=0 0
  m=audio 5342 RTP/AVP 0
  a=rtpmap:0 PCMU/8000

  /* Alice matches the dialog information in the Replaces header
     and accepts the INVITE. */


  F8 200 OK  Alice -> Bill

  SIP/2.0 200 OK
  Via: SIP/2.0/TLS pc.biloxi.example.com:5061
   ;branch=z9hG4bK74HH
   ;received=192.0.2.114
  From: Bill <sips:bill@biloxi.example.com>;tag=8675310
  To: Alice <sips:alice@atlanta.example.com>;tag=131256
  Call-ID: 563456212@b2.biloxi.example.com
  CSeq: 1 INVITE
  Contact: <sips:a8342043f@atlanta.example.com;gr>
  Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
  Supported: replaces, gruu
  Content-Type: application/sdp
  Content-Length: ...

  v=0
  o=alice 289084543 289084543 IN IP4 client.atlanta.example.com
  s=
  c=IN IP4 client.atlanta.example.com
  t=0 0
  m=audio 49172 RTP/AVP 0
  a=rtpmap:0 PCMU/8000

  /* Alice stops Bob's phone from ringing by sending a CANCEL. */

  F9 CANCEL Alice -> Bob

  CANCEL sips:bob@biloxi.example.com SIP/2.0
  Via: SIP/2.0/TLS client.atlanta.example.com:5061
   ;branch=z9hG4bK74bf9
  Max-Forwards: 70
  From: Alice <sips:alice@atlanta.example.com>;tag=1234567
  To: Bob <sips:bob@biloxi.example.com>
  Call-ID: 12345600@atlanta.example.com
  CSeq: 1 CANCEL
  Content-Length: 0


  F10 200 OK Bob -> Alice

  SIP/2.0 200 OK
  Via: SIP/2.0/TLS client.atlanta.example.com:5061
   ;branch=z9hG4bK74bf9
   ;received=192.0.2.103
  From: Alice <sips:alice@atlanta.example.com>;tag=1234567
  To: Bob <sips:bob@biloxi.example.com>;tag=3145678
  Call-ID: 12345600@atlanta.example.com
  CSeq: 1 CANCEL
  Content-Length: 0


  F11 487 Request Terminated Bob -> Alice

  SIP/2.0 487 Request Terminated
  Via: SIP/2.0/TLS client.atlanta.example.com:5061
   ;branch=z9hG4bK74bf9
   ;received=192.0.2.103
  From: Alice <sips:alice@atlanta.example.com>;tag=1234567
  To: Bob <sips:bob@biloxi.example.com>;tag=3145678
  Call-ID: 12345600@atlanta.example.com
  CSeq: 1 INVITE
  Content-Length: 0


  F12 ACK Alice -> Bob

  ACK sips:bob@client.biloxi.example.com SIP/2.0
  Via: SIP/2.0/TLS client.atlanta.example.com:5061
   ;branch=z9hG4bK83749.1
  Max-Forwards: 70
  From: Alice <sips:alice@atlanta.example.com>;tag=1234567
  To: Bob <sips:bob@biloxi.example.com>;tag=3145678
  Call-ID: 12345600@atlanta.example.com
  CSeq: 1 ACK
  Content-Length: 0


  F13 ACK  Bill -> Alice

  ACK sips:a8342043f@atlanta.example.com;gr SIP/2.0
  Via: SIP/2.0/TLS pc.biloxi.example.com:5061
   ;branch=z9hG4bK7435
  Max-Forwards: 70
  From: Bill <sips:bill@biloxi.example.com>;tag=8675310
  To: Alice <sips:alice@atlanta.example.com>;tag=131256
  Call-ID: 563456212@b2.biloxi.example.com
  CSeq: 1 ACK
  Content-Length: 0

  /* RTP streams are established between Alice and Bill.
     Later, Alice hangs up with Bill. */


  F14 BYE Alice -> Bill

  BYE sips:bill@pc.biloxi.example.com SIP/2.0
  Via: SIP/2.0/TLS client.atlanta.example.com:5061
   ;branch=z9hG4bK74bf2
  Max-Forwards: 70
  To: Bill <sips:bill@biloxi.example.com>;tag=8675310
  From: Alice <sips:alice@atlanta.example.com>;tag=131256
  Call-ID: 563456212@b2.biloxi.example.com
  CSeq: 1 BYE
  Content-Length: 0


  F15 200 OK Bill -> Alice

  SIP/2.0 200 OK
  Via: SIP/2.0/TLS client.atlanta.example.com:5061
   ;branch=z9hG4bK74bf2
   ;received=192.0.2.105
  To: Bill <sips:bill@biloxi.example.com>;tag=8675310
  From: Alice <sips:alice@atlanta.example.com>;tag=131256
  Call-ID: 563456212@b2.biloxi.example.com
  CSeq:  1 BYE
  Content-Length: 0


17.  Automatic Redial
           Alice             Bob
             |                |
             |    INVITE F1   |
             |--------------->|
             |486 Busy Here F2|
             |<---------------|    Bob is busy
             |     ACK F3     |
             |--------------->|
             |  SUBSCRIBE F4  |
             |--------------->|
             |   200 OK F5    |
             |<---------------|
             |    NOTIFY F6   |
             |<---------------|
             |   200 OK F7    |
             |--------------->|
             |                |
             |    NOTIFY F8   |    Bob is now available
             |<---------------|
             |   200 OK F9    |
             |--------------->|
             |                |
             |   INVITE F10   |
             |--------------->|    Session setup successful
             | 180 Ringing F11|
             |<---------------|
             |   200 OK F12   |
             |<---------------|
             |     ACK F13    |
             |--------------->|
             |  Media Session |
             |<==============>|
             |                |
             |   NOTIFY F14   |
             |<---------------|
             |   200 OK F15   |
             |--------------->|
             |                |
             |  SUBSCRIBE F16 | Alice terminates subscription
             |--------------->|
             |   200 OK F17   |
             |<---------------|
             |   NOTIFY F18   |
             |<---------------|
             |   200 OK F19   |
             |--------------->|
             |                |


   Bob is initially busy when Alice calls.  Alice subscribes to Bob's
   call state using a SUBSCRIBE F4.  Bob sends a NOTIFY F8 when Bob is
   available.  Alice is alerted, then Alice sends an INVITE to Bob to
   establish the session.  The subscription is terminated using
   SUBSCRIBE F16.

   Message Details

   F1 INVITE Alice -> Bob

   INVITE sips:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 12345600@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sips:alice@client.atlanta.example.com>
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.atlanta.example.com
   s=
   c=IN IP4 client.atlanta.example.com
   t=0 0
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 486 Busy Here

   SIP/2.0 486 Busy Here
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74bf9
    ;received=192.0.2.103
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>;tag=982039i4
   Call-ID: 12345600@atlanta.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F3 ACK Alice -> Bob

   ACK sips:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=1234567
   To: Bob <sips:bob@biloxi.example.com>;tag=982039i4
   Call-ID: 12345600@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F4 SUBSCRIBE Alice -> Bob

   SUBSCRIBE sips:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74b8G
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=837348234
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 1 SUBSCRIBE
   Contact: sips:alice@client.atlanta.example.com
   Event: dialog
   Accept: application/dialog-info+xml
   Content-Length: 0


   F5 200 OK Bob -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74b8G
    ;received=192.0.2.103
   From: Alice <sips:alice@atlanta.example.com>;tag=837348234
   To: Bob <sips:bob@biloxi.example.com>;tag=341123
   Call-ID: 4524526232@atlanta.example.com
   Expires: 60
   CSeq: 1 SUBSCRIBE
   Contact: sips:bob@client.biloxi.example.com
   Content-Length: 0

   F6 NOTIFY Bob -> Alice

   NOTIFY sips:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bK74bn2
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=341123
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 1 NOTIFY
   Contact: <sips:bob@client.biloxi.example.com>
   Event: dialog
   Subscription-State: active;expires=59
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0"?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
          version="0" state="full" entity="sips:bob@biloxi.example.com">
      <dialog id="562623442g3">
         <duration>1</duration>
        <state>confirmed</state>
      </dialog>
    </dialog-info>


   F7 200 OK Alice -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bK74bn2
    ;received=192.0.2.105
   From: Bob <sips:bob@biloxi.example.com>;tag=341123
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 1 NOTIFY
   Content-Length: 0

   /* Bob is now available. */


   F8 NOTIFY Bob -> Alice

   NOTIFY sips:alice@atlanta.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bK74bVi
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=341123
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 2 NOTIFY
   Event: dialog
   Subscription-State: active;expires=27
   Contact: <sips:bob@client.biloxi.example.com>
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0"?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
          version="0" state="full" entity="sips:bob@biloxi.example.com">
      <dialog id="562623442g3">
        <state>terminated</state>
      </dialog>
   </dialog-info>


   F9 200 OK Alice -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bK74bVi
    ;received=192.0.2.105
   From: Bob <sips:bob@biloxi.example.com>;tag=341123
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 2 NOTIFY
   Content-Length: 0


   F10 INVITE Alice -> Bob

   INVITE sips:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74bfq
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=f23fkg14k
   To: Bob <sips:bob@biloxi.example.com>
   Call-ID: aoij4i9okitr@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sips:alice@client.atlanta.example.com>
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=alice 2890844826 2890844826 IN IP4 client.atlanta.example.com
   s=
   c=IN IP4 client.atlanta.example.com
   t=0 0
   m=audio 49170 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F11 180 Ringing Bob -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74bfq
    ;received=192.0.2.103
   From: Alice <sips:alice@atlanta.example.com>;tag=f23fkg14k
   To: Bob <sips:bob@biloxi.example.com>;tag=23431
   Call-ID: aoij4i9okitr@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sips:bob@client.biloxi.example.com>
   Content-Length: 0


   F12 200 OK Bob -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74bfq
    ;received=192.0.2.103
   From: Alice <sips:alice@atlanta.example.com>;tag=f23fkg14k
   To: Bob <sips:bob@biloxi.example.com>;tag=23431
   Call-ID: aoij4i9okitr@atlanta.example.com
   CSeq: 1 INVITE
   Contact: <sips:bob@client.biloxi.example.com>
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY
   Supported: replaces
   Content-Type: application/sdp
   Content-Length: ...

   v=0
   o=bob 2890854527 2890854527 IN IP4 client.biloxi.example.com
   s=
   c=IN IP4 client.biloxi.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F13 ACK Alice -> Bob

   ACK sips:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK74bLBJ
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=f23fkg14k
   To: Bob <sips:bob@biloxi.example.com>;tag=23431
   Call-ID: aoij4i9okitr@atlanta.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F14 NOTIFY Bob -> Alice

   NOTIFY sips:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bK4bnd2
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=341123
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 3 NOTIFY
   Contact: <sips:bob@client.biloxi.example.com>
   Event: dialog
   Subscription-State: active;expires=15
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0"?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
          version="0" state="full" entity="sips:bob@biloxi.example.com">
      <dialog id="62d2623442g3">
         <duration>1</duration>
        <state>confirmed</state>
      </dialog>
    </dialog-info>


   F15 200 OK Alice -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bK4bnd2
    ;received=192.0.2.105
   From: Bob <sips:bob@biloxi.example.com>;tag=341123
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234

   Call-ID: 4524526232@atlanta.example.com
   CSeq: 3 NOTIFY
   Content-Length: 0

   /* Alice terminates the subscription. */


   F16 SUBSCRIBE Alice -> Bob

   SUBSCRIBE sips:bob@client.biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK474b8
   Max-Forwards: 70
   From: Alice <sips:alice@atlanta.example.com>;tag=837348234
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 2 SUBSCRIBE
   Contact: sips:alice@client.atlanta.example.com
   Event: dialog
   Expires: 0
   Accept: application/dialog-info+xml
   Content-Length: 0


   F17 200 OK Bob -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.atlanta.example.com:5061
    ;branch=z9hG4bK474b8
    ;received=192.0.2.103
   From: Alice <sips:alice@atlanta.example.com>;tag=837348234
   To: Bob <sips:bob@biloxi.example.com>;tag=341123
   Call-ID: 4524526232@atlanta.example.com
   Expires: 0
   CSeq: 2 SUBSCRIBE
   Contact: sips:bob@client.biloxi.example.com
   Content-Length: 0


   F18 NOTIFY Bob -> Alice

   NOTIFY sips:alice@client.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bKb5n2j
   Max-Forwards: 70
   From: Bob <sips:bob@biloxi.example.com>;tag=341123
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 4 NOTIFY
   Contact: <sips:bob@client.biloxi.example.com>
   Event: dialog
   Subscription-State: terminated;reason=noresource
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0"?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
          version="0" state="full" entity="sips:bob@biloxi.example.com">
      <dialog id="62d2623442g3">
         <duration>3</duration>
        <state>confirmed</state>
      </dialog>
    </dialog-info>


   F19 200 OK Alice -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bKb5n2j
    ;received=192.0.2.105
   From: Bob <sips:bob@biloxi.example.com>;tag=341123
   To: Alice <sips:alice@atlanta.example.com>;tag=837348234
   Call-ID: 4524526232@atlanta.example.com
   CSeq: 4 NOTIFY
   Content-Length: 0


18.  Click to Dial

        Bob's PC                Bob                Carol
            | REFER Refer-To:Carol F1                 |
            |------------------->|                    |
            |  202 Accepted F2   |                    |
            |<-------------------|                    |
            |                    |     INVITE F3      |
            |                    |------------------->|
            |                    |   180 Ringing F4   |
            |                    |<-------------------|
            |                    |     200 OK F5      |
            |                    |<-------------------|
            |                    |       ACK F6       |
            |                    |------------------->|
            |                    |         RTP        |
            |                    |<==================>|
            |                    |                    |



   In this example, while browsing the web on his PC, Bob clicks on
   Carol's SIP URI, intending to establish a session with Carol.  Bob's
   web browser passes the SIP URI to the SIP client on Bob's PC.  The PC
   client is configured with the URI of Bob's SIP phone.  A REFER is
   sent to the SIP phone, which results in the establishment of the
   session between Bob and Carol.

   Note that Bob's PC requests that no REFER dialog be established by
   the use of the Refer-Sub: false header field [RFC4488].

   This flow is preferable to the 3pcc flow because the end-to-end SIP
   signaling is not interrupted by the 3pcc controller, and because
   Bob's experience of the call will not be marred by the lack of
   ringback tone or possible clipping.  Suitable authorization of the
   REFER and explicit authorization of the triggered INVITE by Bob are
   necessary.

   Message Details

   /* Bob's PC SIP client sends a REFER to Bob's SIP phone. */

      F1 REFER PC -> Bob

      REFER sips:bob@biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS pc.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
      Max-Forwards: 70
      From: <sips:pc.biloxi.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>
      Call-ID: 1234560183434
      CSeq: 1 REFER
      Refer-To: <sips:carol@chicago.example.com>
      Refer-Sub: false
      Contact: <sips:pc.biloxi.example.com>
      Content-Length: 0


      F2 202 Accepted Bob -> PC

      SIP/2.0 202 Accepted
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds7
       ;received=192.0.2.103
      From: <sips:pc.biloxi.example.com>;tag=1234567
      To: Bob <sips:bob@biloxi.example.com>;tag=314159
      Call-ID: 1234560183434
      Contact: <sips:bob@client.biloxi.example.com>
      CSeq: 1 REFER
      Refer-Sub: false
      Content-Length: 0


      F3 INVITE Bob -> Carol

      INVITE sips:carol@chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashdK9
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:bob@client.biloxi.example.com>
      Referred-By: <sips:pc.biloxi.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=bob 2890844539 2890844539 IN IP4 client.biloxi.example.com
      s=
      c=IN IP4 client.biloxi.example.com
      t=0 0
      m=audio 3458 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F4 180 Ringing Carol -> Bob

      SIP/2.0 180 Ringing
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashdK9
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=928287
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Content-Length: 0


      F5 200 OK Carol -> Bob

      SIP/2.0 200 OK
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashdK9
       ;received=192.0.2.113
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=928287
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 INVITE
      Contact: <sips:carol@client.chicago.example.com>
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      v=0
      o=carol 2890844527 2890844527 IN IP4 client.chicago.example.com
      s=
      c=IN IP4 client.chicago.example.com
      t=0 0
      m=audio 3456 RTP/AVP 0
      a=rtpmap:0 PCMU/8000


      F6 ACK Bob -> Carol

      ACK sips:carol@client.chicago.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashd43
      Max-Forwards: 70
      From: Bob <sips:bob@biloxi.example.com>;tag=8675309
      To: Carol <sips:carol@chicago.example.com>;tag=928287
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 ACK
      Content-Length: 0

      /* Bob and Carol now have established a session. */
                                                                                          
                                                                             
--> SIP to PSTN Dialing
1.  Successful SIP to ISUP PSTN call

   Alice           Proxy 1           NGW 1          Switch B
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|                |                |
     |     100  F2    |                |                |
     |<---------------|   INVITE F3    |                |
     |                |--------------->|                |
     |                |     100  F4    |                |
     |                |<---------------|     IAM F5     |
     |                |                |--------------->|
     |                |                |     ACM F6     |
     |                |     183 F7     |<---------------|
     |     183 F8     |<---------------|                |
     |<---------------|                |                |
     |        Both Way RTP Media       |  One Way Voice |
     |<===============================>|<===============|
     |                |                |      ANM F9    |
     |                |    200 F10     |<---------------|
     |     200 F11    |<---------------|                |
     |<---------------|                |                |
     |     ACK F12    |                |                |
     |--------------->|     ACK F13    |                |
     |                |--------------->|                |
     |        Both Way RTP Media       | Both Way Voice |
     |<===============================>|<==============>|
     |     BYE F14    |                |                |
     |--------------->|     BYE F15    |                |
     |                |--------------->|                |
     |                |     200 F16    |                |
     |     200 F17    |<---------------|     REL F18    |
     |<---------------|                |--------------->|
     |                |                |     RLC F19    |
     |                |                |<---------------|
     |                |                |                |



   Alice dials the globalized E.164 number +19725552222 to reach Bob.
   Note that A might have only dialed the last 7 digits, or some other
   dialing plan.  It is assumed that the SIP User Agent Client converts
   the digits into a global number and puts them into a SIP URI.  Note
   that tel URIs could be used instead of SIP URIs.

   Alice could use either their SIP address (sip:alice@a.example.com) or
   SIP telephone number (sip:+13145551111@ss1.a.example.com;user=phone)
   in the From header.  In this example, the telephone number is
   included, and it is shown as being passed as calling party
   identification through the Network Gateway (NGW 1) to Bob (F5).  Note
   that for this number to be passed into the SS7 network, it would have
   to be somehow verified for accuracy.

   In this scenario, Bob answers the call, then Alice disconnects the
   call.  Signaling between NGW 1 and Bob's telephone switch is ANSI
   ISUP.  For the details of SIP to ISUP mapping, refer to [4].

   In this flow, notice that the Contact returned by NGW 1 in messages
   F7-11 is sip:ngw1@a.example.com.  This is because NGW 1 only accepts
   SIP messages that come through Proxy 1 - any direct signaling will be
   ignored.  Since this Contact URI may be used outside of this dialog
   and must be routable (Section 8.1.1.8 in RFC 3261 [2]) the Contact
   URI for NGW 1 must resolve to Proxy 1.  This Contact URI resolves via
   DNS to Proxy 1 (sip:ss1.a.example.com) which then resolves it to
   sip:ngw1.a.example.com which is the address of NGW 1.

   This flow shows TCP transport.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com;transport=tcp>
   Proxy-Authorization: Digest username="alice", realm="a.example.com",
    nonce="dc3a5ab25302aa931904ba7d88fa1cf5", opaque="",
    uri="sip:+19725552222@ss1.a.example.com;user=phone",
    response="ccdca50cb091d587421457305d097458c"
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F2 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   /* Proxy 1 uses a Location Service function to determine the gateway
   for terminating this call.  The call is forwarded to NGW 1.  Client
   for A prepares to receive data on port 49172 from the
   network.*/


   F3 INVITE Proxy 1 -> NGW 1

   INVITE sip:+19725552222@ngw1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying NGW 1 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 IAM NGW 1 -> Bob

   IAM
   CdPN=972-555-2222,NPI=E.164,NOA=National
   CgPN=314-555-1111,NPI=E.164,NOA=National


   F6 ACM Bob -> NGW 1

   ACM


   F7 183 Session Progress NGW 1 -> Proxy 1

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* NGW 1 sends PSTN audio (ringing) in the RTP path to A */
   F8 183 Session Progress Proxy 1 -> Alice

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F9 ANM Bob -> NGW 1

   ANM


   F10 200 OK NGW 1 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F11 200 OK Proxy 1 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F12 ACK Alice -> Proxy 1

   ACK sip:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F13 ACK Proxy 1 -> NGW 1

   ACK sip:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* Alice Hangs Up with Bob. */


   F14 BYE Alice -> Proxy 1

   BYE sip:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F15 BYE Proxy 1 -> NGW 1

   BYE sip:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com

   CSeq: 2 BYE
   Content-Length: 0


   F16 200 OK NGW 1 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F17 200 OK Proxy 1 -> A

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F18 REL NGW 1 -> B

   REL
   CauseCode=16 Normal


   F19 RLC B -> NGW 1

   RLC


2.  Successful SIP to ISDN PBX call

   Alice            Proxy 1           GW 1             PBX C
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|                |                |
     |     100  F2    |                |                |
     |<---------------|   INVITE F3    |                |
     |                |--------------->|                |
     |                |     100  F4    |                |
     |                |<---------------|    SETUP F5    |
     |                |                |--------------->|
     |                |                |  CALL PROC F6  |
     |                |                |<---------------|
     |                |                |   PROGress F7  |
     |                |    180 F8      |<---------------|
     |    180 F9      |<---------------|                |
     |<---------------|                |                |
     |                |                |  One Way Voice |
     |                |                |<===============|
     |                |                |   CONNect F10  |
     |                |                |<---------------|
     |                |                | CONNect ACK F11|
     |                |    200 F12     |--------------->|
     |     200 F13    |<---------------|                |
     |<---------------|                |                |
     |     ACK F14    |                |                |
     |--------------->|     ACK F15    |                |
     |                |--------------->|                |
     |        Both Way RTP Media       | Both Way Voice |
     |<===============================>|<==============>|
     |     BYE F16    |                |                |
     |--------------->|     BYE F17    |                |
     |                |--------------->|                |
     |                |     200 F18    |                |
     |     200 F19    |<---------------| DISConnect F20 |
     |<---------------|                |--------------->|
     |                |                |   RELease F21  |
     |                |                |<---------------|
     |                |                | RELease COM F22|
     |                |                |--------------->|
     |                |                |                |

   Alice is a SIP device while Carol is connected via a Gateway (GW 1)
   to a PBX.  The PBX connection is via a ISDN trunk group.  Alice dials
   Carol's telephone number (918-555-3333) which is globalized and put
   into a SIP URI.

   The host portion of the Request-URI in the INVITE F3 is used to
   identify the context (customer, trunk group, or line) in which the
   private number 444-3333 is valid.  Otherwise, this INVITE message
   could get forwarded by GW 1 and the context of the digits could
   become lost and the call unroutable.

   Proxy 1 looks up the telephone number and locates the gateway that
   serves Carol.  Carol is identified by its extension (444-3333) in the
   Request-URI sent to GW 1.

   Note that the Contact URI for GW 1, as used in messages F8, F9, F12,
   and F13, is sips:4443333@gw1.a.example.com, which resolves directly
   to the gateway.

   This flow shows the use of Secure SIP (sips) URIs.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sips:+19185553333@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sips:alice@client.a.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="a.example.com", nonce="qo0dc3a5ab22aa931904badfa1cf5j9h",
    opaque="", uri="sips:+19185553333@ss1.a.example.com;user=phone",
    response="6c792f5c9fa360358b93c7fb826bf550"
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Content-Length: 0


   F3 INVITE Proxy 1 -> GW 1

   INVITE sips:4443333@gw1.a.example.com SIP/2.0
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sips:ss1.a.example.com;lr>
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sips:alice@client.a.example.com>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying GW -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Content-Length: 0

   F5 SETUP GW 1 -> Carol

   Protocol discriminator=Q.931
   Message type=SETUP
   Bearer capability: Information transfer capability=0 (Speech) or 16
   (3.1 kHz audio)
   Channel identification=Preferred or exclusive B-channel
   Progress indicator=1 (Call is not end-to-end ISDN;further call
   progress information may be available inband)
   Called party number:
   Type of number unknown
   Digits=444-3333


   F6 CALL PROCeeding Carol-> GW 1

   Protocol discriminator=Q.931
   Message type=CALL PROC
   Channel identification=Exclusive B-channel


   F7 PROGress Carol-> GW 1

   Protocol discriminator=Q.931
   Message type=PROG
   Progress indicator=1 (Call is not end-to-end ISDN;further call
   progress information may be available inband)


   F8 180 Ringing GW 1 -> Proxy 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sips:ss1.a.example.com;lr>
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sips:4443333@gw1.a.example.com>
   Content-Length: 0

   F9 180 Ringing Proxy 1 -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sips:ss1.a.example.com;lr>
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sips:4443333@gw1.a.example.com>
   Content-Length: 0


   F10 CONNect Carol-> GW 1

   Protocol discriminator=Q.931
   Message type=CONN


   F11 CONNect ACK GW 1 -> Carol

   Protocol discriminator=Q.931
   Message type=CONN ACK


   F12 200 OK GW 1 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sips:ss1.a.example.com;lr>
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sips:4443333@gw1.a.example.com>
   Content-Type: application/sdp
   Content-Length: 144

   v=0
   o=GW 2890844527 2890844527 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F13 200 OK Proxy 1 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sips:ss1.a.example.com;lr>
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sips:4443333@gw1.a.example.com>
   Content-Type: application/sdp
   Content-Length: 144

   v=0
   o=GW 2890844527 2890844527 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F14 ACK Alice -> Proxy 1

   ACK sips:4443333@gw1.a.example.com SIP/2.0
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sips:ss1.a.example.com;lr>
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 ACK
   Content-Length: 0

   F15 ACK Proxy 1 -> GW 1

   ACK sips:4443333@gw1.a.example.com SIP/2.0
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 ACK
   Content-Length: 0

   /* Alice Hangs Up with Bob. */


   F16 BYE Alice -> Proxy 1

   BYE sips:4443333@gw1.a.example.com SIP/2.0
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <sips:ss1.a.example.com;lr>
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 3 BYE
   Content-Length: 0


   F17 BYE Proxy 1 -> GW 1

   BYE sips:4443333@gw1.a.example.com SIP/2.0
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 3 BYE
   Content-Length: 0

   F18 200 OK GW 1 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 3 BYE
   Content-Length: 0


   F19 200 OK Proxy 1 -> A

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS client.a.example.com:5061;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sips:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Carol <sips:+19185553333@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 3 BYE
   Content-Length: 0


   F20 DISConnect GW 1 -> Carol

   Protocol discriminator=Q.931
   Message type=DISC
   Cause=16 (Normal clearing)


   F21 RELease Carol-> GW 1

   Protocol discriminator=Q.931
   Message type=REL


   F22 RELease COMplete GW 1 -> Carol

   Protocol discriminator=Q.931
   Message type=REL COM

2.3.  Successful SIP to ISUP PSTN call with overflow

   Alice          Proxy 1         NGW 1          NGW 2        Switch B
    |              |              |              |              |
    |  INVITE F1   |              |              |              |
    |------------->|              |              |              |
    |              |  INVITE F2   |              |              |
    |    100  F3   |------------->|              |              |
    |<-------------|    503 F4    |              |              |
    |              |<-------------|              |              |
    |              |    ACK F5    |              |              |
    |              |------------->|              |              |
    |              |   INVITE F6                 |              |
    |              |---------------------------->|     IAM F7   |
    |              |                             |------------->|
    |              |                             |     ACM F8   |
    |              |            183 F9           |<-------------|
    |   183 F10    |<----------------------------|              |
    |<-------------|                             |              |
    |               Two Way RTP Media            | One Way Voice|
    |<==========================================>|<=============|
    |              |                             |    ANM F11   |
    |              |           200 F12           |<-------------|
    |    200 F13   |<----------------------------|              |
    |<-------------|                             |              |
    |    ACK F14   |                             |              |
    |------------->|            ACK F15          |              |
    |              |---------------------------->|              |
    |             Both Way RTP Media             |Both Way Voice|
    |<==========================================>|<============>|
    |    BYE F16   |                             |              |
    |------------->|           BYE F17           |              |
    |              |---------------------------->|              |
    |              |           200 F18           |              |
    |    200 F19   |<----------------------------|    REL F20   |
    |<-------------|                             |------------->|
    |              |                             |    RLC F21   |
    |              |                             |<-------------|
    |              |                             |              |

   Alice calls Bob through Proxy 1.  Proxy 1 tries to route to a Network
   Gateway NGW 1.  NGW 1 is not available and responds with a 503
   Service Unavailable (F4).  The call is then routed to Network Gateway
   NGW 2.  Bob answers the call.  The call is terminated when Alice
   disconnects the call.  NGW 2 and Bob's telephone switch use ANSI ISUP
   signaling.

   NGW 2 also only accepts SIP messages that come through Proxy 1, so
   the Contact URI sip:ngw2@a.example.com is used in this flow.

   This flow shows UDP transport.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="a.example.com", nonce="b59311c3ba05b401cf80b2a2c5ac51b0",
    opaque="", uri="sip:+19725552222@ss1.a.example.com;user=phone",
    response="ba6ab44923fa2614b28e3e3957789ab0"
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine where B is
   located.  Proxy 1 receives a primary route NGW 1 and a secondary
   route NGW 2.  NGW 1 is tried first */


   F2 INVITE Proxy 1 -> NGW 1

   INVITE sip:+19725552222@ngw1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F3 100 Trying Proxy 1 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F4 503 Service Unavailable NGW 1 -> Proxy 1

   SIP/2.0 503 Service Unavailable
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=123456789
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F5 ACK Proxy 1 -> NGW 1

   ACK sip:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com>;user=phone>
    ;tag=123456789
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* Proxy 1 now tries secondary route to NGW 2 */


   F6 INVITE Proxy 1 -> NGW 2

   INVITE sip:+19725552222@ngw2.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F7 IAM NGW 2 -> Bob

   IAM
   CdPN=972-555-2222,NPI=E.164,NOA=National
   CgPN=314-555-1111,NPI=E.164,NOA=National

   F8 ACM Bob -> NGW 2

   ACM


   F9 183 Session Progress NGW 2 -> Proxy 1

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw2@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw2.a.example.com
   s=-
   c=IN IP4 ngw2.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* RTP packets are sent by GW to A for audio (e.g. ring tone) */


   F10 183 Session Progress Proxy 1 -> Alice

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw2@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw2.a.example.com
   s=-
   c=IN IP4 ngw2.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F11 ANM Bob -> NGW 2

   ANM


   F12 200 OK NGW 2 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw2@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw2.a.example.com
   s=-
   c=IN IP4 ngw2.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F13 200 OK Proxy 1 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101

   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw2@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw2.a.example.com
   s=-
   c=IN IP4 ngw2.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F14 ACK Alice -> Proxy 1

   ACK sip:ngw2@a.example.com SIP/2.0
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F15 ACK Proxy 1 -> NGW 2

   ACK sip:ngw2@a.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* RTP streams are established between A and B(via the GW) */

   /* Alice Hangs Up with Bob. */


   F16 BYE Alice -> Proxy 1

   BYE sip:ngw2@a.example.com SIP/2.0
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   Route: <ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F17 BYE Proxy 1 -> NGW 2

   BYE sip:ngw2@a.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F18 200 OK NGW 2 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F19 200 OK Proxy 1 -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F20 REL NGW 2 -> B

   REL
   CauseCode=16 Normal


   F21 RLC B -> NGW 2

   RLC

2.4.  Successful SIP to SIP using ENUM Query

   Alice         DNS Server         Proxy 3            Bob
     |                |                |                |
     |  ENUM Query F1 |                |                |
     |--------------->|                |                |
     |   Response F2  |                |                |
     |<---------------|                |                |
     |            INVITE F3            |                |
     |-------------------------------->|    INVITE F4   |
     |             100 F5              |--------------->|
     |<--------------------------------|      180 F6    |
     |             180 F7              |<---------------|
     |<--------------------------------|                |
     |                                 |     200 F8     |
     |             200 F9              |<---------------|
     |<--------------------------------|                |
     |             ACK F10             |                |
     |-------------------------------->|     ACK F11    |
     |                                 |--------------->|
     |                Both Way RTP Media                |
     |<================================================>|
     |                                 |     BYE F12    |
     |             BYE F13             |<---------------|
     |<--------------------------------|                |
     |             200 F14             |                |
     |-------------------------------->|     200 F15    |
     |                                 |--------------->|
     |                                 |                |

   In this scenario, Alice places a call to Bob by dialing Bob's
   telephone number (9725552222).  Alice's UA converts the phone number
   to an E.164 number (+19725552222), and performs an ENUM query [9] on
   the E.164 number (2.2.2.2.5.5.5.2.7.9.1.e164.arpa), which returns a
   NAPTR record containing a SIP AOR URI for Bob
   (sip:+19725552222@b.example.com).  As a result, Alice's UA sends an
   INVITE and the call completes over IP bypassing the PSTN.

   The call is terminated when Bob sends a BYE message.

   Message Details

   F1 ENUM Query Alice -> DNS Server

   2.2.2.2.5.5.5.2.7.9.1.e164.arpa

   F2 ENUM NAPTR Set DNS Server -> Alice

   $ORIGIN 2.2.2.2.5.5.5.2.7.9.1.e164.arpa.
         IN NAPTR 100 10 "u" "sip+E2U"
                "!^.*$!sip:+19725552222@b.example.com!".


   F3 INVITE Alice -> Proxy 3

   INVITE sip:+19725552222@b.example.com SIP/2.0
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sip:+13145551111@client.a.example.com>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 INVITE Proxy 3 -> Bob

   INVITE sip:+19725552222@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ss3.b.example.com:5060;branch=z9hG4bK721e418c4.1
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss3.b.example.com;lr>
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sip:+13145551111@client.a.example.com>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=UserA 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F5 100 Trying Proxy 3 -> Alice

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Content-Length: 0


   F6 180 Ringing B -> Proxy 3

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss3.b.example.com:5060;branch=z9hG4bK721e418c4.1
    ;received=192.0.2.233
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss3.b.example.com;lr>
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sip:+19725552222@client.b.example.com>
   Content-Length: 0


   F7 180 Ringing Proxy 3 -> Alice

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss3.b.example.com;lr>
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sip:+19725552222@client.b.example.com>
   Content-Length: 0

   F8 200 OK Bob -> Proxy 3

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss3.b.example.com:5060;branch=z9hG4bK721e418c4.1
    ;received=192.0.2.233
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss3.b.example.com;lr>
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sip:+19725552222@client.b.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.b.example.com
   s=-
   c=IN IP4 client.b.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F9 200 OK Proxy -> Alice

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss3.b.example.com;lr>
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 INVITE
   Contact: <sip:+19725552222@client.b.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.b.example.com
   s=-
   c=IN IP4 192.0.2.100
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F10 ACK Alice -> Proxy 3

   ACK sip:+19725552222@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bq9
   Max-Forwards: 70
   Route: <sip:ss3.b.example.com;lr>
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 ACK
   Content-Length: 0


   F11 ACK Proxy 3 -> Bob

   ACK sip:+19725552222@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ss3.b.example.com:5060;branch=z9hG4bK721e418c4.1
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bq9
    ;received=192.0.2.101
   Max-Forwards: 69
   From: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   To: <tel:+19725552222>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 2 ACK
   Content-Type: application/sdp
   Content-Length: 0

   /* RTP streams are established between A and B*/

   /* User B Hangs Up with User A. */


   F12 BYE Bob -> Proxy 3

   BYE sip:+13145551111@client.a.example.com SIP/2.0
   Via: SIP/2.0/UDP client.b.example.com:5060;branch=z9hG4bKfgaw2
   Max-Forwards: 70
   Route: <sip:ss3.b.example.com;lr>
   From: <tel:+19725552222>;tag=314159
   To: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F13 BYE Proxy 3 -> Alice

   BYE sip:+13145551111@client.a.example.com SIP/2.0
   Via: SIP/2.0/UDP ss3.b.example.com:5060;branch=z9hG4bK721e418c4.1
    ;received=192.0.2.100
   Via: SIP/2.0/UDP client.b.example.com:5060;branch=z9hG4bKfgaw2
   Max-Forwards: 69
   From: <tel:+19725552222>;tag=314159
   To: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F14 200 OK Alice -> Proxy 3

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss3.b.example.com:5060;branch=z9hG4bK721e418c4.1
    ;received=192.0.2.233
   Via: SIP/2.0/UDP client.b.example.com:5060;branch=z9hG4bKfgaw2
    ;received=192.0.2.100
   From: <tel:+19725552222>;tag=314159
   To: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F15 200 OK Proxy 3 -> Bob

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.b.example.com:5060;branch=z9hG4bKfgaw2
    ;received=192.0.2.100
   From: <tel:+19725552222>;tag=314159
   To: <sip:+13145551111@a.example.com>;tag=9fxced76sl
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 BYE
   Content-Length: 0


2.5.  Unsuccessful SIP to PSTN call: Treatment from PSTN

   Alice            Proxy 1           NGW 1            Bob
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|                |                |
     |     100  F2    |                |                |
     |<---------------|   INVITE F3    |                |
     |                |--------------->|                |
     |                |     100  F4    |                |
     |                |<---------------|     IAM F5     |
     |                |                |--------------->|
     |                |                |     ACM F6     |
     |                |     183 F7     |<---------------|
     |     183 F8     |<---------------|                |
     |<---------------|                |                |
     |         Two Way RTP Media       |  One Way Voice |
     |<===============================>|<===============|
     |                 Treatment Applied                |
     |<=================================================|
     |   CANCEL F9    |                |                |
     |--------------->|                |                |
     |     200 F10    |                |                |
     |<---------------|   CANCEL F11   |                |
     |                |--------------->|                |
     |                |     200 F12    |                |
     |                |<---------------|     REL F13    |
     |                |                |--------------->|
     |                |                |     RLC F14    |
     |                |     487 F15    |<---------------|
     |                |<---------------|                |
     |                |     ACK F16    |                |
     |     487 F17    |--------------->|                |
     |<---------------|                |                |
     |     ACK F18    |                |                |
     |--------------->|                |                |
     |                |                |                |

   Alice calls Bob in the PSTN through a proxy server Proxy 1 and a
   Network Gateway NGW 1.  The call is rejected by the PSTN with an
   in-band treatment (tone or recording) played.  Alice hears the
   treatment and then hangs up, which results in a CANCEL (F9) being
   sent to terminate the call.  (A BYE is not sent since no final
   response was ever received by Alice.)


   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com>
   Proxy-Authorization: Digest username="alice",
    realm="a.example.com", nonce="01cf8311c3b0b2a2c5ac51bb59a05b40",
    opaque="", uri="sip:+19725552222@ss1.a.example.com;user=phone",
    response="e178fbe430e6680a1690261af8831f40"
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 100 Trying Proxy 1 -> A

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   /* Proxy 1 uses a Location Service function to determine where B is
   located.  Based upon location analysis the call is forwarded to NGW
   1.  Client for A prepares to receive data on port 49172 from the
   network. */


   F3 INVITE Proxy 1 -> NGW 1

   INVITE sip:+19725552222@ngw1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying NGW 1 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 IAM NGW 1 -> Bob

   IAM
   CdPN=972-555-2222,NPI=E.164,NOA=National
   CgPN=314-555-1111,NPI=E.164,NOA=National


   F6 ACM Bob -> NGW 1

   ACM


   F7 183 Session Progress NGW 1 -> Proxy 1

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F8 183 Session Progress Proxy 1 -> Alice

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Caller hears the recorded announcement, then hangs up */


   F9 CANCEL Alice -> Proxy 1

   CANCEL sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F10 200 OK Proxy 1 -> A

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F11 CANCEL Proxy 1 -> NGW 1

   CANCEL sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0

   F12 200 OK NGW 1 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F13 REL NGW 1 -> B

   REL
   CauseCode=18 No user responding


   F14 RLC B -> NGW 1

   RLC


   F15 487 Request Terminated NGW 1 -> Proxy 1

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F16 ACK Proxy 1 -> NGW 1

   ACK sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F17 487 Request Terminated Proxy 1 -> A

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F18 ACK Alice -> Proxy 1

   ACK sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0



2.6.  Unsuccessful SIP to PSTN: REL w/Cause from PSTN

   Alice            Proxy 1           NGW 1           Switch B
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|                |                |
     |     100  F2    |                |                |
     |<---------------|   INVITE F3    |                |
     |                |--------------->|                |
     |                |     100  F4    |                |
     |                |<---------------|     IAM F5     |
     |                |                |--------------->|
     |                |                |    REL(1) F6   |
     |                |                |<---------------|
     |                |                |     RLC F7     |
     |                |     404 F8     |--------------->|
     |                |<---------------|                |
     |                |     ACK F9     |                |
     |                |--------------->|                |
     |     404 F10    |                |                |
     |<---------------|                |                |
     |     ACK F11    |                |                |
     |--------------->|                |                |
     |                |                |                |

   Alice calls PSTN Bob through a Proxy Server Proxy 1 and a Network
   Gateway NGW 1.  The call is rejected by the PSTN with a ANSI ISUP
   Release message REL containing a specific Cause code.  This cause
   value (1) is mapped by the Gateway to a SIP 404 Address Incomplete
   response which is proxied back to Alice.  For more details of ISUP
   cause value to SIP response mapping, refer to [4].

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:+44-1234@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+44-1234@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com;transport=tcp>
   Proxy-Authorization: Digest username="alice",
    realm="a.example.com", nonce="j1c3b0b01cf832da2c5ac51bb59a05b40",
    opaque="", uri="sip:+44-1234@ss1.a.example.com;user=phone",
    response="a451358d46b55512863efe1dccaa2f42"
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F2 100 Trying Proxy 1 -> A

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+44-1234@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   /* Proxy 1 uses a Location Service function to determine where B is
   located.  Based upon location analysis the call is forwarded to NGW1.
   Client for A prepares to receive data on port 49172 from the network.
   */


   F3 INVITE Proxy 1 -> NGW 1

   INVITE sip:+44-1234@ngw1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+44-1234@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying NGW 1 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+44-1234@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 IAM NGW 1 -> Bob

   IAM
   CdPN=44-1234,NPI=E.164,NOA=International
   CgPN=314-555-1111,NPI=E.164,NOA=National


   F6 REL Bob -> NGW 1

   REL
   CauseValue=1 Unallocated number


   F7 RLC NGW 1 -> Bob

   RLC

   /* Network Gateway maps CauseValue=1 to the SIP message 404 Not
      Found */

   F8 404 Not Found NGW 1 -> Proxy 1

   SIP/2.0 404 Not Found
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+44-1234@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Error-Info: <sip:not-found-ann@ann.a.example.com>
   Content-Length: 0


   F9 ACK Proxy 1 -> NGW 1

   ACK sip:+44-1234@ngw1.a.example.com;user=phone SIP/2.0
   Max-Forwards: 70
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+44-1234@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F10 404 Not Found Proxy 1 -> Alice

   SIP/2.0 404 Not Found
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+44-1234@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Error-Info: <sip:not-found-ann@ann.a.example.com>
   Content-Length: 0


   F11 ACK Alice -> Proxy 1

   ACK sip:+44-1234@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+44-1234@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0


2.7.  Unsuccessful SIP to PSTN: ANM Timeout

   Alice           Proxy 1           NGW 1           Switch B
     |                |                |                |
     |   INVITE F1    |                |                |
     |--------------->|                |                |
     |     100  F2    |                |                |
     |<---------------|   INVITE F3    |                |
     |                |--------------->|                |
     |                |     100  F4    |                |
     |                |<---------------|     IAM F5     |
     |                |                |--------------->|
     |                |                |     ACM F6     |
     |                |      183 F7    |<---------------|
     |     183 F8     |<---------------|                |
     |<---------------|                |                |
     |                |      Timer on NGW 1 Expires     |
     |                |                |                |
     |                |                |     REL F9     |
     |                |                |--------------->|
     |                |                |    RLC F10     |
     |                |     480 F11    |<---------------|
     |                |<---------------|                |
     |                |     ACK F12    |                |
     |                |--------------->|                |
     |     480 F13    |                |                |
     |<---------------|                |                |
     |     ACK F14    |                |                |
     |--------------->|                |                |

   Alice calls Bob in the PSTN through a proxy server Proxy 1 and
   Network Gateway NGW 1.  The call is released by the Gateway after a
   timer expires due to no ANswer Message (ANM) being received.  The
   Gateway sends an ISUP Release REL message to the PSTN and a 480
   Temporarily Unavailable response to Alice in the SIP network.

   Message Details

   F1 INVITE Alice -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com;transport=tcp>
   Proxy-Authorization: Digest username="alice",
    realm="a.example.com", nonce="da2c5ac51bb59a05j1c3b0b01cf832b40",
    opaque="", uri="sip:+19725552222@ss1.a.example.com;user=phone",
    response="579cb9db184cdc25bf816f37cbc03c7d"
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine where B is
   located.  Based upon location analysis the call is forwarded to NGW
   1.  Client for A prepares to receive data on port 49172 from the
   network.*/


   F2 100 Trying Proxy 1 -> A

   SIP/2.0  100 Trying
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0

   F3 INVITE Proxy 1 -> NGW 1

   INVITE sip:+19725552222@ngw1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:alice@client.a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 154

   v=0
   o=alice 2890844526 2890844526 IN IP4 client.a.example.com
   s=-
   c=IN IP4 client.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying NGW 1 -> Proxy 1

   SIP/2.0  100 Trying
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 IAM NGW 1 -> Bob

   IAM
   CdPN=972-555-2222,NPI=E.164,NOA=National
   CgPN=314-555-1111,NPI=E.164,NOA=National


   F6 ACM Bob -> NGW 1

   ACM


   F7 183 Session Progress NGW 1 -> Proxy 1

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F8 183 Session Progress Proxy 1 -> Alice

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   Record-Route: <sip:ss1.a.example.com;lr>
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* After NGW 1's timer expires, Network Gateway sends REL to ISUP
   network and 480 to SIP network */


   F9 REL NGW 1 -> Bob

   REL

   CauseCode=18 No user responding


   F10 RLC Bob -> NGW 1

   RLC


   F11 480 Temporarily Unavailable NGW 1 -> Proxy 1

   SIP/2.0 480 Temporarily Unavailable
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Error-Info: <sip:temp-unavail-ann@ann.a.example.com>
   Content-Length: 0


   F12 ACK Proxy 1 -> NGW 1

   ACK sip:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl

   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F13 480 Temporarily Unavailable F13 Proxy 1 -> Alice

   SIP/2.0 480 Temporarily Unavailable
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 INVITE
   Error-Info: <sip:temp-unavail-ann@ann.a.example.com>
   Content-Length: 0


   F14 ACK Alice -> Proxy 1

   ACK sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Max-Forwards: 70
   Via: SIP/2.0/TCP client.a.example.com:5060;branch=z9hG4bK74bf9
   From: Alice <sip:+13145551111@ss1.a.example.com;user=phone>
    ;tag=9fxced76sl
   To: Bob <sip:+19725552222@ss1.a.example.com;user=phone>
    ;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@a.example.com
   CSeq: 1 ACK
   Content-Length: 0


-->  PSTN to SIP Dialing

   In these scenarios, Alice is placing calls from the PSTN to Bob in a
   SIP network.  Alice's telephone switch signals to a Network Gateway
   (NGW 1) using ANSI ISUP.

   Since the called SIP User Agent does not send in-band signaling
   information, no early media path needs to be established on the IP
   side.  As a result, the 183 Session Progress response is not used.
   However, NGW 1 will establish a one way speech path prior to call
   completion, and generate ringing for the PSTN caller.  Any tones or
   recordings are generated by NGW 1 and played in this speech path.
   When the call completes successfully, NGW 1 bridges the PSTN speech
   path with the IP media path.

   To reduce the number of messages, only a single proxy server is shown
   in these flows, which means that the a.example.com proxy server has
   access to the b.example.com location service.

3.1.  Successful PSTN to SIP call

   Switch A          NGW 1          Proxy 1           Bob
     |                |                |                |
     |     IAM F1     |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|   INVITE F3    |
     |                |     100  F4    |--------------->|
     |                |<---------------|                |
     |                |                |      180 F5    |
     |                |    180 F6      |<---------------|
     |     ACM F7     |<---------------|                |
     |<---------------|                |                |
     |  One Way Voice |                |                |
     |<===============|                |                |
     |  Ringing Tone  |                |      200 F8    |
     |<===============|    200 F9      |<---------------|
     |                |<---------------|                |
     |                |     ACK F10    |                |
     |     ANM F12    |--------------->|     ACK F11    |
     |<---------------|                |--------------->|
     | Both Way Voice |        Both Way RTP Media       |
     |<==============>|<===============================>|
     |     REL F13    |                |                |
     |--------------->|                |                |
     |     RLC F14    |                |                |
     |<---------------|     BYE F15    |                |
     |                |--------------->|     BYE F16    |
     |                |                |--------------->|
     |                |                |     200 F17    |
     |                |     200 F18    |<---------------|
     |                |<---------------|                |
     |                |                |                |

   In this scenario, Alice from the PSTN calls Bob through a Network
   Gateway NGW1 and Proxy Server Proxy 1.  When Bob answers the call,
   the media path is setup end-to-end.  The call terminates when Alice
   hangs up the call, with Alice's telephone switch sending an ISUP
   RELease message that is mapped to a BYE by NGW 1.

   Message Details

   F1 IAM Alice -> NGW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=972-555-2222,NPI=E.164,NOA=National


   F2 INVITE Alice -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine where B is
   located.  Based upon location analysis the call is forwarded to NGW
   1.  NGW 1  prepares to receive data on port 3456 from Alice.*/
   F3 INVITE Proxy 1 -> Bob

   INVITE sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying Bob -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 180 Ringing Bob -> Proxy 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com>
   Content-Length: 0


   F6 180 Ringing Proxy 1 -> NGW 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com>
   Content-Length: 0


   F7 ACM NGW 1 -> Alice

   ACM


   F8 200 OK Bob -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   Contact: <sip:bob@client.b.example.com>
   CSeq: 1 INVITE
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.b.example.com
   s=-
   c=IN IP4 client.b.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F9 200 OK Proxy 1 -> NGW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.b.example.com
   s=-
   c=IN IP4 client.b.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F10 ACK NGW 1 -> Proxy 1

   ACK sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F11 ACK Proxy 1 -> Bob

   ACK sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F12 ANM Bob -> NGW 1

   ANM

   /* RTP streams are established between A and B (via the GW) */

   /* Alice Hangs Up with Bob. */


   F13 REL Alice -> NGW 1

   REL
   CauseCode=16 Normal


   F14 RLC NGW 1 -> Alice

   RLC


   F15 BYE NGW 1-> Proxy 1

   BYE sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F16 BYE Proxy 1 -> Bob

   BYE sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F17 200 OK Bob -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F18 200 OK Proxy 1 -> NGW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0



3.2.  Successful PSTN to SIP call, Fast Answer

   Switch A           NGW 1          Proxy 1           Bob
     |                |                |                |
     |     IAM F1     |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|   INVITE F3    |
     |                |     100  F4    |--------------->|
     |                |<---------------|                |
     |                |                |      200 F5    |
     |                |     200 F6     |<---------------|
     |                |<---------------|                |
     |                |     ACK F7     |                |
     |     ANM F9     |--------------->|     ACK F8     |
     |<---------------|                |--------------->|
     | Both Way Voice |        Both Way RTP Media       |
     |<==============>|<===============================>|
     |     REL F10    |                |                |
     |--------------->|                |                |
     |     RLC F11    |                |                |
     |<---------------|     BYE F12    |                |
     |                |--------------->|     BYE F13    |
     |                |                |--------------->|
     |                |                |     200 F14    |
     |                |     200 F15    |<---------------|
     |                |<---------------|                |
     |                |                |                |

   This "fast answer" scenario is similar to 3.1., except that Bob
   immediately accepts the call, sending a 200 OK (F5) without sending a
   180 Ringing response.  The Gateway then sends an Answer Message (ANM)
   without sending an Address Complete Message (ACM).  Note that for
   ETSI and some other ISUP variants, a CONnect message (CON) would be
   sent instead of the ANM.

   Message Details

   F1 IAM Alice -> NGW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=972-555-2222,NPI=E.164,NOA=National


   F2 INVITE NGW 1 -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine where B is
   located.  Based upon location analysis the call is forwarded to User
   B.  Bob  prepares to receive data on port 3456 from Alice.*/


   F3 INVITE Proxy 1 -> Bob

   INVITE bob@b.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000
   F4 100 Trying Proxy 1 -> NGW 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 200 OK Bob -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.b.example.com
   s=-
   c=IN IP4 client.b.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F6 200 OK Proxy 1 -> NGW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.b.example.com
   s=-
   c=IN IP4 client.b.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F7 ACK NGW 1 -> Proxy 1

   ACK bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F8 ACK Proxy 1 -> Bob

   ACK bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=130.131.132.14
   Max-Forwards: 69
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F9 ANM Bob -> NGW 1

   ANM

   /* RTP streams are established between A and B (via the GW) */

   /* Alice Hangs Up with Bob. */

   F10 REL ser Alice -> NGW 1

   REL
   CauseCode=16 Normal


   F11 RLC NGW 1 -> Alice

   RLC


   F12 BYE NGW 1 -> Proxy 1

   BYE sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F13 BYE Proxy 1 -> Bob

   BYE sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F14 200 OK Bob -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F15 200 OK Proxy 1 -> NGW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0



3.3.  Successful PBX to SIP call

   PBX A            GW 1           Proxy 1           Bob
     |                |                |                |
     |    Seizure     |                |                |
     |--------------->|                |                |
     |      Wink      |                |                |
     |<---------------|                |                |
     |  MF Digits F1  |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|   INVITE F3    |
     |                |     100  F4    |--------------->|
     |                |<---------------|                |
     |                |                |      180 F5    |
     |                |    180 F6      |<---------------|
     |                |<---------------|                |
     |  One Way Voice |                |                |
     |<===============|                |                |
     |  Ringing Tone  |                |      200 F7    |
     |<===============|     200 F8     |<---------------|
     |                |<---------------|                |
     |                |     ACK F9     |                |
     |     Seizure    |--------------->|     ACK F10    |
     |<---------------|                |--------------->|
     | Both Way Voice |        Both Way RTP Media       |
     |<==============>|<===============================>|
     | Seizure Removal|                |                |
     |--------------->|                |                |
     | Seizure Removal|                |                |
     |<---------------|     BYE F11    |                |
     |                |--------------->|     BYE F12    |
     |                |                |--------------->|
     |                |                |     200 F13    |
     |                |     200 F14    |<---------------|
     |                |<---------------|                |
     |                |                |                |

   In this scenario, Alice dials from PBX A to Bob through GW 1 and
   Proxy 1.  This is an example of a call that appears destined for the
   PSTN but is instead routed to a SIP Client.

   Signaling between PBX A and GW 1 is Feature Group B (FGB) circuit
   associated signaling, in-band Mult-Frequency (MF) outpulsing.  After
   the receipt of the 180 Ringing from Bob, GW 1 generates a ringing
   tone for Alice.

   Bob answers the call by sending a 200 OK.  The call terminates when
   Alice hangs up, causing GW1 to send a BYE.

   The  Gateway can only identify the trunk group that the call came in
   on; it cannot identify the individual line on PBX A that is placing
   the call.  The SIP URI used to identify the caller is shown in these
   flows as sip:551313@gw1.a.example.com.

   Message Details

   PBX Alice -> GW 1

   Seizure

   GW 1 -> PBX A

   Wink

   F1 MF Digits PBX Alice -> GW 1

   KP 1 972 555 2222 ST


   F2 INVITE GW 1 -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
   Max-Forwards: 70
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:551313@gw1.a.example.com;user=phone>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine where the
   phone number +19725552222 is located.  Based upon location
   analysis the call is forwarded to SIP Bob. */

   F3 INVITE Proxy 1 -> Bob

   INVITE sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:551313@gw1.a.example.com;user=phone>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying Proxy 1 -> GW 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 180 Ringing Bob -> Proxy 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com>
   Content-Length: 0


   F6 180 Ringing Proxy 1 -> GW 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com>
   Content-Length: 0

   /* One way Voice path is established between GW and the PBX for
   ringing. */


   F7 200 OK Bob -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   Contact: <sip:bob@client.b.example.com>
   CSeq: 1 INVITE
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.b.example.com
   s=-
   c=IN IP4 client.b.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   F8 200 OK Proxy 1 -> GW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com>
   Content-Type: application/sdp
   Content-Length: 151

   v=0
   o=bob 2890844527 2890844527 IN IP4 client.b.example.com
   s=-
   c=IN IP4 client.b.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F9 ACK GW 1 -> Proxy 1

   ACK sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F10 ACK Proxy 1 -> Bob

   ACK sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Max-Forwards: 69
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* RTP streams are established between A and B (via the GW) */

   /* Alice Hangs Up with Bob. */


   F11 BYE GW 1 -> Proxy 1

   BYE sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F12 BYE Proxy 1 -> Bob

   BYE sip:bob@client.b.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Max-Forwards: 69
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F13 200 OK Bob -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0


   F14 200 OK Proxy 1 -> GW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   From: <sip:551313@gw1.a.example.com;user=phone>;tag=jwdkallkzm
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 2 BYE
   Content-Length: 0



3.4.  Unsuccessful PSTN to SIP REL, SIP error mapped to REL

   Switch A            GW 1          Proxy 1           Bob
     |                |                |                |
     |     IAM F1     |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|                |
     |                |     604 F3     |                |
     |                |<---------------|                |
     |                |     ACK F4     |                |
     |                |--------------->|                |
     |     REL F5     |                |                |
     |<---------------|                |                |
     |     RLC F6     |                |                |
     |--------------->|                |                |
     |                |                |                |

   Alice attempts to place a call through Gateway GW 1 and Proxy 1,
   which is unable to find any routing for the number.  The call is
   rejected by Proxy 1 with a REL message containing a specific Cause
   value mapped by the gateway based on the SIP error.

   Message Details

   F1 IAM Alice -> GW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=972-555-9999,NPI=E.164,NOA=National


   F2 INVITE Alice -> Proxy 1

   INVITE sip:+1972559999@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@gw1.a.example.com;user=phone>;tag=076342s
   To: <sip:+1972559999@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 INVITE
   Contact:
   <sip:+13145551111@gw1.a.example.com;user=phone;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 144

   v=0
   o=GW 2890844527 2890844527 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service to find a route to +1-972-555-
   9999.  A route is not found, so Proxy 1 rejects the call. */


   F3 604 Does Not Exist Anywhere Proxy 1 -> GW 1

   SIP/2.0 604 Does Not Exist Anywhere
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   From: <sip:+13145551111@gw1.a.example.com;user=phone>;tag=076342s
   To: <sip:+1972559999@ss1.a.example.com;user=phone>;tag=6a34d410
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 INVITE
   Error-Info: <sip:does-not-exist@ann.a.example.com>
   Content-Length: 0


   F4 ACK GW 1 -> Proxy 1

   ACK sip:+1972559999@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@gw1.a.example.com;user=phone>;tag=076342s
   To: <sip:+1972559999@ss1.a.example.com;user=phone>;tag=6a34d410
   Call-ID: 4Fde34wkd11wsGFDs3@gw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   F5 REL GW 1 -> Alice

   REL
   CauseCode=1


   F6 RLC Alice -> GW 1

   RLC


3.5.  Unsuccessful PSTN to SIP REL, SIP busy mapped to REL

   Switch A          NGW 1           Proxy 1          Bob
     |                |                |                |
     |     IAM F1     |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|   INVITE F3    |
     |                |     100  F4    |--------------->|
     |                |<---------------|                |
     |                |                |      600 F5    |
     |                |                |<---------------|
     |                |                |      ACK F6    |
     |                |     600 F7     |--------------->|
     |                |<---------------|                |
     |                |     ACK F8     |                |
     |                |--------------->|                |
     |   REL(17) F9   |                |                |
     |<---------------|                |                |
     |     RLC F10    |                |                |
     |<-------------->|                |                |
     |                |                |                |

   In this scenario, Alice calls Bob through Network Gateway NGW 1 and
   Proxy 1.  The call is routed to Bob by Proxy 1.  The call is rejected
   by Bob who sends a 600 Busy Everywhere response.  The Gateway sends a
   REL message containing a specific Cause value mapped by the gateway
   based on the SIP error.

   Since no interworking is indicated in the IAM (F1), the busy tone is
   generated locally by Alice's telephone switch.  In some scenarios,
   the busy signal is generated by the Gateway since interworking is
   indicated.  For more discussion on interworking, refer to [4].

   Message Details

   F1 IAM Alice -> NGW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=972-555-2222,NPI=E.164,NOA=National


   F2 INVITE Alice -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 144

   v=0
   o=GW 2890844527 2890844527 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine a route for
   +19725552222.  The call is then forwarded to Bob. */


   F3 INVITE F3 Proxy 1 -> Bob

   INVITE bob@b.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 144

   v=0
   o=GW 2890844527 2890844527 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying Proxy 1 -> NGW 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 600 Busy Everywhere Bob -> Proxy 1

   SIP/2.0 600 Busy Everywhere
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F6 ACK Proxy 1 -> Bob

   ACK bob@b.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   F7 600 Busy Everywhere Proxy 1 -> NGW 1

   SIP/2.0 600 Busy Everywhere
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F8 ACK NGW 1 -> Proxy 1

   ACK bob@b.example.com SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F9 REL NGW 1 -> Alice

   REL
   CauseCode=17 Busy


   F10 RLC Alice -> NGW 1

   RLC


3.6.  Unsuccessful PSTN->SIP, SIP error interworking to tones

   Switch A          NGW 1           Proxy 1          Bob
     |                |                |                |
     |     IAM F1     |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|   INVITE F3    |
     |                |     100  F4    |--------------->|
     |                |<---------------|                |
     |                |                |      600 F5    |
     |                |                |<---------------|
     |                |                |      ACK F6    |
     |                |     600 F7     |--------------->|
     |                |<---------------|                |
     |                |     ACK F8     |                |
     |     ACM F9     |--------------->|                |
     |<---------------|                |                |
     | One Way Voice  |                |                |
     |<===============|                |                |
     |    Busy Tone   |                |                |
     |<===============|                |                |
     |   REL(16) F10  |                |                |
     |--------------->|                |                |
     |     RLC F11    |                |                |
     |<---------------|                |                |
     |                |                |                |

   In this scenario, Alice calls Bob through Network Gateway NGW 1 and
   Proxy 1.  The call is routed to Bob by Proxy 1.  The call is rejected
   by the Bob client.  NGW 1 sets up a two way voice path to Alice and
   plays busy tone.  The caller then disconnects

   NGW 1 plays the busy tone since the IAM (F1) indicates the
   interworking is present.  In scenario 5.2.2., with no interworking,
   the busy indication is carried in the REL Cause value and is
   generated locally instead.

   Again, note that for ETSI or ITU ISUP, a CONnect message would be
   sent instead of the Answer Message.

   Message Details

   F1 IAM Alice -> NGW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=972-555-2222,NPI=E.164,NOA=National
   Interworking=encountered

   F2 INVITE NGW1 -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine a route for
   +19725552222.  The call is then forwarded to Bob. */


   F3 INVITE Proxy 1 -> Bob

   INVITE bob@b.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying Bob -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 600 Busy Everywhere Bob -> Proxy 1

   SIP/2.0 600 Busy Everywhere
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F6 ACK Proxy 1 -> Bob

   ACK bob@b.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   F7 600 Busy Everywhere Proxy 1 -> NGW 1

   SIP/2.0 600 Busy Everywhere
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F8 ACK NGW 1 -> Proxy 1

   ACK sip:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F9 ACM NGW 1 -> Alice

   ACM

   /* A one way speech path is established between NGW 1 and Alice. */

   /* Call Released after Alice hangs up. */


   F10 REL Alice -> NGW 1

   REL
   CauseCode=16


   F11 RLC NGW 1 -> Alice

   RLC


3.7.  Unsuccessful PSTN->SIP, ACM timeout

   Switch A          NGW 1           Proxy 1          Bob
     |                |                |                |
     |     IAM F1     |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|   INVITE F3    |
     |                |     100  F4    |--------------->|
     |                |<---------------|                |
     |                |                |   INVITE F5    |
     |                |                |--------------->|
     |                |                |   INVITE F6    |
     |                |                |--------------->|
     |                |                |   INVITE F7    |
     |                |                |--------------->|
     |                |                |   INVITE F8    |
     |                |                |--------------->|
     |                |                |   INVITE F9    |
     |                |                |--------------->|
     |     REL F10    |                |                |
     |--------------->|                |                |
     |     RLC F11    |                |                |
     |<---------------|                |                |
     |                |   CANCEL F12   |                |
     |                |--------------->|                |
     |                |     200 F13    |                |
     |                |<---------------|                |

   Alice calls Bob through NGW 1 and Proxy 1.  Proxy 1 re-sends the
   INVITE after the expiration of SIP timer T1 without receiving any
   response from Bob.  Bob never responds with 180 Ringing or any other
   response (it is reachable but unresponsive).  After the expiration of
   a timer, Alice's network disconnects the call by sending a Release
   message REL.  The Gateway maps this to a CANCEL.

   Message Details

   F1 IAM Alice -> NGW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=972-555-2222,NPI=E.164,NOA=National


   F2 INVITE Alice -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine a route for
   +19725552222.  The call is then forwarded to Bob. */


   F3 INVITE Proxy 1 -> Bob

   INVITE sip:bob@b.example.com  SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   c c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying Proxy 1 -> NGW 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 INVITE Proxy 1 -> Bob

   Same as Message F3


   F6 INVITE Proxy 1 -> Bob

   Same as Message F3


   F7 INVITE Proxy 1 -> Bob

   Same as Message F3


   F8 INVITE Proxy 1 -> Bob

   Same as Message F3


   F9 INVITE Proxy 1 -> Bob

   Same as Message F3

   /* Timer expires in Alice's access network. */


   F10 REL Alice -> NGW 1

   REL
   CauseCode=16 Normal


   F11 RLC NGW 1 -> Alice

   RLC


   F12 CANCEL NGW 1 -> Proxy 1

   CANCEL sip:+19725552222@ss1.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F13 200 OK Proxy 1 -> NGW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


3.8.  Unsuccessful PSTN->SIP, ACM timeout, stateless Proxy

   Switch A          NGW 1      Stateless Proxy 1     Bob
     |                |                |                |
     |     IAM F1     |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|   INVITE F3    |
     |                |   INVITE F4    |--------------->|
     |                |--------------->|   INVITE F5    |
     |                |   INVITE F6    |--------------->|
     |                |--------------->|   INVITE F7    |
     |                |   INVITE F8    |--------------->|
     |                |--------------->|   INVITE F9    |
     |                |   INVITE F10   |--------------->|
     |                |--------------->|   INVITE F11   |
     |                |   INVITE F12   |--------------->|
     |                |--------------->|   INVITE F13   |
     |                |                |--------------->|
     |     REL F14    |                |                |
     |--------------->|                |                |
     |     RLC F15    |                |                |
     |<---------------|                |                |


   In this scenario, Alice calls Bob through NGW 1 and Proxy 1.  Since
   Proxy 1 is stateless (it does not send a 100 Trying response), NGW 1
   re-sends the INVITE message after the expiration of SIP timer T1.
   Bob does not respond with 180 Ringing.  Alice's network disconnects
   the call with a release REL (CauseCode=102 Timeout).

   Message Details

   F1 IAM Alice -> NGW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=972-555-2222,NPI=E.164,NOA=National


   F2 INVITE NGW 1 -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE

   Contact: <sip:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine a route for
   +19725552222.  The call is then forwarded to Bob. */


   F3 INVITE Proxy 1 -> Bob

   INVITE sip:bob@b.example.com  SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   Max-Forwards: 69
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 INVITE NGW 1 -> Proxy 1

   Same as Message F2


   F5 INVITE Proxy 1 -> Bob

   Same as Message F3

   F6 INVITE NGW 1 -> Proxy 1

   Same as Message F2


   F7 INVITE Proxy 1 -> Bob

   Same as Message F3


   F8 INVITE NGW 1 -> Proxy 1

   Same as Message F2


   F9 INVITE Proxy 1 -> Bob

   Same as Message F3


   F10 INVITE NGW 1 -> Proxy 1

   Same as Message F2


   F11 INVITE Proxy 1 -> Bob

   Same as Message F3


   F12 INVITE NGW 1 -> Proxy 1

   Same as Message F2


   F13 INVITE Proxy 1 -> Bob

   Same as Message F3

   /* A timer expires in Alice's access network. */


   F14 REL Alice -> NGW 1

   REL
   CauseCode=102 Timeout


   F15 RLC NGW 1 -> Alice

   RLC


3.9.  Unsuccessful PSTN->SIP, Caller Abandonment

   Switch A          NGW 1          Proxy 1           Bob
     |                |                |                |
     |     IAM F1     |                |                |
     |--------------->|   INVITE F2    |                |
     |                |--------------->|   INVITE F3    |
     |                |     100  F4    |--------------->|
     |                |<---------------|                |
     |                |                |      180 F5    |
     |                |    180 F6      |<---------------|
     |     ACM F7     |<---------------|                |
     |<---------------|                |                |
     |  One Way Voice |                |                |
     |<===============|                |                |
     |  Ringing Tone  |                |                |
     |<===============|                |                |
     |                |                |                |
     |     REL F8     |                |                |
     |--------------->|                |                |
     |     RLC F9     |                |                |
     |<---------------|   CANCEL F10   |                |
     |                |--------------->|                |
     |                |     200 F11    |                |
     |                |<---------------|                |
     |                |                |   CANCEL F12   |
     |                |                |--------------->|
     |                |                |     200 F13    |
     |                |                |<---------------|
     |                |                |     487 F14    |
     |                |                |<---------------|
     |                |                |     ACK F15    |
     |                |     487 F16    |--------------->|
     |                |<---------------|                |
     |                |     ACK F17    |                |
     |                |--------------->|                |
     |                |                |                |

   In this scenario, Alice calls Bob through NGW 1 and Proxy 1.  Bob
   does not respond with 200 OK.  NGW 1 plays ringing tone since the ACM
   indicates that interworking has been encountered.  Alice disconnects
   the call with a Release message REL which is mapped by NGW 1 to a
   CANCEL.  Note that if Bob had sent a 200 OK response after the REL,
   NGW 1 would have sent an ACK and then a BYE to properly terminate the
   call.

   Message Details

   F1 IAM Alice -> NGW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=972-555-2222,NPI=E.164,NOA=National


   F2 INVITE Alice -> Proxy 1

   INVITE sip:+19725552222@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine a route for
   +19725552222.  The call is then forwarded to Bob. */


   F3 INVITE Proxy 1 -> Bob

   INVITE sip:bob@b.example.com  SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:ngw1@a.example.com;transport=tcp>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844527 2890844527 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 100 Trying Bob -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.201
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 180 Ringing Bob -> Proxy 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com;transport=tcp>
   Content-Length: 0


   F6 180 Ringing Proxy 1 -> NGW 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:bob@client.b.example.com>
   Content-Length: 0


   F7 ACM NGW 1 -> Alice

   ACM

   /* Alice hangs up */


   F8 REL Alice -> NGW 1

   REL
   CauseCode=16 Normal


   F9 RLC NGW 1 -> Alice

   RLC


   F10 CANCEL NGW 1 -> Proxy 1

   CANCEL sip:+19725552222@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F11 200 OK Proxy 1 -> NGW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F12 CANCEL Proxy 1 -> Bob

   CANCEL sip:bob@b.example.com SIP/2.0
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F13 200 OK Bob -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 CANCEL
   Content-Length: 0


   F14 487 Request Terminated Bob -> Proxy 1

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/TCP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F15 ACK Proxy 1 -> Bob

   ACK sip:bob@b.example.com SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F16 487 Request Terminated Proxy 1 -> NGW 1

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F17 ACK NGW 1 -> Proxy 1

   ACK sip:+19725552222@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TCP ngw1.a.example.com:5060;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sip:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sip:+19725552222@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 4Fde34wkd11wsGFDs3@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0



--> PSTN to PSTN Dialing via SIP Network

4.1.  Successful ISUP PSTN to ISUP PSTN call

   Switch A       NGW 1         Proxy 1         GW 2         Switch C
    |              |              |              |              |
    |     IAM F1   |              |              |              |
    |------------->|              |              |              |
    |              |  INVITE F2   |              |              |
    |              |------------->|  INVITE F3   |              |
    |              |              |------------->|     IAM F4   |
    |              |              |              |------------->|
    |              |              |              |     ACM F5   |
    |              |              |   183 F6     |<-------------|
    |              |    183 F7    |<-------------|              |
    |    ACM F8    |<-------------|              |              |
    |<-------------|              |              |              |
    | One Way Voice|      Two Way RTP Media      | One Way Voice|
    |<=============|<===========================>|<=============|
    |              |              |              |    ANM F9    |
    |              |              |   200 F10    |<-------------|
    |              |    200 F11   |<-------------|              |
    |    ANM F12   |<-------------|              |              |
    |<-------------|              |              |              |
    |              |    ACK F13   |              |              |
    |              |------------->|    ACK F14   |              |
    |              |              |------------->|              |
    |Both Way Voice|     Both Way RTP Media      |Both Way Voice|
    |<=============|<===========================>|<=============|
    |              |              |              |    REL F15   |
    |              |              |              |<-------------|
    |              |              |   BYE F16    |              |
    |              |    BYE F18   |<-------------|    RLC F17   |
    |              |<-------------|              |------------->|
    |              |              |              |              |
    |              |    200 F19   |              |              |
    |              |------------->|    200 F20   |              |
    |              |              |------------->|              |
    |    REL F21   |              |              |              |
    |<-------------|              |              |              |
    |    RLC F22   |              |              |              |
    |------------->|              |              |              |
    |              |              |              |              |

   In this scenario, Alice in the PSTN calls Carol who is an extension
   on a PBX.  Alice's telephone switch signals via SS7 to the Network
   Gateway NGW 1, while Carol's PBX signals via SS7 with the Gateway GW
   2.  The CdPN and CgPN are mapped by GW 1 into SIP URIs and placed in
   the To and From headers.  Proxy 1 looks up the dialed digits in the
   Request-URI and maps the digits to the PBX extension of Carol, which
   is served by GW 2.  The Proxy in F3 uses the host portion of the
   Request-URI to identify what private dialing plan is being
   referenced.  The INVITE is then forwarded to GW 2 for call
   completion.  An early media path is established end-to-end so that
   Alice can hear the ringing tone generated by PBX C.

   Carol answers the call and the media path is cut through in both
   directions.  Bob hangs up terminating the call.

   Message Details

   F1 IAM Switch Alice -> NGW 1

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=918-555-3333,NPI=E.164,NOA=National


   F2 INVITE NGW 1 -> Proxy 1

   INVITE sips:+19185553333@ss1.a.example.com;user=phone  SIP/2.0
   Via: SIP/2.0/TLS ngw1.a.example.com:5061;branch=z9hG4bKlueha2
   Max-Forwards: 70
   From: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sips:+19185553333@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sips:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844526 2890844526 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 consults Location Service and translates the dialed number
   to a private number in the Request-URI*/


   F3 INVITE Proxy 1 -> GW 2

   INVITE sips:4443333@gw2.a.example.com SIP/2.0
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TLS ngw1.a.example.com:5061;branch=z9hG4bKwqwee65

    ;received=192.0.2.103
   Max-Forwards: 69
   Record-Route: <sips:ss1.a.example.com;lr>
   From: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sips:+19185553333@ss1.a.example.com;user=phone>
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sips:ngw1@a.example.com>
   Content-Type: application/sdp
   Content-Length: 146

   v=0
   o=GW 2890844526 2890844526 IN IP4 ngw1.a.example.com
   s=-
   c=IN IP4 ngw1.a.example.com
   t=0 0
   m=audio 3456 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 IAM GW 2 -> Switch C

   IAM
   CgPN=314-555-1111,NPI=E.164,NOA=National
   CdPN=444-3333,NPI=Private,NOA=Subscriber


   F5 ACM Switch C -> GW 2

   ACM

   /* Based on the ACM message, GW 2 returns a 183 response.  In-band
   call progress indications are sent to Alice through NGW 1. */


   F6 183 Session Progress GW 2 -> Proxy 1

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TLS ngw1.a.example.com:5061;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sips:ss1.a.example.com;lr>
   From: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sips:4443333@gw2.a.example.com>
   Content-Type: application/sdp
   Content-Length: 143

   v=0
   o=GW 987654321 987654321 IN IP4 gw2.a.example.com
   s=-
   c=IN IP4 gw2.a.example.com
   t=0 0
   m=audio 14918 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F7 183 Session Progress Proxy 1 -> GW 1

   SIP/2.0 183 Session Progress
   Via: SIP/2.0/TLS ngw1.a.example.com:5061;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sips:ss1.a.example.com;lr>
   From: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sips:4443333@gw2.a.example.com>
   Content-Type: application/sdp
   Content-Length: 143

   v=0
   o=GW 987654321 987654321 IN IP4 gw2.a.example.com
   s=-
   c=IN IP4 gw2.a.example.com
   t=0 0
   m=audio 14918 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* NGW 1 receives packets from GW 2 with encoded ringback, tones or
   other audio.  NGW 1 decodes this and places it on the originating
   trunk. */


   F8 ACM NGW 1 -> Switch A

   ACM

   /* Bob answers */

   F9 ANM Switch C -> GW 2

   ANM


   F10 200 OK GW 2 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TLS ngw1.a.example.com:5061;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sips:ss1.a.example.com;lr>
   From: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sips:4443333@gw2.a.example.com>
   Content-Type: application/sdp
   Content-Length: 143

   v=0
   o=GW 987654321 987654321 IN IP4 gw2.a.example.com
   s=-
   c=IN IP4 gw2.a.example.com
   t=0 0
   m=audio 14918 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F11 200 OK Proxy 1 -> NGW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS ngw1.a.example.com:5061;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Record-Route: <sips:ss1.a.example.com;lr>
   From: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sips:4443333@gw2.a.example.com>
   Content-Type: application/sdp
   Content-Length: 143

   v=0
   o=GW 987654321 987654321 IN IP4 gw2.a.example.com
   s=-
   c=IN IP4 gw2.a.example.com

   t=0 0
   m=audio 14918 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F12 ANM NGW 1 -> Switch A

   ANM


   F13 ACK NGW 1 -> Proxy 1

   ACK sips:4443333@gw2.a.example.com SIP/2.0
   Via: SIP/2.0/TLS ngw1.a.example.com:5061;branch=z9hG4bKlueha2
   Max-Forwards: 70
   Route: <sips:ss1.a.example.com;lr>
   From: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F14 ACK Proxy 1 -> GW 2

   ACK sips:4443333@gw2.a.example.com SIP/2.0
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TLS ngw1.a.example.com:5061;branch=z9hG4bKlueha2
    ;received=192.0.2.103
   Max-Forwards: 69
   From: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   To: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   /* RTP streams are established between NGW 1 and GW 2. */

   /* Bob Hangs Up with Alice. */


   F15 REL Switch C -> GW 2

   REL
   CauseCode=16 Normal

   F16 BYE GW 2 -> Proxy 1

   BYE sips:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/TLS gw2.a.example.com:5061;branch=z9hG4bKtexx6
   Max-Forwards: 70
   Route: <sips:ss1.a.example.com;lr>
   From: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   To: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 4 BYE
   Content-Length: 0


   F17 RLC GW 2 -> Switch C

   RLC


   F18 BYE Proxy 1 -> NGW 1

   BYE sips:ngw1@a.example.com SIP/2.0
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/TLS gw2.a.example.com:5061;branch=z9hG4bKtexx6
    ;received=192.0.2.202
   Max-Forwards: 69
   From: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   To: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 4 BYE
   Content-Length: 0


   F19 200 OK NGW 1 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS ss1.a.example.com:5061;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/TLS gw2.a.example.com:5061;branch=z9hG4bKtexx6
    ;received=192.0.2.202
   From: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   To: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 4 BYE
   Content-Length: 0

   F20 200 OK Proxy 1 -> GW 2

   SIP/2.0 200 OK
   Via: SIP/2.0/TLS gw2.a.example.com:5061;branch=z9hG4bKtexx6
    ;received=192.0.2.202
   From: <sips:+19185553333@ss1.a.example.com;user=phone>;tag=314159
   To: <sips:+13145551111@ngw1.a.example.com;user=phone>;tag=7643kals
   Call-ID: 2xTb9vxSit55XU7p8@ngw1.a.example.com
   CSeq: 4 BYE
   Content-Length: 0


   F21 REL Switch C -> GW 2

   REL
   CauseCode=16 Normal


   F22 RLC GW 2 -> Switch C

   RLC


4.2.  Successful FGB PBX to ISDN PBX call with overflow

   PBX A       GW 1        Proxy 1        GW 2         GW 3        PBX C
     |            |            |            |            |            |
     |  Seizure   |            |            |            |            |
     |----------->|            |            |            |            |
     |    Wink    |            |            |            |            |
     |<-----------|            |            |            |            |
     |MF Digits F1|            |            |            |            |
     |----------->|            |            |            |            |
     |            | INVITE F2  |            |            |            |
     |            |----------->| INVITE F3  |            |            |
     |            |            |----------->|            |            |
     |            |            |   503 F4   |            |            |
     |            |            |<-----------|            |            |
     |            |            |   ACK F5   |            |            |
     |            |            |----------->|            |            |
     |            |            |  INVITE F6              |            |
     |            |            |------------------------>|  SETUP F7  |
     |            |            |          100  F8        |----------->|
     |            |            |<------------------------|CALL PROC F9|
     |            |            |                         |<-----------|
     |            |            |                         | ALERT F10  |
     |            |            |          180 F11        |<-----------|
     |            |  180 F12   |<------------------------|            |
     |            |<-----------|                         |            |
     | Ringtone   |            |                         |OneWay Voice|
     |<===========|            |                         |<===========|
     |            |            |                         | CONNect F13|
     |            |            |         200 F14         |<-----------|
     |            |  200 F15   |<------------------------|            |
     |  Seizure   |<-----------|                         |            |
     |<-----------|  ACK F16   |                         |            |
     |            |----------->|         ACK F17         |            |
     |            |            |------------------------>|CONN ACK F18|
     |            |            |                         |----------->|
     |BothWayVoice|          Both Way RTP Media          |BothWayVoice|
     |<==========>|<====================================>|<==========>|
     |            |            |                         |  DISC F19  |
     |            |            |                         |<-----------|
     |            |            |         BYE F20         |            |
     |            |  BYE F21   |<------------------------|  REL F22   |
     |Seiz Removal|<-----------|                         |----------->|
     |<-----------|  200 F23   |                         |            |
     |Seiz Removal|----------->|         200 F24         |            |
     |----------->|            |------------------------>| REL COM F25|
     |            |            |                         |<-----------|
     |            |            |                         |            |

   PBX Alice calls PBX Carol via Gateway GW 1 and Proxy 1.  During the
   attempt to reach Carol via GW 2, an error is encountered - Proxy 1
   receives a 503 Service Unavailable (F4) response to the forwarded
   INVITE.  This could be due to all circuits being busy, or some other
   outage at GW 2.  Proxy 1 recognizes the error and uses an alternative
   route via GW 3 to terminate the call.  From there, the call proceeds
   normally with Carol answering the call.  The call is terminated when
   Carol hangs up.

   Message Details

   PBX Alice -> GW 1

   Seizure

   GW 1 -> PBX A

   Wink

   F1 MF Digits PBX Alice -> GW 1

   KP 444 3333 ST


   F2 INVITE GW 1 -> Proxy 1

   INVITE sip:4443333@ss1.a.example.com SIP/2.0
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
   Max-Forwards: 70
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:551313@gw1.a.example.com>
   Content-Type: application/sdp
   Content-Length: 155

   v=0
   o=GW 2890844526 2890844526 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   /* Proxy 1 uses a Location Service function to determine where B is
   located.  Response is returned listing alternative routes, GW2 and
   GW3, which are then tried sequentially. */


   F3 INVITE Proxy 1 -> GW 2

   INVITE sip:4443333@gw2.a.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:551313@gw1.a.example.com>
   Content-Type: application/sdp
   Content-Length: 155

   v=0
   o=GW 2890844526 2890844526 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F4 503 Service Unavailable GW 2 -> Proxy 1

   SIP/2.0 503 Service Unavailable
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
    ;received=192.0.2.111
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F5 ACK Proxy 1 -> GW 2

   ACK sip:4443333@ss1.a.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.1
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Max-Forward: 70
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>;tag=314159
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F6 INVITE Proxy 1 -> GW 3

   INVITE sip:+19185553333@gw3.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Max-Forwards: 69
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:551313@gw1.a.example.com>
   Content-Type: application/sdp
   Content-Length: 155

   v=0
   o=GW 2890844526 2890844526 IN IP4 gw1.a.example.com
   s=-
   c=IN IP4 gw1.a.example.com
   t=0 0
   m=audio 49172 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F7 SETUP GW 3 -> PBX C

   Protocol discriminator=Q.931
   Message type=SETUP
   Bearer capability: Information transfer capability=0 (Speech) or 16
   (3.1 kHz audio)
   Channel identification=Preferred or exclusive B-channel
   Progress indicator=1 (Call is not end-to-end ISDN; further call
   progress information may be available inband)
   Called party number:
   Type of number and numbering plan ID=33 (National number in ISDN
   numbering plan)
   Digits=918-555-3333
   F8 100 Trying GW 3 -> Proxy 1

   SIP/2.0 100 Trying
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Content-Length: 0


   F9 CALL PROCeeding PBX C -> GW 3

   Protocol discriminator=Q.931
   Message type=CALL PROC


   F10 ALERT PBX C -> GW 3

   Protocol discriminator=Q.931
   Message type=PROG

   /* Based on ALERT message, GW 3 returns a 180 response. */


   F11 180 Ringing GW 3 -> Proxy 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
    ;received=192.0.2.111
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>;tag=123456789
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:+19185553333@gw3.a.example.com;user=phone>
   Content-Length: 0


   F12 180 Ringing Proxy 1 -> GW 1

   SIP/2.0 180 Ringing
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>;tag=123456789
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:+19185553333@gw3.a.example.com;user=phone>
   Content-Length: 0


   F13 CONNect PBX C -> GW 3

   Protocol discriminator=Q.931
   Message type=CONN


   F14 200 OK GW 3 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
    ;received=192.0.2.111
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>;tag=123456789
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:+19185553333@gw3.a.example.com;user=phone>
   Content-Type: application/sdp
   Content-Length: 143

   v=0
   o=GW 987654321 987654321 IN IP4 gw3.a.example.com
   s=-
   c=IN IP4 gw3.a.example.com
   t=0 0
   m=audio 14918 RTP/AVP 0
   a=rtpmap:0 PCMU/8000


   F15 200 OK Proxy 1 -> GW 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Record-Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>;tag=123456789
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 INVITE
   Contact: <sip:+19185553333@gw3.a.example.com;user=phone>
   Content-Type: application/sdp
   Content-Length: 143

   v=0
   o=GW 987654321 987654321 IN IP4 gw3.a.example.com
   s=-
   c=IN IP4 gw3.a.example.com
   t=0 0
   m=audio 14918 RTP/AVP 0
   a=rtpmap:0 PCMU/8000

   GW 1 -> PBX A

   Seizure


   F16 ACK GW 1 -> Proxy 1

   ACK sip:+19185553333@gw3.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>;tag=123456789
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0


   F17 ACK Proxy 1 -> GW 3

   ACK sip:+19185553333@gw3.a.example.com;user=phone SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
   Via: SIP/2.0/UDP gw1.a.example.com:5060;branch=z9hG4bKwqwee65
    ;received=192.0.2.201
   Max-Forwards: 69
   From: <sip:551313@gw1.a.example.com>;tag=63412s
   To: <sip:4443333@ss1.a.example.com>;tag=123456789
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 ACK
   Content-Length: 0

   F18 CONNect ACK GW 3 -> PBX C

   Protocol discriminator=Q.931
   Message type=CONN ACK

   /* RTP streams are established between GW 1 and GW 3. */

   /* Bob Hangs Up with Alice. */


   F19 DISConnect PBX C -> GW 3

   Protocol discriminator=Q.931
   Message type=DISC
   Cause=16 (Normal clearing)


   F20 BYE GW 3 -> Proxy 1

   BYE sip:551313@gw1.a.example.com SIP/2.0
   Via: SIP/2.0/UDP gw3.a.example.com:5060;branch=z9hG4bKkdjuwq
   Max-Forwards: 70
   Route: <sip:ss1.a.example.com;lr>
   From: <sip:4443333@ss1.a.example.com>;tag=123456789
   To: <sip:551313@gw1.a.example.com>;tag=63412s
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F21 BYE Proxy 1 -> GW 1

   BYE sip:551313@gw1.a.example.com SIP/2.0
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
   Via: SIP/2.0/UDP gw3.a.example.com:5060;branch=z9hG4bKkdjuwq
    ;received=192.0.2.203
   Max-Forwards: 69
   From: <sip:4443333@ss1.a.example.com>;tag=123456789
   To: <sip:551313@gw1.a.example.com>;tag=63412s
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 BYE
   Content-Length: 0

   GW 1 -> PBX A

   Seizure removal

   F22 RELease GW 3 -> PBX C

   Protocol discriminator=Q.931
   Message type=REL


   F23 200 OK GW 1 -> Proxy 1

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP ss1.a.example.com:5060;branch=z9hG4bK2d4790.2
    ;received=192.0.2.111
   Via: SIP/2.0/UDP gw3.a.example.com:5060;branch=z9hG4bKkdjuwq
    ;received=192.0.2.203
   From: <sip:4443333@ss1.a.example.com>;tag=123456789
   To: <sip:551313@gw1.a.example.com>;tag=63412s
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F24 200 OK Proxy 1 -> GW 3

   SIP/2.0 200 OK
   Via: SIP/2.0/UDP gw3.a.example.com:5060;branch=z9hG4bKkdjuwq
    ;received=192.0.2.203
   From: <sip:4443333@ss1.a.example.com>;tag=123456789
   To: <sip:551313@gw1.a.example.com>;tag=63412s
   Call-ID: 2xTb9vxSit55XU7p8@gw1.a.example.com
   CSeq: 1 BYE
   Content-Length: 0


   F25 RELease COMplete PBX C -> GW 3

   Protocol discriminator=Q.931
   Message type=REL COM

   PBX Alice -> GW 1

   Seizure removal


